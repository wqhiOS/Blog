{"pages":[{"title":"","text":"LJpMHcjgdy","link":"/baidu_verify_LJpMHcjgdy.html"},{"title":"å…³äºæˆ‘","text":"äº15å¹´ä»äº‹iOSå¼€å‘è‡³ä»Šï¼Œ16å¹´æ¯•ä¸šäºæ²³å—å¤§å­¦è½¯ä»¶å·¥ç¨‹ç³»ï¼›ç°å±…ä½äºä¸Šæµ·ã€‚ å·¥ä½œç»å† æ™ºæ…§æ ‘ç½‘ æ—¶é—´ï¼š2018å¹´5æœˆ~è‡³ä»Š è¡Œä¸šç±»åˆ«ï¼šäº’è”ç½‘æ•™è‚² èŒä½ï¼šiOSé«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ å–„æ—(ä¸Šæµ·)é‡‘èä¿¡æ¯æœåŠ¡æœ‰é™å…¬å¸ æ—¶é—´ï¼š2015å¹´7æœˆ~2018å¹´4æœˆ è¡Œä¸šç±»åˆ«ï¼šé‡‘è èŒä½ï¼šiOSå¼€å‘å·¥ç¨‹å¸ˆ ä¸Šæµ·æ€éœç½‘ç»œæœ‰é™å…¬å¸ æ—¶é—´ï¼š2015å¹´1æœˆ~2015å¹´æœˆ7æœˆ è¡Œä¸šç±»åˆ«ï¼šäº’è”ç½‘ç”µå­å•†åŠ¡ èŒä½ï¼šiOSå¼€å‘å·¥ç¨‹å¸ˆ è”ç³»æ–¹å¼ï¼š wuqh_ios@icloud.com","link":"/about/index.html"},{"title":"schedule","text":"","link":"/schedule/index.html"},{"title":"åˆ†ç±»","text":"","link":"/categories/index.html"},{"title":"æ ‡ç­¾","text":"","link":"/tags/index.html"}],"posts":[{"title":"Grand Central Dispatch","text":"ç®€ä»‹ ä»€ä¹ˆæ˜¯GCD å…¨ç¨‹ï¼šGrand Central Dispatchï¼ˆå¼ºå¤§çš„ä¸­æ¢è°ƒåº¦å™¨ï¼‰ çº¯Cè¯­è¨€ï¼Œæä¾›äº†éå¸¸å¼ºå¤§çš„å‡½æ•° GCDçš„ä¼˜åŠ¿ GCDä¼šè‡ªåŠ¨åˆ©ç”¨æ›´å¤šçš„CPUå†…æ ¸ GCDä¼šè‡ªåŠ¨ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼ˆåˆ›å»ºçº¿ç¨‹ã€è°ƒåº¦ä»»åŠ¡ã€é”€æ¯çº¿ç¨‹ï¼‰ ç¨‹åºå‘˜åªéœ€è¦å‘Šè¯‰GCDæƒ³è¦æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ï¼Œä¸éœ€è¦ç¼–å†™ä»»ä½•çº¿ç¨‹ç®¡ç†ä»£ç  ä»»åŠ¡å’Œé˜Ÿåˆ— GCDä¸­æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µ ä»»åŠ¡ï¼šæ‰§è¡Œä»€ä¹ˆæ“ä½œ é˜Ÿåˆ—ï¼šç”¨æ¥å­˜æ”¾ä»»åŠ¡ GCDçš„ä½¿ç”¨æœ‰ä¸¤ä¸ªæ­¥éª¤ å®šåˆ¶ä»»åŠ¡ å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ GCDä¼šè‡ªåŠ¨å°†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å–å‡ºæ¥ï¼Œæ”¾åˆ°å¯¹åº”çš„çº¿ç¨‹ä¸­æ‰§è¡Œ ä»»åŠ¡çš„å–å‡ºéµå¾ªé˜Ÿåˆ—çš„FIFOï¼ˆç°é‡‘å…ˆå‡ºï¼‰åŸåˆ™ æ‰§è¡Œä»»åŠ¡ GCDä¸­æœ‰ä¸¤ä¸ªç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„å¸¸ç”¨å‡½æ•° 12345678/** ç”¨åŒæ­¥çš„æ–¹å¼æ‰§è¡Œä»»åŠ¡ @param queue#&gt; é˜Ÿåˆ— description#&gt; @param void blockä»»åŠ¡ @return */ dispatch_sync(&lt;#dispatch_queue_t _Nonnull queue#&gt;, &lt;#^(void)block#&gt;); 1234/** ç”¨å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œä»»åŠ¡ */ dispatch_async(&lt;#dispatch_queue_t _Nonnull queue#&gt;, &lt;#^(void)block#&gt;); è¿˜æœ‰ä¸ªç”¨æ¥æ‰§è¡Œä»»åŠ¡çš„å‡½æ•°ï¼š 1234567&gt; //ç¬¬ä¸€ä¸ªå‚æ•°queue ä¸èƒ½æ˜¯å…¨å±€çš„å¹¶å‘é˜Ÿåˆ—&gt; /*&gt; dispatch_barrier_asyncå‡½æ•°çš„ä½œç”¨ä¸barrierçš„æ„æ€ç›¸åŒ,åœ¨è¿›ç¨‹ç®¡ç†ä¸­èµ·åˆ°ä¸€ä¸ªæ …æ çš„ä½œç”¨,å®ƒç­‰ å¾…æ‰€æœ‰ä½äºbarrierå‡½æ•°ä¹‹å‰çš„æ“ä½œæ‰§è¡Œå®Œæ¯•åæ‰§è¡Œ,å¹¶ä¸”åœ¨barrierå‡½æ•°æ‰§è¡Œä¹‹å,barrierå‡½æ•°ä¹‹åçš„ æ“ä½œæ‰ä¼šå¾—åˆ°æ‰§è¡Œ,è¯¥å‡½æ•°éœ€è¦åŒdispatch_queue_createå‡½æ•°ç”Ÿæˆçš„concurrent Dispatch Queue é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨&gt; */&gt; dispatch_barrier_async(&lt;#dispatch_queue_t _Nonnull queue#&gt;, &lt;#^(void)block#&gt;);&gt; dispatch_barrier_sync(&lt;#dispatch_queue_t _Nonnull queue#&gt;, &lt;#^(void)block#&gt;);&gt; åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ« åŒæ­¥ï¼šåªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ› å¼‚æ­¥ï¼šåªèƒ½åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå±€åˆ«å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ› åŒæ­¥ã€å¼‚æ­¥ã€å¹¶å‘ã€ä¸²è¡Œ è¦åˆ†æ¸…æ¥š åŒæ­¥å’Œå¼‚æ­¥ä¸»è¦å½±å“ï¼šèƒ½ä¸èƒ½å¼€å¯æ–°çš„çº¿ç¨‹ åŒæ­¥ï¼šåªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ› å¼‚æ­¥ï¼šå¯ä»¥åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ› å¹¶å‘å’Œä¸²è¡Œä¸»è¦å½±å“ï¼šä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ å¹¶å‘ï¼šå…è®¸å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œ ä¸²è¡Œï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ dispatch_async å’Œ dispatch_sync è¿˜è¦ä¸€ä¸ªå¾ˆé‡è¦çš„åŒºåˆ« å¼‚æ­¥æ‰§è¡Œ ä¼šç«‹åˆ»è¿”å› 123456789101112//éªŒè¯å¼‚æ­¥æ‰§è¡Œä¼šç«‹åˆ»è¿”å› dispatch_async(dispatch_get_global_queue(0, 0), ^{ //å­çº¿ç¨‹ for (NSInteger i = 0; i &lt; 100; i++) { NSLog(@\"22222\"); } }); NSLog(@\"33333\"); /* å…ˆæ‰“å°33333 æœ€åæ‰æ˜¯2222ã€‚ã€‚ã€‚ */ åŒæ­¥æ‰§è¡Œä¼šç­‰å¾…æ‰§è¡Œç»“æŸåæ‰è¿”å› 123456789101112//éªŒè¯åŒæ­¥æ‰§è¡Œä¼šç­‰å¾…æ‰§è¡Œç»“æŸåè¿”å› dispatch_sync(dispatch_get_global_queue(0, 0), ^{ //å› ä¸ºæ˜¯åŒæ­¥ã€‚ä¸ä¼šå¼€å¯çº¿ç¨‹ï¼Œæ‰€ä»¥ä»ç„¶æ˜¯mainçº¿ç¨‹ for (NSInteger i = 0; i &lt; 100; i++) { NSLog(@\"22222\"); } }); NSLog(@\"33333\"); /* å…ˆæ‰“å°å®Œæ‰€æœ‰22222 æœ€åæ‰ä¼šæ‰“å°33333 */ æ­£æ˜¯å› ä¸ºè¿™ä¸ªç‰¹æ€§ åœ¨ä¸»çº¿ç¨‹åŒæ­¥è°ƒç”¨ä»»åŠ¡åœ¨mainQueueé‡Œï¼Œå°±ä¼šé€ æˆæ­»é”çš„æƒ…å†µã€‚å› ä¸ºï¼š1ï¼‰:dispatch_syncåœ¨ç­‰å¾…blockè¯­å¥æ‰§è¡Œå®Œæˆï¼Œè€Œblockè¯­å¥éœ€è¦åœ¨ä¸»çº¿ç¨‹é‡Œæ‰§è¡Œï¼Œæ‰€ä»¥dispatch_syncå¦‚æœåœ¨ä¸»çº¿ç¨‹è°ƒç”¨å°±ä¼šé€ æˆæ­»é”2ï¼‰:dispatch_syncæ˜¯åŒæ­¥çš„ï¼Œæœ¬èº«å°±ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œä¹Ÿå³ä¸»çº¿ç¨‹ã€‚è€Œåˆå¾€ä¸»çº¿ç¨‹é‡Œå¡è¿›å»ä¸€ä¸ªblockï¼Œæ‰€ä»¥å°±ä¼šå‘ç”Ÿæ­»é”ã€‚ åˆ›å»ºé˜Ÿåˆ—é˜Ÿåˆ—çš„ç±»å‹ GCDçš„é˜Ÿåˆ—å¯ä»¥åˆ†ä¸º2å¤§ç±»å‹ å¹¶å‘é˜Ÿåˆ— å¯ä»¥è®©å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼ˆè‡ªåŠ¨å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼‰ å¹¶å‘åŠŸèƒ½åªæœ‰åœ¨å¼‚æ­¥ï¼ˆdispatch_asyncï¼‰å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ ä¸²è¡Œé˜Ÿåˆ— è®©ä»»åŠ¡ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œï¼ˆä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼‰ å¦‚ä½•åˆ›å»ºå¹¶å‘é˜Ÿåˆ—ç¬¬ä¸€ç§æ–¹æ³•ï¼š 1dispatch_queue_create(\"com.a\", DISPATCH_QUEUE_CONCURRENT); ç¬¬äºŒç§æ–¹æ³•ï¼šä½¿ç”¨ç³»ç»Ÿæä¾›çš„ Global Dispatch Queue 1dispatch_get_global_queue(0, 0);//ç¬¬ä¸€ä¸ªè®¾ç½®ä¼˜å…ˆçº§ï¼Œä»…ä»…æ˜¯å¤§è‡´ä¼˜å…ˆçº§ã€‚ç¬¬äºŒä¸ªæš‚æ—¶æ²¡ç”¨ å¦‚ä½•åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—ç¬¬ä¸€ç§æ–¹æ³•ï¼š 1dispatch_queue_create(\"com.b\", NULL); æ³¨æ„ï¼šã€ŠiOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹ä¸­è®²åˆ° ä½¿ç”¨dispatch_queue_create()åˆ›å»ºçš„DispatchQueueåœ¨ARCä¸­ä¹Ÿéœ€è¦æ‰‹åŠ¨è°ƒç”¨dispatch_releaseï¼ˆï¼‰æ–¹æ³•é‡Šæ”¾ã€‚ç»è¿‡éªŒè¯ï¼ŒiOS6ä»¥åçš„ARCä¸­å°±ä¸éœ€è¦äº†ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„ä½¿ç”¨Serial Disparch Queueæ—¶ï¼Œå…¶ç”Ÿæˆä¸ªæ•°çš„é—®é¢˜ï¼ŒConcurrent Dispatch Queueèƒ½å¤Ÿå¹¶è¡Œæ‰§è¡Œå¤šä¸ªè¿½åŠ å¤„ç†ï¼ˆä¹Ÿå°±æ˜¯ä¼šå¼€å¯å¤šæ¡çº¿ç¨‹å»å¤„ç†è¿½åŠ åˆ°é˜Ÿåˆ—ä¸­çš„çš„å¤šä¸ªä»»åŠ¡ï¼‰ï¼Œè€ŒSerial Dispatch QueueåŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿½åŠ å¤„ç†ï¼ˆä¹Ÿå°±æ˜¯åªèƒ½å¼€å¯ä¸€æ¡çº¿ç¨‹ï¼‰ã€‚ ä½†æ˜¯å½“é€šè¿‡dispatch_queue_create()ç”Ÿæˆå¤šä¸ªSerial Dispatch Queueæ—¶ï¼Œå„ä¸ªSerial Dispatch Queueå°†å¹¶è¡Œæ‰§è¡Œï¼ˆå‰ææ˜¯ä½¿ç”¨å¼‚æ­¥æ–¹å¼ï¼‰ã€‚è™½ç„¶åœ¨ä¸€ä¸ªSerial Dispatch Queueä¸­åŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿½åŠ å¤„ç†ï¼Œä½†å¦‚æœå°†å¤„ç†åˆ†åˆ«è¿½åŠ åˆ°4ä¸ªSerial Dispatch Queueä¸­ï¼Œå„ä¸ªSerial Dispatch Queueæ‰§è¡Œä¸€ä¸ªï¼Œå³ä¸ºå¹¶è¡Œæ‰§è¡Œ4ä¸ªå¤„ç†ã€‚â‰ˆ å¦‚ä¸‹å›¾ï¼š å¦‚æœç”Ÿæˆ2000ä¸ªSerial Dispatch Queueï¼Œé‚£ä¹ˆå°±ç”Ÿæˆ2000ä¸ªçº¿ç¨‹ï¼Œå¦‚æœè¿‡å¤šä½¿ç”¨ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ï¼Œå¼•èµ·å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¤§å¹…åº¦é™ä½ç³»ç»Ÿçš„æ€§èƒ½ã€‚ ç¬¬äºŒç§æ–¹æ³•ï¼šç›´æ¥ä½¿ç”¨ä¸»é˜Ÿåˆ—ï¼ˆä¸»é˜Ÿåˆ—æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼‰ GCDçš„å…¶ä»–å‡½æ•°dispatch_set_target_queue å˜æ›´Dispatch Queueçš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚dispatch_queue_createå‡½æ•°ç”Ÿæˆçš„Dispatch Queueä¸ç®¡æ˜¯Serial Dispatch Queueè¿˜æ˜¯Concurrent Dispatch Queueï¼Œéƒ½ä½¿ç”¨ä¸é»˜è®¤ä¼˜å…ˆçº§Global Dispatch Queueç›¸åŒæ‰§è¡Œä¼˜å…ˆçº§çš„çº¿ç¨‹ã€‚ 12345 dispatch_queue_t serialQueue = dispatch_queue_create(&quot;com.oukavip.www&quot;,NULL); dispatch_queue_t globalQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND,0); dispatch_set_target_queue(serialQueue, globalQueue); // ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦è®¾ç½®ä¼˜å…ˆçº§çš„queue,ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‚ç…§ç‰©ï¼Œæ—¢å°†ç¬¬ä¸€ä¸ªqueueçš„ä¼˜å…ˆçº§å’Œç¬¬äºŒä¸ªqueueçš„ä¼˜å…ˆçº§è®¾ç½®ä¸€æ ·ã€‚//ç¬¬ä¸€ä¸ªå‚æ•°å¦‚æœæŒ‡å®šç³»ç»Ÿæä¾›çš„Main/Global Dispatch Queueåˆ™ä¸çŸ¥é“ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Œå› æ­¤è¿™äº›å‡ä¸å¯ä»¥æŒ‡å®šã€‚ å°†Dispatch QueueæŒ‡å®šä¸ºdispatch_set_target_queueå‡½æ•°çš„å‚æ•°è¿˜å¯ä»¥ä½œæˆDispatch Queueçš„æ‰§è¡Œé˜¶å±‚ï¼Œé‚£ä¹ˆåŸæœ¬åº”å¹¶è¡Œæ‰§è¡Œçš„å¤šä¸ªSerial Dispatch Queueï¼Œåœ¨ç›®æ ‡Serial Dispatch Queueä¸Šåªèƒ½åŒæ—¶æ‰§è¡Œä¸€ä¸ªå¤„ç†ã€‚ï¼ˆä¿®æ”¹ç”¨æˆ·é˜Ÿåˆ—çš„ç›®æ ‡é˜Ÿåˆ—ï¼Œä½¿å¤šä¸ªQueueåœ¨ç›®æ ‡Queueä¸Šä¸€æ¬¡åªæœ‰ä¸€ä¸ªæ‰§è¡Œï¼‰ 1234567891011121314151617181920212223242526dispatch_queue_t targetQueue = dispatch_queue_create(\"targetQueue\", DISPATCH_QUEUE_SERIAL); dispatch_queue_t queue1 = dispatch_queue_create(\"queue1\", DISPATCH_QUEUE_SERIAL); dispatch_queue_t queue2 = dispatch_queue_create(\"queue1\", DISPATCH_QUEUE_CONCURRENT); //è®¾ç½®å‚è€ƒ dispatch_set_target_queue(queue1, targetQueue); dispatch_set_target_queue(queue2, targetQueue); dispatch_async(queue1, ^{ NSLog(@\"job3 in\"); [NSThread sleepForTimeInterval:2.f]; NSLog(@\"job3 out\"); }); dispatch_async(queue1, ^{ NSLog(@\"job2 in\"); [NSThread sleepForTimeInterval:1.f]; NSLog(@\"job2 out\"); }); dispatch_async(queue1, ^{ NSLog(@\"job1 in\"); [NSThread sleepForTimeInterval:3.f]; NSLog(@\"job1 out\"); }); æ‰“å°è¾“å‡ºä¸ºï¼š 12345615:19:48.144492+0800 GCD[3693:336603] job3 in15:19:50.148901+0800 GCD[3693:336603] job3 out15:19:50.149213+0800 GCD[3693:336603] job2 in15:19:51.153663+0800 GCD[3693:336603] job2 out15:19:51.154019+0800 GCD[3693:336603] job1 in15:19:54.157262+0800 GCD[3693:336603] job1 out é€šè¿‡æ‰“å°çš„ç»“æœè¯´æ˜æˆ‘ä»¬è®¾ç½®äº†queue1å’Œqueue2é˜Ÿåˆ—ä»¥targetQueueé˜Ÿåˆ—ä¸ºå‚ç…§å¯¹è±¡ï¼Œé‚£ä¹ˆqueue1å’Œqueue2ä¸­çš„ä»»åŠ¡å°†æŒ‰ç…§targetQueueçš„é˜Ÿåˆ—å¤„ç†ã€‚ åœ¨å¿…é¡»å°†ä¸å¯å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†è¿½åŠ åˆ°å¤šä¸ªSerial Dispatch Queueä¸­æ—¶ï¼Œå¦‚æœä½¿ç”¨dispatch_set_target_queueå‡½æ•°å°†ç›®æ ‡åˆ¶å®šä¸ºæŸä¸€ä¸ªSerial Dispatch Queueï¼Œå³å¯é˜²æ­¢å¤„ç†å¹¶è¡Œæ‰§è¡Œã€‚ é€‚ç”¨åœºæ™¯ï¼šä¸€èˆ¬éƒ½æ˜¯æŠŠä¸€ä¸ªä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªä¸²è¡Œçš„queueä¸­ï¼Œå¦‚æœè¿™ä¸ªä»»åŠ¡è¢«æ‹†åˆ†äº†ï¼Œè¢«æ”¾ç½®åˆ°å¤šä¸ªä¸²è¡Œçš„queueä¸­ï¼Œä½†å®é™…è¿˜æ˜¯éœ€è¦è¿™ä¸ªä»»åŠ¡åŒæ­¥æ‰§è¡Œï¼Œé‚£ä¹ˆå°±ä¼šæœ‰é—®é¢˜ï¼Œå› ä¸ºå¤šä¸ªä¸²è¡Œqueueä¹‹é—´æ˜¯å¹¶è¡Œçš„ã€‚è¿™æ—¶å€™dispatch_set_target_queueå°†èµ·åˆ°ä½œç”¨ã€‚ dispatch_afteræƒ³åœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡Œå¤„ç†ï¼Œå¯ä½¿ç”¨dispatch_afterå‡½æ•°æ¥å®ç°ã€‚ 1234//åœ¨3ç§’åå°†æŒ‡å®šçš„blockè¿½åŠ åˆ°Main Dispatch Queueä¸­dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{ NSLog(@\"waited at last three seconds.\"); }); dispatch_afterå‡½æ•°å¹¶ä¸æ˜¯åœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡Œå¤„ç†ï¼Œè€Œåªæ˜¯åœ¨æŒ‡å®šæ—¶é—´è¿½åŠ å¤„ç†åˆ°Dispatch Queueã€‚æ­¤æºä»£ç ä¸åœ¨3ç§’åç”¨dispatch_asyncå‡½æ•°è¿½åŠ blockåˆ°Main Dispatch Queueç›¸åŒã€‚ å› ä¸ºMain Dispatch Queueåœ¨ä¸»çº¿ç¨‹çš„RunLoopä¸­æ‰§è¡Œï¼Œæ‰€ä»¥åœ¨æ¯”å¦‚æ¯éš”1/60ç§’æ‰§è¡Œçš„RunLoopä¸­ï¼Œblockæœ€å¿«åœ¨3ç§’åæ‰§è¡Œï¼Œæœ€æ…¢åœ¨3+1/60ç§’åæ‰§è¡Œã€‚å¹¶ä¸”Main Dispatch Queueæœ‰å¤§é‡å¤„ç†è¿½åŠ æˆ–ä¸»çº¿ç¨‹çš„å¤„ç†æœ¬èº«æœ‰å»¶è¿Ÿæ—¶ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ›´é•¿ã€‚å¦‚æœæƒ³åœ¨å¤§è‡´å»¶è¿Ÿæ—¶é—´æ‰§è¡Œå¤„ç†ï¼Œè¯¥å‡½æ•°æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚ disparch_group_tæ— è®ºå‘ä»€ä¹ˆæ ·çš„Dispatch Queueä¸­è¿½åŠ å¤„ç†ï¼Œä½¿ç”¨Dispatch Groupéƒ½å¯ä»¥ç›‘è§†è¿™äº›å¤„ç†æ‰§è¡Œçš„ç»“æŸã€‚ä¸€æ—¦æ£€æµ‹åˆ°æ‰€æœ‰å¤„ç†æ‰§è¡Œç»“æŸï¼Œå°±å¯å°†ç»“æŸçš„å¤„ç†è¿½åŠ åˆ°Dispatch Queueä¸­ã€‚è¿™å°±æ˜¯ä½¿ç”¨Dispatch Groupçš„åŸå› ã€‚ 123456789101112131415161718dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_group_t group = dispatch_group_create(); dispatch_group_async(group, queue, ^{ NSLog(@\"blk0\"); }); dispatch_group_async(group, queue, ^{ NSLog(@\"blk1\"); }); dispatch_group_async(group, dispatch_queue_create(\"com.wuqh.queue\", NULL), ^{ NSLog(@\"blk2\"); [NSThread sleepForTimeInterval:5]; NSLog(@\"blk2done\"); }); dispatch_group_notify(group, dispatch_get_main_queue(), ^{ NSLog(@\"done\"); }) å¦å¤–ï¼Œåœ¨Dispatch Gourpä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨dispatch_group_waitå‡½æ•°ä»…ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚ 12345678910111213141516171819dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); dispatch_group_t group = dispatch_group_create(); dispatch_group_async(group, queue, ^{ NSLog(@\"blk0\"); }); dispatch_group_async(group, queue, ^{ NSLog(@\"blk1\"); }); dispatch_group_async(group, dispatch_queue_create(\"com.wuqh.queue\", NULL), ^{ NSLog(@\"blk2\"); [NSThread sleepForTimeInterval:5]; NSLog(@\"blk2done\"); }); //ç¨‹åºä¼šä¸€ç›´åœç•™åœ¨æ­¤å¤„ç­‰å¾…gourpä¸­çš„ä»»åŠ¡ï¼Œç›´åˆ°å…¨éƒ¨æ‰§è¡Œå®Œæ¯•æ‰ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚ //ä¹Ÿå°±æ˜¯è¯´ï¼Œæ„å‘³ç€ä¸€æ—¦è°ƒç”¨dispatch_group_waitå‡½æ•°ï¼Œè¯¥å‡½æ•°å°±å¤„äºè°ƒç”¨çš„çŠ¶æ€è€Œä¸è¿”å›ã€‚å³æ‰§è¡Œdispatch //_group_waitå‡½æ•°çš„çº¿ç¨‹åœæ­¢ã€‚åœ¨ç»è¿‡dispatch_group_waitå‡½æ•°ä¸­æŒ‡å®šæ—¶é—´æˆ–ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œç»“æŸä¹‹å‰ //æ‰§è¡Œè¯¥å‡½æ•°çš„çº¿ç¨‹åœæ­¢ dispatch_group_wait(group, DISPATCH_TIME_FOREVER); ä¹Ÿå¯ä»¥æŒ‡å®šç­‰å¾…æ—¶é—´ã€‚disparch_group_waitï¼Œæœ‰ä¸€ä¸ªlongç±»å‹çš„è¿”å›å€¼ï¼Œè¿”å›å€¼ä¸º0ï¼Œè¡¨ç¤ºå…¨éƒ¨æ‰§è¡Œç»“æŸï¼Œè¿”å›å€¼ä¸ä¸º0ï¼Œè¡¨ç¤ºè™½ç„¶ç»è¿‡äº†æŒ‡å®šæ—¶é—´ï¼Œä½†è¿˜æœ‰æŸäº›å¤„ç†æ²¡æœ‰æ‰§è¡Œå®Œã€‚ 123456long result = dispatch_group_wait(group, dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC))); if (result &gt; 0) { NSLog(@\"æ²¡æœ‰å…¨éƒ¨æ‰§è¡Œç»“æŸæ‰§è¡Œç»“æŸ\"); }else { NSLog(@\"å…¨éƒ¨æ‰§è¡Œç»“æŸ\"); } æŒ‡å®štimeä¸ºDISPATCH_TIME_NOWï¼Œåˆ™ä¸ç”¨ä»»ä½•ç­‰å¾…å³å¯åˆ¤å®šå±äºDispatch Groupçš„å¤„ç†æ˜¯å¦æ‰§è¡Œç»“æŸã€‚ 1long result = dispatch_group_wait(group, DISPATCH_TIME_NOW); dispatch_(a)syncdispatch_asyncå‡½æ•°çš„â€asyncâ€œæ„å‘³ç€â€œéåŒæ­¥â€ï¼Œå°±æ˜¯å°†æŒ‡å®šçš„blockâ€éåŒæ­¥â€åœ°è¿½åŠ åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ã€‚dispatch_asyncå‡½æ•°ä¸ä½œä»»ä½•ç­‰å¾…ï¼Œå¦‚ä¸‹å›¾ï¼š dispatch_syncæ„å‘³ç€â€œåŒæ­¥â€ã€‚å‡½æ•°ä¼šä¸€ç›´ç­‰å¾…æ‰§è¡Œç»“æŸï¼Œâ€œç­‰å¾…â€æ„å‘³ç€å½“å‰çº¿ç¨‹åœæ­¢ã€‚å¦‚ä¸‹å›¾ï¼š æ³¨æ„ï¼šdispatch_syncå‡½æ•°å®¹æ˜“å¼•èµ·é—®é¢˜ï¼Œå³æ­»é”ã€‚ä¾‹å¦‚åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œä»¥ä¸‹æºä»£ç å°±ä¼šæ­»é”ï¼š 123dispatch_sync(dispatch_get_main_queue(), ^{ //ã€‚ã€‚ã€‚ }); ä½¿ç”¨asyncï¼Œæˆ–è€…Serail Dispatch Queueéƒ½ä¼šé‡åˆ°æ­»é”ï¼Œå¦‚ä¸‹ï¼š 12345dispatch_async(dispatch_get_main_queue(), ^{ dispatch_async(dispatch_get_main_queue(), ^{ NSLog(@\"...\"); })}); 123456dispatch_queue_t queue = dispatch_queue_create(\"com.gcd.error\", NULL); dispatch_async(queue, ^{ dispatch_async(queue, ^{ NSLog(@\"...\"); })}); dispatchbarrier(a)syncåœ¨è¿›ç¨‹ç®¡ç†ä¸­èµ·åˆ°ä¸€ä¸ªæ …æ çš„ä½œç”¨ï¼Œå®ƒç­‰å¾…æ‰€æœ‰ä½äºbarrierå‡½æ•°ä¹‹å‰çš„æ“ä½œæ‰§è¡Œå®Œæ¯•åæ‰§è¡Œï¼Œå¹¶ä¸”åœ¨barrierå‡½æ•°æ‰§è¡Œä¹‹åï¼Œbarrierå‡½æ•°ä¹‹åçš„æ“ä½œæ‰ä¼šå¾—åˆ°æ‰§è¡Œï¼Œè¯¥å‡½æ•°éœ€è¦åŒdispatch_queue_createå‡½æ•°ç”Ÿæˆçš„Concureent Dispatch Queueé˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨ã€‚æ³¨æ„ï¼šä¸ä½¿ç”¨dispatch_get_global_queue()è·å¾—çš„é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨æ— æ•ˆã€‚ ä½œç”¨ï¼š å®ç°é«˜æ•ˆç‡çš„æ•°æ®åº“è®¿é—®å’Œæ–‡ä»¶è®¿é—® é¿å…æ•°æ®ç«äº‰ 123456789101112131415161718192021222324252627282930dispatch_queue_t queue = dispatch_queue_create(\"com.gcd\", DISPATCH_QUEUE_CONCURRENT); dispatch_async(queue, ^{ for (int i = 0; i&lt;20; i++) { NSLog(@\"----1----%@\",[NSThread currentThread]); } }); dispatch_async(queue, ^{ for (int i = 0; i&lt;20; i++) { NSLog(@\"----2----%@\",[NSThread currentThread]); } }); dispatch_barrier_async(queue, ^{ for (int i = 0; i&lt;20; i++) { NSLog(@\"----barrier----%@\",[NSThread currentThread]); } }); dispatch_async(queue, ^{ for (int i = 0; i&lt;20; i++) { NSLog(@\"----3----%@\",[NSThread currentThread]); } }); dispatch_async(queue, ^{ for (int i = 0; i&lt;20; i++) { NSLog(@\"----4----%@\",[NSThread currentThread]); } });//å…ˆæ‰§è¡Œ1å’Œ2ï¼Œä¹‹åæ˜¯barrierï¼Œæœ€åæ˜¯3å’Œ4 åŒdispath_asyncä¸€æ ·ï¼Œæ­¤å‡½æ•°ä¹Ÿæœ‰ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼šdispatch_barrier_syncå‡½æ•°ï¼Œæ­¤å‡½æ•°ä¸dispatch_barrier_asyncçš„åŒºåˆ«å’Œ dispatch_asyncä¸dispatch_syncçš„åŒºåˆ«ç›¸åŒï¼šasyncä¸é˜»å¡å½“å‰çº¿ç¨‹ã€‚ dispatch_apply dispatch_applyå‡½æ•°æ—¶dispatch_syncå‡½æ•°å’ŒDispatch Groupçš„å…³è”APIã€‚è¯¥å‡½æ•°æŒ‰æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„blockè¿½åŠ åˆ°æŒ‡å®šçš„Dispatch Queueä¸­ï¼Œå¹¶ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚ 12345NSArray *array = [NSArray arrayWithObjects:@0,@1,@2,@3,@4,@5,@6,@7,@8,@9, nil];dispatch_apply([array count], dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(size_t index) { NSLog(@\"async:%@-%@\",array[index],[NSThread currentThread]);});NSLog(@\"done\");//åŒsyncä¸€æ ·ã€‚æœ€åæ‰ä¼šæ‰“å°doneã€‚ ç”±äºdispatch_applyå‡½æ•°ä¼šç­‰å¾…æ‰§è¡Œç»“æŸï¼Œå› æ­¤æœ‰æ—¶å€™ä¹Ÿå¯ä»¥åœ¨dispatch_asyncå‡½æ•°ä¸­éåŒæ­¥åœ°æ‰§è¡Œdispatch_applyå‡½æ•°ã€‚ 123456789dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ dispatch_apply([array count], dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^(size_t index) { NSLog(@\"async:%@-%@\",array[index],[NSThread currentThread]); }); dispatch_async(dispatch_get_main_queue(), ^{ NSLog(@\"success\"); }); });NSLog(@\"done\");//å› ä¸ºasyncä¸éœ€è¦ç­‰å¾…ï¼Œæ‰€ä»¥ä¼šç«‹é©¬æ‰§è¡Œï¼Œä¸ä¼šæœ€åæ‰æ‰“å°ã€‚ dispatch_suspend/dispatch_resumeå½“è¿½åŠ å¤§é‡å¤„ç†åˆ°Dispatch Queueæ—¶ï¼Œåœ¨è¿½åŠ å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å¸Œæœ›ä¸æ‰§è¡Œå·²è¿½åŠ çš„å¤„ç†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªè¦æŒ‚èµ·Dispatch Queueå³å¯ï¼Œå½“å¯ä»¥æ‰§è¡Œæ—¶å†æ¢å¤ã€‚ æ³¨æ„ï¼šdispatch_suspend/dispatch_resumeå¯¹å…¨å±€é˜Ÿåˆ—ä¸èµ·ä½œç”¨ã€‚ å¿…é¡»ç¡®ä¿dispatch_suspend/dispatch_resumeæˆå¯¹è°ƒç”¨ã€‚é‚£ä¹ˆè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Ÿgcdä¸­å¦‚ä½•ä¸­é€”ç»“æŸçº¿ç¨‹ï¼Ÿ 1234567891011121314151617181920212223dispatch_queue_t queue = dispatch_queue_create(\"com.test.gcd\", DISPATCH_QUEUE_SERIAL);//æäº¤ç¬¬ä¸€ä¸ªblockï¼Œå»¶æ—¶5ç§’æ‰“å°ã€‚dispatch_async(queue, ^{ sleep(5); NSLog(@\"After 5 seconds...\");});//æäº¤ç¬¬äºŒä¸ªblockï¼Œä¹Ÿæ˜¯å»¶æ—¶5ç§’æ‰“å°dispatch_async(queue, ^{ sleep(5); NSLog(@\"After 5 seconds again...\");});//å»¶æ—¶ä¸€ç§’NSLog(@\"sleep 1 second...\");sleep(1);//æŒ‚èµ·é˜Ÿåˆ—NSLog(@\"suspend...\");dispatch_suspend(queue);//å»¶æ—¶10ç§’NSLog(@\"sleep 10 second...\");sleep(10);//æ¢å¤é˜Ÿåˆ—NSLog(@\"resume...\");dispatch_resume(queue); 1234562017-08-18 17:52:41.261398+0800 GCD[5222:795121] sleep 1 second...2017-08-18 17:52:42.262096+0800 GCD[5222:795121] suspend...2017-08-18 17:52:42.262496+0800 GCD[5222:795121] sleep 10 second...2017-08-18 17:52:46.263456+0800 GCD[5222:795188] After 5 seconds...2017-08-18 17:52:52.263457+0800 GCD[5222:795121] resume...2017-08-18 17:52:57.264210+0800 GCD[5222:795191] After 5 seconds again... åœ¨dispatch_suspendæŒ‚èµ·é˜Ÿåˆ—åï¼Œç¬¬ä¸€ä¸ªblockè¿˜æ˜¯åœ¨è¿è¡Œï¼Œå¹¶ä¸”æ­£å¸¸è¾“å‡ºã€‚ dispatch_suspendå¹¶ä¸ä¼šç«‹å³æš‚åœæ­£åœ¨è¿è¡Œçš„blockï¼Œè€Œæ˜¯åœ¨å½“å‰blockæ‰§è¡Œå®Œæˆåï¼Œæš‚åœåç»­çš„blockæ‰§è¡Œã€‚ Dispatch Semaphoredispatch_semaphoreåªæœ‰3ä¸ªæ–¹æ³•ï¼š dispatch_semaphore_create æ‰§è¡Œdispatch_semaphore_createä¼šæ ¹æ®ä¼ å…¥çš„longç±»å‹å‚æ•°åˆ›å»ºå¯¹åº”æ•°ç›®çš„ä¿¡å·é‡ dispatch_semaphore_signal æ‰§è¡Œdispatch_semaphore_singalä¼šå¢åŠ ä¸€ä¸ªä¿¡å·é‡ dispatch_semaphore_wait //ç­‰å¾…ä¿¡å·é‡ æ‰§è¡Œdispatch_semaphore_waitå¦‚æœä¿¡å·é‡æ˜¯0ï¼Œå°±ä¼šæ ¹æ®ä¼ å…¥çš„ç­‰å¾…æ—¶é—´æ¥ç­‰å¾…ï¼Œå¦‚æœå¤§äº0åˆ™ä¸ä¼šç­‰å¾…ï¼Œå¹¶ä¸”ä¼šå‡å»ä¸€ä¸ªä¿¡å·é‡ ä½œç”¨ï¼š å¯ä»¥æ§åˆ¶ä¸€ä¸ªèµ„æºæœ€å¤šç”±å¤šå°‘ä¸ªçº¿ç¨‹æ¥è®¿é—®ã€‚ å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼Œç”±äºè®¾å®šçš„ä¿¡å·å€¼ä¸º2ï¼Œå…ˆæ‰§è¡Œä¸¤ä¸ªçº¿ç¨‹ï¼Œç­‰æ‰§è¡Œå®Œå…¶ä¸­ä¸€ä¸ªï¼Œç¬¬ä¸‰ä¸ªæ‰ä¼šç»§ç»­æ‰§è¡Œã€‚ä¿è¯åŒä¸€æ—¶é—´æ‰§è¡Œçš„çº¿ç¨‹æ•°ä¸è¶…è¿‡2ã€‚ 12345678910111213141516171819202122232425262728//crateçš„valueè¡¨ç¤ºï¼Œæœ€å¤šå‡ ä¸ªèµ„æºå¯è®¿é—® dispatch_semaphore_t semaphore = dispatch_semaphore_create(2); dispatch_queue_t quene = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); //ä»»åŠ¡1 dispatch_async(quene, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@\"run task 1\"); sleep(1); NSLog(@\"complete task 1\"); dispatch_semaphore_signal(semaphore); }); //ä»»åŠ¡2 dispatch_async(quene, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@\"run task 2\"); sleep(1); NSLog(@\"complete task 2\"); dispatch_semaphore_signal(semaphore); }); //ä»»åŠ¡3 dispatch_async(quene, ^{ dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); NSLog(@\"run task 3\"); sleep(1); NSLog(@\"complete task 3\"); dispatch_semaphore_signal(semaphore); }); ä¹Ÿå¯ä»¥èµ·åˆ°ç±»ä¼¼æ …æ å‡½æ•°çš„ä½œç”¨ã€‚çº¿ç¨‹Aå’Œçº¿ç¨‹Bï¼šçº¿ç¨‹Aæ‰§è¡Œå®Œä¹‹åçº¿ç¨‹Bå†ç»§ç»­æ‰§è¡Œã€‚ å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼šå…ˆæ‰§è¡Œè·å–tokenæ–¹æ³•ï¼Œåœ¨æ‰§è¡Œrequest 1234567891011121314151617181920212223242526{ //è¿™é‡Œä½¿ç”¨dispatch_asyncï¼Œæ˜¯ä¸ºäº†ä¸é˜»å¡å½“å‰çº¿ç¨‹ã€‚ dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ dispatch_semaphore_t semaphore = dispatch_semaphore_create(0); [self getToken:semaphore]; dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); [self request]; }); NSLog(@\"ç»§ç»­æ‰§è¡Œå•Š\");}//å¼‚æ­¥è¯·æ±‚ï¼Œè·å–token- (void)getToken:(dispatch_semaphore_t)semaphore { dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ for (int i = 0; i &lt; 10000; i++) { NSLog(@\"getToken:%d\",i); } NSLog(@\"getToken:Success\"); dispatch_semaphore_signal(semaphore); });}//æ‰§è¡Œç½‘ç»œè¯·æ±‚- (void)request { NSLog(@\"request\");} é¢˜å¤–è¯ï¼š 123456789&gt; dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);&gt; &gt; NSMutableArray *array = [[NSMutableArray alloc] init];&gt; for (int i = 0; i &lt; 100000; ++i) {&gt; dispatch_async(queue, ^{&gt; [array addObject:[NSNumber numberWithInt:i]];&gt; });&gt; }&gt; &gt; ä¸Šé¢è¿™æ®µä»£ç ä¼šæ‰§è¡Œé”™è¯¯ã€‚æŠ¥é”™å¦‚ä¸‹ï¼š 123&gt; malloc: *** error for object 0x6040003805b0: pointer being freed was not allocated&gt; *** set a breakpoint in malloc_error_break to debug&gt; &gt; ä¸ºä»€ä¹ˆã€ï¼Ÿ dispatch_oncedispatch_onceå‡½æ•°æ˜¯ä¿è¯åœ¨åº”ç”¨ç¨‹åºä¸­åªæ‰§è¡Œä¸€æ¬¡æŒ‡å®šå¤„ç†çš„APIã€‚å•ä¾‹æ¨¡å¼ç»å¸¸ç”¨åˆ°æ­¤å‡½æ•°ã€‚ 1234static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ //code to be executed once }); Dispatch I/O","link":"/2016/07/18/Grand-Central-Dispatch/"},{"title":"CPUå¯»å€èƒ½åŠ›åˆ°åº•æ€ä¹ˆç†è§£ï¼Ÿ","text":"å¯»å€ç©ºé—´è§£é‡Šå¯»å€èƒ½åŠ›ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸‹ å¯»å€ç©ºé—´ ï¼ˆAddressing spaceï¼‰çš„æ¦‚å¿µã€‚ å¯»å€ç©ºé—´ä¸€èˆ¬æŒ‡çš„æ˜¯CPUå¯¹äºå†…å­˜å¯»å€çš„èƒ½åŠ›ã€‚é€šä¿—åœ°è¯´ï¼Œå°±æ˜¯èƒ½æœ€å¤šç”¨åˆ°å¤šå°‘å†…å­˜çš„ä¸€ä¸ªé—®é¢˜ã€‚æ•°æ®åœ¨å­˜å‚¨å™¨(RAM)ä¸­å­˜æ”¾æ˜¯æœ‰è§„å¾‹çš„ ï¼ŒCPUåœ¨è¿ç®—çš„æ—¶å€™éœ€è¦æŠŠæ•°æ®æå–å‡ºæ¥å°±éœ€è¦çŸ¥é“æ•°æ®å­˜æ”¾åœ¨å“ªé‡Œ ï¼Œè¿™æ—¶å€™å°±éœ€è¦æŒ¨å®¶æŒ¨æˆ·çš„æ‰¾ï¼Œè¿™å°±å«åšå¯»å€ï¼Œä½†å¦‚æœåœ°å€å¤ªå¤šè¶…å‡ºäº†CPUçš„èƒ½åŠ›èŒƒå›´ï¼ŒCPUå°±æ— æ³•æ‰¾åˆ°æ•°æ®äº†ã€‚ CPUæœ€å¤§èƒ½æŸ¥æ‰¾å¤šå¤§èŒƒå›´çš„åœ°å€å«åšå¯»å€èƒ½åŠ› ï¼ŒCPUçš„å¯»å€èƒ½åŠ›ä»¥å­—èŠ‚ä¸ºå•ä½ ï¼Œå¦‚32ä½å¯»å€çš„CPUå¯ä»¥å¯»å€2çš„32æ¬¡æ–¹å¤§å°çš„åœ°å€ä¹Ÿå°±æ˜¯4Gï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ32ä½çš„CPUæœ€å¤§èƒ½æ­é…4Gå†…å­˜çš„åŸå›  ï¼Œå†å¤šçš„è¯CPUå°±æ‰¾ä¸åˆ°äº†ã€‚ ä¸Šé¢æåˆ°äº†ä½•ä¸ºå¯»å€èƒ½åŠ›ï¼Ÿå°±æ˜¯CPUæœ€å¤§èƒ½æŸ¥æ‰¾å¤šå¤§èŒƒå›´çš„åœ°å€ã€‚åƒä¸‡ä¸è¦ç†è§£ä¸ºCPUæœ€å¤§èƒ½æŸ¥æ‰¾å¤šå¤§çš„åœ°å€ è™½ç„¶è·Ÿä¸Šä¸€å¥æ¯”ä»…ä»…å°‘äº†ä¸€ä¸ªâ€™èŒƒå›´â€™ï¼Œä½†æ˜¯å®Œå…¨æ˜¯ä¸¤ä¸ªæ„æ€ã€‚ æˆ‘æœ€å¼€å§‹å°±ç†è§£æˆäº† æœ€å¤§èƒ½æŸ¥æ‰¾åˆ°å¤šå¤§çš„åœ°å€ã€‚ã€‚ã€‚ æˆ–è€…ä¹Ÿå¯ä»¥ç†è§£ä¸ºï¼šCPUæœ€å¤šèƒ½æŸ¥æ‰¾å¤šå°‘ä¸ªåœ°å€ ï¼ˆè¿™é‡Œå¤šå°‘ä¸ªåœ°å€ï¼Œå€¼å¾—æ˜¯å¤šå°‘ä¸ªå­˜å‚¨å•å…ƒï¼Œå­˜å‚¨å•ä½æœ€å°å•ä½æ˜¯Byteï¼Œä¸æ˜¯bï¼‰ ã€‚æˆ–è€…å¯ä»¥ç†è§£ä¸º CPUå¯ä»¥å¯¹å¤šå°‘ä¸ªå­˜å‚¨å•å…ƒè¿›è¡Œå¯»å€ åˆ°äº†è¿™é‡Œ åº”è¯¥å°±æ˜ç™½äº†å¯»å€èƒ½åŠ›çš„æ¦‚å¿µï¼Œä½†æ˜¯è¿˜ä¸å¤Ÿã€‚ã€‚ å¯»å€èƒ½åŠ› Byte or Bite?æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š 8086CPUçš„åœ°å€æ€»çº¿å®½åº¦æ˜¯20ï¼Œé‚£ä¹ˆä»–çš„å¯»å€èƒ½åŠ›æ˜¯å¤§å‘¢ çœ‹åˆ°è¿™é‡Œå¦‚æœä¸æ˜ç™½ä»€ä¹ˆæ˜¯åœ°å€æ€»çº¿ï¼Œè¯·çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç«  : å…¥é—¨æ±‡ç¼–è¯­è¨€ åœ°å€æ€»çº¿çš„å®½åº¦å†³å®šäº†CPUçš„å¯»å€èƒ½åŠ›ï¼Œå®½åº¦æ˜¯20ï¼Œä¹Ÿå°±ä»£è¡¨æœ‰20æ ¹å¯¼çº¿ï¼Œ æ¯æ ¹å¯¼çº¿å‘å°„çš„æ˜¯é«˜ã€ä½ç”µä¿¡å·ä¸¤ç§æƒ…å†µï¼Œæ‰€ä»¥å¯»å€èƒ½åŠ›ä¸º 220B = 1M ä½†æ˜¯è¿™é‡Œå¯èƒ½ä¼šå‡ºç°å¾ˆå¤šäººéƒ½çº³é—·çš„é—®é¢˜ï¼Œ20æ ¹å¯¼çº¿ï¼Œä¸å°±æ˜¯20ä½å—ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯220bã€‚é‚£ä¸ºä»€ä¹ˆæ˜¯ 220B ï¼Œè€Œä¸æ˜¯220b å‘¢ï¼Ÿ ï¼ˆBä¸ºByte/å­—èŠ‚ï¼Œbä¸ºbite/ä½ï¼‰ ä½ ï¼Œè¡¨ç¤ºçš„æ˜¯äºŒè¿›åˆ¶ä½ï¼Œä¸€èˆ¬ç§°ä¸ºæ¯”ç‰¹ï¼Œå³0æˆ–1ï¼Œæ˜¯è®¡ç®—æœºå­˜å‚¨çš„æœ€å°å•ä½ å­—èŠ‚æ˜¯è®¡ç®—æœºä¸­æ•°æ®å¤„ç†çš„åŸºæœ¬å•ä½ï¼›è®¡ç®—æœºä»¥å­—èŠ‚ä¸ºå•ä½å­˜å‚¨å’Œè§£é‡Šä¿¡æ¯ï¼Œè§„å®šä¸€ä¸ªå­—èŠ‚ç”±8ä¸ªäºŒè¿›åˆ¶ä½æ„æˆï¼Œå³1B = 8b å› ä¸ºåœ°å€æ€»çº¿çš„å®½åº¦å†³å®šäº†CPUçš„ å¯»å€èƒ½åŠ›ï¼Œé‚£ä½•ä¸ºå¯»å€èƒ½åŠ›å‘¢ï¼Œè¯´é¢æåˆ°äº†ï¼Œå¯»å€èƒ½åŠ›å¯ä»¥ç†è§£ä¸ºCPUå¯ä»¥å¯¹å¤šå°‘ä¸ªå­˜å‚¨å•å…ƒè¿›è¡Œå¯»å€ï¼Œåœ°å€æ€»çº¿æ˜¯20ï¼Œé‚£ä¹ˆå°±ä»£è¡¨æœ€å¤šèƒ½æ‰¾åˆ°220ä¸ªå­˜å‚¨å•å…ƒï¼Œåˆå› ä¸º8086ä¸­ä¸€ä¸ªå­˜å‚¨å•å…ƒæ˜¯1Bæ‰€ä»¥ï¼Œè¿™é‡Œæ˜¯220B çœ‹åˆ°è¿™é‡Œå¯èƒ½åˆä¼šç»§ç»­ç³Šæ¶‚ï¼Œå­˜å‚¨å•å…ƒæ˜¯what?ä¸ºä»€ä¹ˆä¸€ä¸ªå­˜å‚¨å•å…ƒæ˜¯1Bï¼Œæ‰€ä»¥å¾€ä¸‹çœ‹â€¦â€¦ å†…å­˜åœ°å€å’Œå†…å­˜ç©ºé—´åœ¨å¹³æ—¶å¼€å‘ä¸­ï¼Œå¯èƒ½æœ‰æ—¶å€™ä½ çœ‹åˆ°çš„å†…å­˜åœ°å€æ˜¯4ä½16è¿›åˆ¶ï¼ˆ0x0001ï¼‰ï¼Œæœ‰æ—¶å€™ä½ çœ‹åˆ°çš„å†…å­˜åœ°å€æ˜¯8ä½16è¿›åˆ¶(0x00000001)ã€‚è¿™ä¸¤ä¸ªå†…å­˜åœ°å€éƒ½æ˜¯è¡¨ç¤ºç¼–å·ä¸º1çš„å†…å­˜åœ°å€ï¼Œä¸ºä»€ä¹ˆä¸€ä¸ªç”¨4ä½16è¿›åˆ¶ï¼Ÿå¦å¤–ä¸€ä¸ªåˆç”¨8ä½16è¿›åˆ¶ï¼Ÿ(æ³¨æ„ï¼Œ0x0001 å’Œ 0x00000001 ä»…ä»…æ˜¯è¡¨ç¤ºæ–¹å¼ä¸ä¸€æ ·ï¼Œæ•°å€¼å¤§å°å¯æ˜¯ç›¸ç­‰çš„ï¼Œå¯åˆ«æè¿·ç³Šäº†ï¼ï¼‰ è¿™å°±æ˜¯å› ä¸ºå¯»å€èƒ½åŠ›çš„é—®é¢˜ã€‚ä½ å¯»å€èƒ½åŠ›è¾¾ä¸åˆ°8ä½16è¿›åˆ¶ï¼Œæ‰€ä»¥ç”¨4ä½16è¿›åˆ¶è¡¨ç¤ºå°±å¯ä»¥ï¼Œç†è®ºä¸Šä½ ç¡¬è¦ç”¨8ä½16è¿›åˆ¶è¡¨ç¤ºä¹Ÿå¯ä»¥ã€‚åªä¸è¿‡ä½ å¯»å€èƒ½åŠ›ä½ï¼Œä¸å¯èƒ½è¶…è¿‡4ä½ã€‚æ‰€ä»¥ å¯»å€èƒ½åŠ›ä½ï¼Œä¸ä¼šè¶…è¿‡4ä½çš„å°±ç”¨4ä½16è¿›åˆ¶ï¼Œèƒ½å¤Ÿè¶…è¿‡4çš„cpuå°±ç”¨8ä½16è¿›åˆ¶ã€‚ ææ˜ç™½äº†å†…å­˜åœ°å€ï¼Œæ¥ä¸‹æ¥å°±è§£é‡Šä¸€ä¸‹å†…å­˜åœ°å€å’Œ å†…å­˜ç©ºé—´ å†…å­˜åœ°å€ ä»…ä»…æ˜¯ä¸€ä¸ªæ ‡å·ï¼Œä»£è¡¨çš„æ˜¯ä¸€ä¸ª å†…å­˜ç©ºé—´ã€‚åœ¨è®¡ç®—æœºä¸­å­˜å‚¨å™¨çš„å®¹é‡æ˜¯ä»¥å­—èŠ‚Bä¸ºåŸºæœ¬å•ä½çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªå†…å­˜åœ°å€ä»£è¡¨ä¸€ä¸ªå­—èŠ‚ 1B = 8b çš„å­˜å‚¨ç©ºé—´ã€‚ æˆ‘ä»¬å¹³æ—¶ç»å¸¸è¯´32ä½æ“ä½œ ç³»ç»Ÿï¼Œæœ€å¤šæ”¯æŒ4Gå†…å­˜ç©ºé—´ã€‚å°±æ˜¯å› ä¸º232B = 4G æ‰€ä»¥è¿™é‡Œçš„ç»“è®ºå°±æ˜¯ï¼šç”¨4ä½16è¿›åˆ¶è¡¨ç¤ºçš„å†…å­˜åœ°å€å’Œç”¨8ä½16è¿›åˆ¶è¡¨ç¤ºçš„å†…å­˜åœ°å€ï¼Œå…¶å®éƒ½æ˜¯ä»£è¡¨ä¸€ä¸ª8bçš„å­˜å‚¨ç©ºé—´ æ¯”å¦‚ä¸€ä¸ªæ±‰å­—â€œä¸­â€åœ¨è®¡ç®—æœºä¸­æ˜¯å¦‚ä½•å­˜å‚¨å‘¢ï¼Œä¸€ä¸ªæ±‰å­—ï¼Œéœ€è¦ä¸¤ä¸ªå­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯2Bå¤§å°ï¼Œè¿™2Bå­˜å‚¨ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦å…¨éƒ¨æ‰¾åˆ°ï¼Œåªéœ€è¦æ‰¾åˆ°æœ€å¼€å§‹çš„ä¸€éƒ¨åˆ†ï¼Œå°±èƒ½æ‰¾åˆ°è¿™ä¸ªâ€œä¸­â€ æ‰€ä»¥ï¼Œå†…å­˜åœ°å€æ˜¯å†…å¯¸ä¸­å­˜å‚¨æ•°æ®çš„ä¸€ä¸ªæ ‡è¯†ï¼Œå¹¶ä¸æ˜¯æ•°æ®æœ¬èº«ï¼Œé€šè¿‡å†…å­˜åœ°å€å¯ä»¥çŸ¥é“å†…å­˜å½“ä¸­å­˜å‚¨çš„æ•°æ®ã€‚ å¯ä»¥æŠ½è±¡çš„æŠŠå†…å­˜ç©ºé—´æ¯”ä½œæˆ¿å­ğŸ¡ï¼Œå¦‚æœæƒ³è¦æ‰¾åˆ°æˆ¿å­ï¼Œå°±éœ€è¦é€šè¿‡ğŸšªé—¨ç‰Œå·æ¥æ‰¾ï¼Œæ‰€ä»¥å†…å­˜åœ°å€å°±å¯ä»¥æ¯”ä½œé—¨ç‰Œå·ï¼Œé‚£è¿™ä¸ªæˆ¿å­é‡Œå¯èƒ½è¿˜åŒ…æ‹¬æœ‰å¨æˆ¿ã€å§å®¤ã€å«ç”Ÿé—´ï¼Œè¿™äº›ç»Ÿç»Ÿä¸ç”¨ç»§ç»­æ‰¾äº†ï¼Œå› ä¸ºæœ‰äº†é—¨ç‰Œå·ï¼Œå°±èƒ½æ‰¾åˆ°æˆ¿å­ï¼Œæ‰¾åˆ°æˆ¿å­è‡ªç„¶å°±èƒ½æ‰¾æ‰“å±‹é‡Œçš„å¨æˆ¿ã€å§å®¤â€¦â€¦ å‚è€ƒï¼š ã€Šç™¾åº¦ç™¾ç§‘-å¯»å€ç©ºé—´ã€‹) ã€Šæ±‡ç¼–è¯­è¨€è®ºå›ã€‹ ã€Šå†…å­˜æ¦‚å¿µã€‹ ã€Šå…³äºå†…å­˜åœ°å€å’Œå†…å­˜ç©ºé—´çš„æ¦‚å¿µã€‹ ã€Šå†…å­˜åœ°å€ä¸å†…å­˜ç©ºé—´ã€‹","link":"/2018/05/19/CPUå¯»å€èƒ½åŠ›åˆ°åº•æ€ä¹ˆç†è§£ï¼Ÿ/"},{"title":"Objective-Cç±»å¯¹è±¡","text":"ä»€ä¹ˆæ˜¯ç±»å¯¹è±¡ï¼Ÿåœ¨Objective-Cä¸­ä»»ä½•çš„ç±»å®šä¹‰éƒ½æ˜¯å¯¹è±¡ã€‚å³åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ä»»ä½•ç±»å®šä¹‰éƒ½å¯¹åº”äºä¸€å—å†…å­˜ã€‚åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šç»™æ¯ä¸€ä¸ªç±»ç”Ÿæˆä¸€ä¸ªä¸”åªç”Ÿæˆä¸€ä¸ªâ€œæè¿°å…¶å®šä¹‰çš„å¯¹è±¡â€ï¼Œä¹Ÿå°±æ˜¯è‹¹æœå…¬å¸è¯´çš„ç±»å¯¹è±¡ï¼ˆclass objectï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä¾‹ã€‚ ç±»å¯¹è±¡èµ·ä»€ä¹ˆä½œç”¨ï¼ŸObjective-Cæ˜¯ä¸€é—¨å¾ˆåŠ¨æ€çš„è¯­éŸ³ï¼Œå› æ­¤ç¨‹åºé‡Œçš„æ‰€æœ‰å®ä¾‹å¯¹è±¡éƒ½æ˜¯åœ¨è¿è¡Œæ—¶ç”±Objective-Cdçš„è¿è¡Œæ—¶åº“ç”Ÿæˆçš„ï¼Œè€Œè¿™ä¸ªç±»å¯¹è±¡å°±æ˜¯è¿è¡Œæ—¶åº“ç”¨æ¥åˆ›å»ºå®ä¾‹å¯¹è±¡çš„ä¾æ®ã€‚ ClassObjective-Cç±»æ˜¯ç”±Classç±»å‹æ¥è¡¨ç¤ºçš„ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆã€‚å®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š 123// An opaque type that represents an Objective-Cclass.typedef struct objc_class *Class; æŸ¥çœ‹objc/runtime.hä¸­objc_classç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435struct objc_class { Class _Nonnull isa OBJC_ISA_AVAILABILITY; #if !OBJC2 Class _Nullablesuper_class OBJC2_UNAVAILABLE; const char* _Nonnull name OBJC2_UNAVAILABLE; longversion OBJC2_UNAVAILABLE; longinfo OBJC2_UNAVAILABLE; longinstance_size OBJC2_UNAVAILABLE; structobjc_ivar_list * _Nullable ivars OBJC2_UNAVAILABLE; structobjc_method_list * _Nullable * _NullablemethodLists OBJC2_UNAVAILABLE; structobjc_cache * _Nonnull cache OBJC2_UNAVAILABLE; structobjc_protocol_list * _Nullable protocols OBJC2_UNAVAILABLE;#endif } OBJC2_UNAVAILABLE;/* Use Class instead of struct objc_class * */ idä¸objc_objectâ€œobjc_objectâ€æ˜¯è¡¨ç¤ºä¸€ä¸ªç±»çš„å®ä¾‹çš„ç»“æ„ä½“ï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ 12345678910/// Represents an instance of a class.struct objc_object { Class _Nonnullisa OBJC_ISA_AVAILABILITY;}; /// A pointer to an instance of a class.typedef struct objc_object *id; å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç»“æ„ä½“åªæœ‰ä¸€ä¸ªå˜é‡ï¼Œå³æŒ‡å‘å…¶ç±»çš„isaæŒ‡é’ˆã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬å‘ä¸€ä¸ªObjective-Cå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œè¿è¡Œæ—¶åº“ä¼šæ ¹æ®å®ä¾‹å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è¿™ä¸ªå®ä¾‹å¯¹è±¡æ‰€å±çš„ç±»ã€‚Runtimeåº“ä¼šåœ¨ç±»çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠçˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨é‡Œä¸­å¯»æ‰¾ä¸æ¶ˆæ¯å¯¹åº”çš„selectoræŒ‡å‘çš„æ–¹æ³•ã€‚ å½“åˆ›å»ºä¸€ä¸ªç‰¹å®šç±»çš„å®ä¾‹å¯¹è±¡æ—¶ï¼Œåˆ†é…çš„å†…å­˜åŒ…å«ä¸€ä¸ªobjc_objectæ•°æ®ç»“æ„ï¼Œç„¶åæ˜¯ç±»çš„å®ä¾‹å˜é‡çš„æ•°æ®ã€‚NSObjectç±»çš„allochå’ŒallocWithZoneï¼šæ–¹æ³•ä½¿ç”¨å‡½æ•°class_creatInstanceæ¥åˆ›å»ºobjc_objectæ•°æ®ç»“æ„ã€‚ å…ƒç±»ï¼ˆMeta Classï¼‰ä¸Šé¢æåˆ°ï¼Œæ‰€æœ‰çš„ç±»è‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å‘è¿™ä¸ªç±»å‹å‘é€æ¶ˆæ¯ï¼ˆå³è°ƒç”¨ç±»æ–¹æ³•ï¼‰ã€‚ NSArray*array = [ NSArray array]; è¿™ä¸ªä¾‹å­ä¸­ï¼Œ+arrayæ¶ˆæ¯å‘é€ç»™äº†NSArrayç±»ï¼Œè€Œè¿™ä¸ªNSArrayä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚æ—¢ç„¶æ˜¯å¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä¹Ÿæ˜¯ä¸€ä¸ªobjc_objectæŒ‡é’ˆï¼Œå®ƒåŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶ç±»çš„ä¸€ä¸ªisaæŒ‡é’ˆã€‚é‚£ä¹ˆè¿™äº›å°±åˆä¸€ä¸ªé—®é¢˜äº†ã€‚è¿™ä¸ªisaæŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆå‘¢ï¼Ÿä¸ºäº†è°ƒç”¨+arrayæ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„isaæŒ‡é’ˆå¿…é¡»æŒ‡å‘ä¸€ä¸ªåŒ…å«è¿™äº›ç±»æ–¹æ³•çš„ä¸€ä¸ªobjc_classç»“æ„ä½“ã€‚è¿™å°±å¼•å‡ºäº†meta-classçš„æ¦‚å¿µã€‚ meta-class æ˜¯ä¸€ä¸ªç±»å¯¹è±¡çš„ç±»ã€‚ å½“æˆ‘ä»¬å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯æ—¶ï¼Œruntimeä¼šåœ¨è¿™ä¸ªå¯¹è±¡æ‰€å±çš„è¿™ä¸ªç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾æ–¹æ³•ï¼›è€Œå‘ä¸€ä¸ªç±»å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šåœ¨è¿™ä¸ªç±»çš„meta-classçš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ã€‚ meta-classä¹‹æ‰€ä»¥é‡è¦ï¼Œæ˜¯å› ä¸ºå®ƒå­˜å‚¨ç€ä¸€ä¸ªç±»çš„æ‰€æœ‰ç±»æ–¹æ³•ã€‚æ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€ä¸ªå•ç‹¬çš„meta-classï¼Œå› ä¸ºæ¯ä¸ªç±»çš„ç±»æ–¹æ³•åŸºæœ¬ä¸å¯èƒ½å®Œå…¨ç›¸åŒã€‚ å†æ·±å…¥ä¸€ä¸‹ã€‚meta-classä¹Ÿæ˜¯ä¸€ä¸ªç±»ï¼Œä¹Ÿå¯ä»¥å‘å®ƒå‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒçš„isaåˆæ˜¯æŒ‡å‘ä»€ä¹ˆå‘¢ï¼Ÿä¸ºäº†ä¸è®©è¿™ç§ç»“æ„æ— é™å»¶ä¼¸ä¸‹å»ï¼ŒObjective-Cçš„è®¾è®¡è€…è®©æ‰€æœ‰çš„meta-classçš„isaæŒ‡å‘åŸºç±»çš„meta-classï¼Œä»¥æ­¤ä½œä¸ºå®ƒä»¬çš„æ‰€å±ç±»ï¼Œè€ŒåŸºç±»çš„meta-classçš„isaæŒ‡é’ˆæ˜¯æŒ‡å‘å®ƒè‡ªå·±ã€‚è¿™å°±å½¢æˆäº†ä¸€ä¸ªå®Œç¾çš„é—­ç¯ã€‚ 123456789101112131415161718void testMetaClass(id self,SEL _cmd) { NSLog(@\"This object is %p\",self); NSLog(@\"Class is %@,super class is %@\",[self class],[self superclass]); Class currentClass = [self class]; for (int i = 0; i &lt; 4; i++) { NSLog(@\"Following the isa pointer %d times gives %p\",i,currentClass); currentClass = objc_getClass((__bridge void *)currentClass); } NSLog(@\"NSObject's class is %p\",[NSObject class]); NSLog(@\"NSObject's meta class is %p\",objc_getClass((__bridge void*)[NSObject class]));} Class newClass = objc_allocateClassPair([NSError class], \"TestClass\", 0); class_addMethod(newClass, @selector(testMetaClass), (IMP)testMetaClass, \"v@:\"); objc_registerClassPair(newClass); id instance = [[newClass alloc] initWithDomain:@\"some domain\" code:0 userInfo:nil]; [instance performSelector:@selector(testMetaClass)]; æ‰“å°è¾“å‡ºï¼š 1234567891011121314152016-05-08 16:41:43.414952+0800 TestDemo[1759:642703]This object is 0x60400025f3b02016-05-08 16:41:43.415111+0800 TestDemo[1759:642703]Class is TestClass,super class is NSError2016-05-08 16:41:43.415196+0800 TestDemo[1759:642703]Following the isa pointer 0 times gives 0x60400025f4102016-05-08 16:41:43.415306+0800 TestDemo[1759:642703]Following the isa pointer 1 times gives 0x02016-05-08 16:41:43.415398+0800 TestDemo[1759:642703]Following the isa pointer 2 times gives 0x02016-05-08 16:41:43.415608+0800 TestDemo[1759:642703]Following the isa pointer 3 times gives 0x02016-05-08 16:41:43.415697+0800 TestDemo[1759:642703]NSObject's class is 0x102efeea82016-05-08 16:41:43.415783+0800 TestDemo[1759:642703]NSObject's meta class is 0x0 åœ¨forå¾ªç¯ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡objc_getClassæ¥è·å–å¯¹è±¡çš„isaï¼Œå¹¶å°†å…¶æ‰“å°å‡ºæ¥ï¼Œä»¥æ­¤ä¸€ç›´å›æº¯åˆ°NSObjectçš„meta-classã€‚åˆ†ææ‰“å°ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æœ€åæŒ‡é’ˆæŒ‡å‘çš„åœ°å€æ˜¯0x0ã€‚","link":"/2016/05/08/Objective-Cå¯¹è±¡è¯¦è§£/"},{"title":"RAC(ä¸€)å‡½æ•°å“åº”å¼ç¼–ç¨‹æ¦‚è¿°","text":"ReactiveCocoaæ˜¯ä¸€ç§æ–°çš„ç¼–ç¨‹èŒƒå¼(å³å‡½æ•°å“åº”å¼ç¼–ç¨‹)ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŸºç¡€åº“ã€‚æ˜¯åœ¨é¢å‘å¯¹è±¡è¯­è¨€çš„åŸºç¡€ä¸Šï¼Œå¯¹å‡½æ•°å“åº”å¼ç¼–ç¨‹çš„å®ç°ã€‚æœ¬æ–‡ä¸»è¦è®²è§£å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”å¼ç¼–ç¨‹ã€‚ ç¼–ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿæ ¹æ®å†¯è¯ºä¾æ›¼ä½“ç³»ç»“æ„ã€‚ç¼–ç¨‹å°±æ˜¯ï¼šå¯¹è¾“å…¥è®¾å¤‡è¿›è¡Œé‡‡æ ·ï¼Œæœ€ç»ˆé€šè¿‡è®¡ç®—è®¾å¤‡è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°çš„ç»“æœé€šè¿‡è¾“å‡ºè®¾å¤‡è¾“å‡ºï¼Œè¿™å°±æ˜¯ç¼–ç¨‹ã€‚ ç¼–ç¨‹ä¹Ÿå¯ä»¥æ˜¯ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œå½¢æˆä¸€ç§ä¸šåŠ¡æ¨¡å¼ï¼Œæœ€åé€šè¿‡æŠŠè¿™ä¸ªæ¨¡å¼è½¬æ¢ä¸ºä»£ç å®ç°çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚ é¢å‘è¿‡ç¨‹ vs é¢å‘å¯¹è±¡â€œé¢å‘è¿‡ç¨‹â€å’Œâ€œé¢å‘å¯¹è±¡â€æŒ‡çš„æ˜¯ç¼–ç¨‹æ€æƒ³ï¼Œå®ƒä»¬å±äºåŒä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œéƒ½æ˜¯å‘½ä»¤å¼ç¼–ç¨‹ã€‚ å‘½ä»¤å¼ç¼–ç¨‹ vs å‡½æ•°å¼ç¼–ç¨‹æ‰€æœ‰çš„å‘½ä»¤å¼ç¼–ç¨‹éƒ½è¢«è®¾è®¡æ¥é«˜æ•ˆåœ°ä½¿ç”¨å†¯è¯ºä¾æ›¼ä½“ç³»ç»“æ„çš„è®¡ç®—æœºã€‚å®é™…ä¸Šï¼Œæœ€åˆçš„å‘½ä»¤å¼è¯­è¨€çš„ç›®çš„å°±æ˜¯å–ä»£æ±‡ç¼–è¯­è¨€ï¼Œå¯¹æœºå™¨æŒ‡ä»¤è¿›è¡Œè¿›ä¸€æ­¥æŠ½è±¡ã€‚å› æ­¤ï¼Œå‘½ä»¤å¼è¯­è¨€å¸¦æœ‰å¼ºçƒˆçš„ç¡¬ä»¶ç»“æ„ç‰¹å¾ã€‚å‘½ä»¤å¼è¯­è¨€çš„æ ¸å¿ƒç‰¹æ€§æœ‰ï¼šæ¨¡æ‹Ÿå­˜å‚¨å•å…ƒçš„å˜é‡ã€åŸºäºä¼ è¾“æ“ä½œçš„èµ‹å€¼è¯­å¥ï¼Œä»¥åŠè¿­ä»£å½¢å¼çš„å¾ªç¯è¿ç®—ã€‚å‘½ä»¤å¼è¯­è¨€çš„åŸºç¡€æ˜¯è¯­å¥ï¼ˆç‰¹åˆ«æ˜¯èµ‹å€¼ï¼‰ï¼Œå®ƒä»¬é€šè¿‡ä¿®æ”¹å­˜å‚¨å™¨çš„å€¼è€Œäº§ç”Ÿå‰¯ä½œç”¨çš„æ–¹å¼å»å½±å“åç»­çš„è®¡ç®—ã€‚ å‡½æ•°å¼è¯­è¨€è®¾è®¡çš„åŸºç¡€æ˜¯æ•°å­¦å‡½æ•°ï¼Œå‡½æ•°å¼ç¨‹åºè®¾è®¡æŠŠç¨‹åºçš„è¾“å‡ºå®šä¹‰ä¸ºå…¶è¾“å…¥çš„ä¸€ä¸ªæ•°å­¦å‡½æ•°ï¼Œåœ¨è¿™é‡Œæ²¡æœ‰å†…éƒ¨çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰å‰¯ä½œç”¨ã€‚å‡½æ•°å¼è¯­è¨€è¿›è¡Œè®¡ç®—çš„ä¸»è¦æ˜¯å°†å‡½æ•°ä½œç”¨ä¸ç»™å®šå‚æ•°ä¹‹ä¸Šã€‚å‡½æ•°å¼è¯­è¨€æ²¡æœ‰å‘½ä»¤å¼è¯­è¨€æ‰€å¿…éœ€çš„é‚£ç§å˜é‡ï¼Œå¯ä»¥æ²¡æœ‰èµ‹å€¼è¯­å¥ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰å¾ªç¯ã€‚ä¸€ä¸ªç¨‹åºå°±æ˜¯å‡½æ•°å®šä¹‰å’Œå‡½æ•°åº”ç”¨çš„è¯´æ˜ï¼›ä¸€ä¸ªç¨‹åºçš„æ‰§è¡Œå°±æ˜¯å¯¹å‡½æ•°åº”ç”¨çš„æ±‚å€¼ã€‚ çœ‹ä¸‹é¢ä¸¤æ®µä»£ç ï¼ŒåŠŸèƒ½éƒ½ä¸ºæ±‚ä¸€ä¸ªæ•°çš„é˜¶ä¹˜ï¼ˆn!ï¼‰ï¼Œä¸‹é¢ä¸¤æ®µä»£ç åˆ†åˆ«ä»£è¡¨äº†å‘½ä»¤å¼ç¼–ç¨‹ å’Œ å‡½æ•°å¼ç¼–ç¨‹ã€‚ 12345678//å‘½ä»¤å¼ç¼–ç¨‹int factorial1(int x) { int result = 1; for (int i = 0; i &lt;= x; ++i) { result *= i } return result;} 12345//å‡½æ•°å¼ç¼–ç¨‹int factorial2(int x) { if (x == 1) return; return x * factorial2(x-1);} ä¸éš¾ç†è§£ï¼Œä¸¤ä¸ªæ–¹æ³•çš„ä½œç”¨ç›¸åŒã€‚éƒ½ä¸ºæ±‚ä¸€ä¸ªæ•°çš„é˜¶ä¹˜ï¼ˆn!ï¼‰ã€‚é‚£ä¹ˆä¸¤æ®µä»£ç æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ çœ‹å¾…è¿ç®—ä¸æ‡‚ factorial1æŠŠè¿ç®—çœ‹åšæ˜¯cpuçš„è¿ç®—ï¼Œæœ‰å­˜å‚¨ï¼Œåˆ›å»ºã€è®¡ç®—ï¼Œè¿”å›å€¼ï¼ˆåŸºäºå†¯è¯ºä¾æ›¼ä½“ç³»ç»“æ„ï¼‰ã€‚ factorial2æ›´æ¥è¿‘æ•°å­¦è®¡ç®—ï¼Œæ›´å¤šçš„æ˜¯æè¿°ä¸€ç§è¿ç®—ã€‚nçš„é˜¶ä¹˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿé‚£å°±æ˜¯n! = n * (n-1)!ã€‚æ‰€ä»¥factorial2å°±æ˜¯åœ¨è¡¨è¿°è¿™ç§è¿ç®—ã€‚ factorial1æ˜¯åŸºäºè¯­å¥çš„(èµ‹å€¼è¯­å¥ã€forå¾ªç¯è¯­å¥)ï¼Œfactorial2æ˜¯åŸºäºè¡¨è¾¾å¼çš„ï¼ˆè¡¨è¾¾å¼æ˜¯æŒ‡æœ‰å€¼è¿”å›çš„å°±å«åšè¡¨è¾¾å¼ï¼‰ã€‚ factorial1æ˜¯åŸºäºçŠ¶æ€é‡çš„ï¼Œå°±æ˜¯ä»£ç ä¸­çš„resultï¼Œè¦èµ‹å€¼ï¼Œæ¯”è¾ƒã€‚factorial2æ˜¯åŸºäºä¸å˜é‡çš„ï¼Œä»£ç ä¸­æ²¡æœ‰ä»»ä½•ä¿®æ”¹å€¼çš„æ“ä½œã€‚ factorial1 ä¸ factorial2çš„å¯¹æ¯”ï¼Œä¹Ÿå°±æ˜¯å‘½ä»¤å¼ç¼–ç¨‹ä¸å‡½æ•°å¼ç¼–ç¨‹çš„å¯¹æ¯”ã€‚åƒæˆ‘ä»¬å¹³æ—¶æ¥è§¦çš„cã€ocã€javaéƒ½æ˜¯å‘½ä»¤å¼ç¼–ç¨‹å¾ˆå°‘ä¼šæ¥è§¦åˆ°çº¯å‡½æ•°å¼ç¼–ç¨‹çš„ç¼–ç¨‹è¯­è¨€,æ¯”å¦‚Erlangã€clojureã€Scalaã€‚ æ€»ç»“å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹ç‚¹ å‡½æ•°æ˜¯â€œç¬¬ä¸€ç­‰å…¬æ°‘â€ æ‰€è°“â€œç¬¬ä¸€ç­‰å…¬æ°‘â€ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°ä¸å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·ï¼Œå¤„äºå¹³ç­‰åœ°ä½ï¼Œå¯ä»¥èµ‹å€¼ç»™å…¶ä»–å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥å¦ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…ä½œä¸ºåˆ«çš„å‡½æ•°çš„è¿”å›å€¼ã€‚ åªç”¨è¡¨è¾¾å¼ï¼Œä¸ç”¨è¯­å¥ â€œè¡¨è¾¾å¼â€æ˜¯ä¸€ä¸ªå•çº¯çš„è¿ç®—è¿‡ç¨‹ï¼Œæ€»æ˜¯æœ‰è¿”å›å€¼ï¼›â€è¯­å¥â€ï¼ˆstatementï¼‰æ˜¯æ‰§è¡ŒæŸç§æ“ä½œï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚å‡½æ•°å¼ç¼–ç¨‹è¦æ±‚ï¼Œåªä½¿ç”¨è¡¨è¾¾å¼ï¼Œä¸ä½¿ç”¨è¯­å¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ­¥éƒ½æ˜¯å•çº¯çš„è¿ç®—ï¼Œè€Œä¸”éƒ½æœ‰è¿”å›å€¼ã€‚ åŸå› æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„å¼€å‘åŠ¨æœºï¼Œä¸€å¼€å§‹å°±æ˜¯ä¸ºäº†å¤„ç†è¿ç®—ï¼ˆcomputationï¼‰ï¼Œä¸è€ƒè™‘ç³»ç»Ÿçš„è¯»å†™ï¼ˆI/Oï¼‰ã€‚â€è¯­å¥â€å±äºå¯¹ç³»ç»Ÿçš„è¯»å†™æ“ä½œï¼Œæ‰€ä»¥å°±è¢«æ’æ–¥åœ¨å¤–ã€‚ å½“ç„¶ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œä¸åšI/Oæ˜¯ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œå‡½æ•°å¼ç¼–ç¨‹åªè¦æ±‚æŠŠI/Oé™åˆ¶åˆ°æœ€å°ï¼Œä¸è¦æœ‰ä¸å¿…è¦çš„è¯»å†™è¡Œä¸ºï¼Œä¿æŒè®¡ç®—è¿‡ç¨‹çš„å•çº¯æ€§ã€‚ æ²¡æœ‰â€œå‰¯ä½œç”¨â€ æ‰€è°“â€œå‰¯ä½œç”¨â€ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°å†…éƒ¨ä¸å¤–éƒ¨äº’åŠ¨ï¼ˆæœ€å…¸å‹çš„æƒ…å†µï¼Œå°±æ˜¯ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ï¼‰ï¼Œäº§ç”Ÿè¿ç®—ä»¥å¤–çš„å…¶ä»–ç»“æœã€‚ å‡½æ•°å¼ç¼–ç¨‹å¼ºè°ƒæ²¡æœ‰â€å‰¯ä½œç”¨â€ï¼Œæ„å‘³ç€å‡½æ•°è¦ä¿æŒç‹¬ç«‹ï¼Œæ‰€æœ‰åŠŸèƒ½å°±æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å€¼ï¼Œæ²¡æœ‰å…¶ä»–è¡Œä¸ºï¼Œå°¤å…¶æ˜¯ä¸å¾—ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ã€‚ è¿™ä¸ªä¸å¤ªå®¹æ˜“ç†è§£ï¼Œé€šä¿—ä¸€ç‚¹çš„è¯´ï¼Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨å‘½ä»¤å¼ç¼–ç¨‹å¼€å‘å·¥ç¨‹ä¸­æœ‰ç»å¸¸ä¼šæœ‰å¦‚ä¸‹åœºæ™¯ï¼šfun1()è°ƒç”¨å®Œä¹‹åæ‰èƒ½è°ƒç”¨fun2()ã€‚é‚£è¿™ç§æƒ…å†µåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å°±ä¸ä¼šå‡ºç°ã€‚å› ä¸ºæ¯ä¸ªå‡½æ•°éƒ½æ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„ï¼Œä¸å½±å“å¤–éƒ¨å˜é‡ï¼Œæ‰€ä»¥func1()è¿˜æ˜¯func2è°å…ˆè°ƒç”¨ï¼Œéƒ½æ— æ‰€è°“ã€‚ ä¸ä¿®æ”¹çŠ¶æ€ ä¸Šä¸€ç‚¹å·²ç»æåˆ°ï¼Œå‡½æ•°å¼ç¼–ç¨‹åªæ˜¯è¿”å›æ–°çš„å€¼ï¼Œä¸ä¿®æ”¹ç³»ç»Ÿå˜é‡ã€‚å› æ­¤ï¼Œä¸ä¿®æ”¹å˜é‡ï¼Œä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ã€‚åœ¨å…¶ä»–ç±»å‹çš„è¯­è¨€ä¸­ï¼Œå˜é‡å¾€å¾€ç”¨æ¥ä¿å­˜â€çŠ¶æ€â€ã€‚ä¸ä¿®æ”¹å˜é‡ï¼Œæ„å‘³ç€çŠ¶æ€ä¸èƒ½ä¿å­˜åœ¨å˜é‡ä¸­ã€‚å‡½æ•°å¼ç¼–ç¨‹ä½¿ç”¨å‚æ•°ä¿å­˜çŠ¶æ€ï¼Œæœ€å¥½çš„ä¾‹å­å°±æ˜¯é€’å½’ã€‚ å¼•ç”¨é€æ˜ å¼•ç”¨é€æ˜ï¼ŒæŒ‡çš„æ˜¯å‡½æ•°çš„è¿è¡Œä¸ä¾èµ–äºå¤–éƒ¨å˜é‡æˆ–â€çŠ¶æ€â€ï¼Œåªä¾èµ–äºè¾“å…¥çš„å‚æ•°ï¼Œä»»ä½•æ—¶å€™åªè¦å‚æ•°ç›¸åŒï¼Œå¼•ç”¨å‡½æ•°æ‰€å¾—åˆ°çš„è¿”å›å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚ æœ‰äº†å‰é¢çš„ç¬¬ä¸‰ç‚¹å’Œç¬¬å››ç‚¹ï¼Œè¿™ç‚¹æ˜¯å¾ˆæ˜¾ç„¶çš„ã€‚å…¶ä»–ç±»å‹çš„è¯­è¨€ï¼Œå‡½æ•°çš„è¿”å›å€¼å¾€å¾€ä¸ç³»ç»ŸçŠ¶æ€æœ‰å…³ï¼Œä¸åŒçš„çŠ¶æ€ä¹‹ä¸‹ï¼Œè¿”å›å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™å°±å«â€å¼•ç”¨ä¸é€æ˜â€ï¼Œå¾ˆä¸åˆ©äºè§‚å¯Ÿå’Œç†è§£ç¨‹åºçš„è¡Œä¸ºã€‚ æƒ°æ€§è®¡ç®—ï¼ˆï¼Ÿï¼Ÿæœ‰ç‚¹ç–‘é—®å‡½æ•°å¼ç¼–ç¨‹çš„æƒ°æ€§æ±‚å€¼ï¼‰ å“åº”å¼ç¼–ç¨‹åœ¨è®¡ç®—æœºä¸­ï¼Œå“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­çš„ç¼–ç¨‹èŒƒå¼ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å¾ˆæ–¹ä¾¿åœ°è¡¨è¾¾é™æ€æˆ–åŠ¨æ€çš„æ•°æ®æµï¼Œè€Œç›¸å…³çš„è®¡ç®—æ¨¡å‹ä¼šè‡ªåŠ¨å°†å˜åŒ–çš„å€¼é€šè¿‡æ•°æ®æµè¿›è¡Œä¼ æ’­ã€‚ ä¾‹å¦‚ï¼Œåœ¨å‘½ä»¤å¼ç¼–ç¨‹ç¯å¢ƒä¸­ï¼Œa=b+cè¡¨ç¤ºå°†è¡¨è¾¾å¼çš„ç»“æœèµ‹ç»™aï¼Œè€Œä¹‹åæ”¹å˜bæˆ–cçš„å€¼ä¸ä¼šå½±å“aã€‚ä½†åœ¨å“åº”å¼ç¼–ç¨‹ä¸­ï¼Œaçš„å€¼ä¼šéšç€bæˆ–cçš„æ›´æ–°è€Œæ›´æ–°ã€‚ ç”µå­è¡¨æ ¼ç¨‹åºå°±æ˜¯å“åº”å¼ç¼–ç¨‹çš„ä¸€ä¸ªä¾‹å­ã€‚å•å…ƒæ ¼å¯ä»¥åŒ…å«å­—é¢å€¼æˆ–ç±»ä¼¼â€=B1+C1â€çš„å…¬å¼ï¼Œè€ŒåŒ…å«å…¬å¼çš„å•å…ƒæ ¼çš„å€¼ä¼šä¾æ®å…¶ä»–å•å…ƒæ ¼çš„å€¼çš„å˜åŒ–è€Œå˜åŒ– ã€‚ åœ¨ioså¼€å‘ä¸­ï¼Œautolayoutå°±æ˜¯ä½¿ç”¨äº†å“åº”å¼ç¼–ç¨‹ã€‚å“åº”å¼ç¼–ç¨‹ç†è§£èµ·æ¥åº”è¯¥ä¼šç®€å•ä¸€ç‚¹ï¼Œè¿™é‡Œå°±ä¸å¤šè§£é‡Šã€‚ ReactiveCocoaæ˜¯ä»€ä¹ˆï¼Ÿä¸Šé¢è®²äº†å‡½æ•°å¼ç¼–ç¨‹ å’Œ å“åº”å¼ç¼–ç¨‹ã€‚é‚£ä¹ˆReactiveCocoa å°±æ˜¯ç»“åˆäº†å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”å¼ç¼–ç¨‹çš„ç‰¹ç‚¹ï¼š å‡½æ•°å¼ç¼–ç¨‹ï¼šå°†è¿ç®—è¿‡ç¨‹å°½é‡å†™æˆä¸€äº›åˆ—çš„å‡½æ•°è°ƒç”¨ã€‚ å“åº”å¼ç¼–ç¨‹ï¼šé¢å¯¹ç¦»æ•£æ•°æ®æµä»¥åŠå¯¹ç¦»æ•£æ•°æ®æµè¿›è¡Œæ“ä½œã€‚ ï¼Œæä¾›åŸºäºæ—¶é—´å˜åŒ–çš„æ•°æ®æµçš„ç»„åˆå’Œå˜æ¢ï¼Œå°†è¾“å…¥è½¬åŒ–ä¸ºè¾“å‡ºåœ¨æ—¶é—´ä¸Šçš„æŒç»­è¿‡ç¨‹çš„ä¸€ç§æ–¹å¼ã€‚","link":"/2016/12/14/RAC-ä¸€-å‡½æ•°å¼ç¼–ç¨‹æ¦‚è¿°/"},{"title":"RAC(ä¸‰)RACSignalå„ç±»æ“ä½œ","text":"è·å¾—ä¸€ä¸ªä¿¡å·çš„æ–¹å¼å•å…ƒä¿¡å·1234RACSignal *signal1 = [RACSignal return:@\"Some value\"];RACSignal *signal2 = [RACSignal error:errorObject];RACSignal *signal3 = [RACSignal empty];RACSignal *signal4 = [RACSignal never]; åŠ¨æ€ä¿¡å·123456789RACSignal *signal5 = [RACSignal createSignal:^RACDisposable * _Nullable(id&lt;RACSubscriber&gt; _Nonnull subscriber) { [subscriber sendNext:@1]; [subscriber sendNext:@2]; [subscriber sendError:errorObject]; [subscriber sendCompleted]; return [RACDisposable disposableWithBlock:^{ }];}]; Cocoaæ¡¥æ¥1234RACSignal *signal6 = [button rac_signalForSelector:@selector(setFrame:)];RACSignal *signal7 = [button rac_signalForControlEvents:UIControlEventTouchUpInside];RACSignal *signal8 = [button rac_willDeallocSignal];RACSignal *signal9 = RACObserve(button, backgroundColor); ä¿¡å·å˜æ¢123RACSignal *signal10 = [signal1 map:^id _Nullable(NSString* _Nullable value) { return [value substringFromIndex:1]; }] åºåˆ—è½¬æ¢1RACSignal *signal11 = [RACSequence return:@1].signal; è®¢é˜…ä¸€ä¸ªä¿¡å·çš„æ–¹å¼æ³¨æ„Signalæ˜¯push-driven(æ¨é©±åŠ¨) åŸºæœ¬è®¢é˜…æ–¹æ³• subscribe1234567[signal1 subscribeNext:^(id _Nullable x) { NSLog(@\"%@\",x);} error:^(NSError * _Nullable error) { NSLog(@\"%@\",error);} completed:^{ NSLog(@\"complete\");}]; ç»‘å®š1RAC(view,backgroundColor) = signal10; Cocoaæ¡¥æ¥123[view rac_liftSelector:@selector(convertPoint:toView:) withSignals:signal1,signal2, nil];[view rac_liftSelector:@selector(convertPoint:toView:) withSignalsFromArray:@[signal1,signal2]];[view rac_liftSelector:@selector(convertPoint:toView:) withSignalOfArguments:signal5]; åˆ†æè®¢é˜…è¿‡ç¨‹RACSignalçš„å¸¸è§ç”¨æ³•ï¼š 123456789101112131415 // part 1:[RACSignal createSignal]æ¥è·å¾—signal RACSignal *signal = [RACSignal createSignal:^RACDisposable * _Nullable(id&lt;RACSubscriber&gt; _Nonnull subscriber) { // part 3: è¿›å…¥didSubscribeï¼Œé€šè¿‡[subscriber sendNext:]æ¥æ‰§è¡Œnext block [subscriber sendNext:@1]; [subscriber sendNext:@2]; [subscriber sendCompleted]; return nil;//è¿™é‡Œå¿½ç•¥RACDisposableï¼Œæš‚æ—¶ä¸è®² }]; // part 2 : [signal subscribeNext:]æ¥è·å¾—subscriberï¼Œç„¶åè¿›è¡Œsubscriptionï¼Œerrorå’Œcompleteä¸è®¨è®ºä¸nextä¸€æ ·ã€‚ï¼ˆRACSignalé‡Œé¢ä¿å­˜çš„äº‹ä»¶åˆ†ä¸º3ä¸­ã€‚ä¸€ç§æ˜¯å€¼valueï¼Œä¸€ç§æ˜¯errorï¼Œä¸€ç§æ˜¯completeã€‚ï¼‰ [signal subscribeNext:^(id _Nullable x) { //... }];} RACSignalçš„Subscriptionè¿‡ç¨‹æ¦‚æ‹¬èµ·æ¥å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š æ­¥éª¤ä¸€ï¼š[RACSignal createSignal]æ¥è·å¾—signal12345678910//RACSignal.mä¸­ï¼š+ ( RACSignal *)createSignal:( RACDisposable * (^)( id &lt; RACSubscriber &gt; subscriber))didSubscribe { return [ RACDynamicSignal createSignal :didSubscribe];}//RACDynamicSignal.mä¸­+ ( RACSignal *)createSignal:( RACDisposable * (^)( id &lt; RACSubscriber &gt; subscriber))didSubscribe { RACDynamicSignal *signal = [[ self alloc ] init ]; signal-&gt; _didSubscribe = [didSubscribe copy ]; return [signal setNameWithFormat : @\"+createSignal:\" ];} [RACSignal createSignal]ä¼šè°ƒç”¨å­ç±»RACDynamicSignalçš„createSignalæ¥è¿”å›ä¸€ä¸ªsignalï¼Œå¹¶åœ¨signalä¸­ä¿å­˜åé¢çš„ didSubscribeè¿™ä¸ªblock æ­¥éª¤äºŒï¼š[signal subscribeNext:]æ¥è·å¾—subscriberï¼Œç„¶åè¿›è¡Œsubscription12345678910111213141516171819202122232425262728//RACSignal.mä¸­ï¼š- ( RACDisposable *)subscribeNext:( void (^)( id x))nextBlock { RACSubscriber *o = [ RACSubscriber subscriberWithNext :nextBlock error : NULL completed : NULL ]; return [ self subscribe :o];}//RACSubscriber.mä¸­ï¼š+ ( instancetype )subscriberWithNext:( void (^)( id x))next error:( void (^)( NSError *error))error completed:( void (^)( void ))completed { RACSubscriber *subscriber = [[ self alloc ] init ]; subscriber-&gt; _next = [next copy ]; subscriber-&gt; _error = [error copy ]; subscriber-&gt; _completed = [completed copy ]; return subscriber;}//RACDynamicSignal.mä¸­ï¼š- (RACDisposable *)subscribe:(id&lt;RACSubscriber&gt;)subscriber { RACCompoundDisposable *disposable = [RACCompoundDisposable compoundDisposable]; subscriber = [[RACPassthroughSubscriber alloc] initWithSubscriber:subscriber signal:self disposable:disposable]; if (self.didSubscribe != NULL) { RACDisposable *schedulingDisposable = [RACScheduler.subscriptionScheduler schedule:^{ RACDisposable *innerDisposable = self.didSubscribe(subscriber); [disposable addDisposable:innerDisposable]; }]; [disposable addDisposable:schedulingDisposable]; } return disposable;} [signal subscribeNext]å…ˆä¼šè·å¾—ä¸€ä¸ªsubscriberï¼Œè¿™ä¸ªsubscriberä¸­ä¿å­˜äº†nextBlockã€errorBlockã€completedBlock ç”±äºè¿™ä¸ªsignalå…¶å®æ˜¯RACDynamicSignalç±»å‹çš„ï¼Œè¿™ä¸ª[self subscribe]æ–¹æ³•ä¼šè°ƒç”¨æ­¥éª¤ä¸€ä¸­ä¿å­˜çš„didSubscribeï¼Œå‚æ•°å°±æ˜¯1ä¸­çš„subscriber æ­¥éª¤ä¸‰ï¼šè¿›å…¥didSubscribeï¼Œé€šè¿‡[subscriber sendNext:]æ¥æ‰§è¡Œnext block12345678//RACSubscriber.mä¸­ï¼š- (void)sendNext:(id)value { @synchronized (self) { void (^nextBlock)(id) = [self.next copy]; if (nextBlock == nil) return; nextBlock(value); }} signalçš„subscriptionè¿‡ç¨‹å›é¡¾ä»ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬çœ‹å‡ºï¼š å…ˆé€šè¿‡createSignalå’ŒsubscribeNextè¿™ä¸¤ä¸ªè°ƒç”¨ï¼Œå£°æ˜äº†æµä¸­valueåˆ°æ¥æ—¶çš„å¤„ç†æ–¹å¼ didSubscribe blockå—ä¸­å¼‚æ­¥å¤„ç†å®Œæ¯•ä¹‹åï¼Œsubscriberè¿›è¡ŒsendNextï¼Œè‡ªåŠ¨å¤„ç† RACTupleRACå®šä¹‰çš„ä¸€ç§æ•°æ®ç±»å‹ã€‚ç±»ä¼¼Swiftä¸­çš„tupleã€‚è¿™é‡Œä¸å¤šä»‹ç»ã€‚ 12345RACTuple *tuple = RACTuplePack(@1,@\"haha\");id first = tuple.first;id last = tuple.last;id idnex1 = tuple[1];RACTupleUnpack(NSNumber *num,NSString *str) = tuple; RACSignalå„ç±»æ“ä½œ å¯¹å€¼æ“ä½œmap/mapReplace reduceEachåªèƒ½ç”¨åœ¨tupleä¸Šã€‚tupleä¸ªæ•°å°‘äº†ä¼šæŒ‚ï¼Œå¤šäº†åªå»å’Œå‚æ•°ç›¸åŒçš„ä¸ªæ•°ã€‚ Scan å…¶ä»–not/and/or/reduceApply/materialize/dematerialize; å¯¹æ•°é‡æ“ä½œfilter ignore/ignoreValues/distinctUntilChangedè¿™å‡ ä¸ªæ ¹æ®è‹±æ–‡å¾ˆå®¹æ˜“ç†è§£ take skip å…¶ä»– startWith Repeat retry collect Aggregate å‰¯ä½œç”¨æ“ä½œdoNext æ—¶é—´æ“ä½œDelay Throttle ç»„åˆæ“ä½œConcat Merge mergeç”¨å¤„å¾ˆå¤šï¼Œå¦‚ä¸‹ï¼š 123RACSignal *appearSignal = [[self rac_signalForSelector:@selector(viewDidAppear:)]] mapReplace:@YES];RACSignal *disappearSignal = [[self rac_signalForSelector:@selector(viewWillDisAppear:)]] mapReplace:@NO];RACSignal *activeSignal = [RACSignal merge:@[appearSignal,disappearSignal]]; Zip CombineLatest Sample TakeUntil TakeUntilReplacement","link":"/2017/01/08/RAC-ä¸‰-RACSignalåŸºæœ¬ä½¿ç”¨/"},{"title":"RAC(å››)ä¿¡å·é«˜é˜¶æ“ä½œ","text":"é«˜é˜¶ä¿¡å·å¯¹æ•°ç»„çš„æ“ä½œå¯ä»¥æœ‰äºŒç»´æ•°ç»„ï¼Œå¤šç»´æ•°ç»„ã€‚åŒæ ·ï¼Œä¿¡å·ä¹Ÿæ˜¯å¯ä»¥åµŒå¥—çš„ï¼Œç»å¸¸ä¼šé‡åˆ°äºŒç»´ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯ä¿¡å·ä¸­å‘é€çš„å€¼ä¹Ÿä¸ºä¿¡å·ã€‚ å‡é˜¶å’Œé™é˜¶(ä¸‹å›¾è±å½¢å›¾ä¾‹ä»£è¡¨ä¿¡å·ï¼Œåœ†åœˆä»£è¡¨å€¼) åˆ›å»ºé«˜é˜¶ä¿¡å·123456RACSiganl *siganl = [RACSignal return:@1];RACSiganl *signalHighOrder = [RACSiganl return:signal];RACSiganl *anotherSignal = [signal map:^id(id value) { return [RACSignal return:value];}]; è®¢é˜…é«˜çº§ä¿¡å·123456RACSiganl *siganl = @[@1,@2,@3].rac_sequence.signal;RACSignal *highOrderSignal = [signal map:^id(RACSiganl *aSiganl) { [aSignal subscribeNext:^(id x) { //... }];}]; é™é˜¶æ“ä½œSwitchToLatests ä½¿ç”¨switchToLatestsæ–¹æ³•é™é˜¶æ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ–°çš„ä¿¡å·ä¼šæŠŠæ—§çš„ä¿¡å·æˆªæ–­ if/then/else çœ‹ä¸€ä¸‹ifThenElseæ–¹æ³•çš„å®ç°ä»£ç ï¼Œå¯ä»¥å¾ˆå®¹æ˜“ç†è§£ã€‚å®ƒçš„æœ¬è´¨è¿˜æ˜¯ä½¿ç”¨äº†SwitchToLatestsã€‚ 1234567891011121314+ (RACSignal *)if:(RACSignal *)boolSignal then:(RACSignal *)trueSignal else:(RACSignal *)falseSignal { NSCParameterAssert(boolSignal != nil); NSCParameterAssert(trueSignal != nil); NSCParameterAssert(falseSignal != nil); return [[[boolSignal map:^(NSNumber *value) { NSCAssert([value isKindOfClass:NSNumber.class], @&quot;Expected %@ to send BOOLs, not %@&quot;, boolSignal, value); return (value.boolValue ? trueSignal : falseSignal); }] switchToLatest] setNameWithFormat:@&quot;+if: %@ then: %@ else: %@&quot;, boolSignal, trueSignal, falseSignal];} ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰SwitchCasesDefaultSignal: 1234567891011121314151617181920212223242526+ (RACSignal *)switch:(RACSignal *)signal cases:(NSDictionary *)cases default:(RACSignal *)defaultSignal { NSCParameterAssert(signal != nil); NSCParameterAssert(cases != nil); for (id key in cases) { id value __attribute__((unused)) = cases[key]; NSCAssert([value isKindOfClass:RACSignal.class], @\"Expected all cases to be RACSignals, %@ isn't\", value); } NSDictionary *copy = [cases copy]; return [[[signal map:^(id key) { if (key == nil) key = RACTupleNil.tupleNil; RACSignal *signal = copy[key] ?: defaultSignal; if (signal == nil) { NSString *description = [NSString stringWithFormat:NSLocalizedString(@\"No matching signal found for value %@\", @\"\"), key]; return [RACSignal error:[NSError errorWithDomain:RACSignalErrorDomain code:RACSignalErrorNoMatchingCase userInfo:@{ NSLocalizedDescriptionKey: description }]]; } return signal; }] switchToLatest] setNameWithFormat:@\"+switch: %@ cases: %@ default: %@\", signal, cases, defaultSignal];} Flatten flattenä¸SwitchToLatestsä¸åŒçš„æ˜¯ï¼Œæ–°çš„ä¿¡å·ä¸ä¼šæˆªæ–­æ—§çš„ä¿¡å·ã€‚å®ƒç›¸å½“äºæ˜¯ä½¿ç”¨**merge:æ–¹æ³•æŠŠä¿¡å·ä¸­çš„æ‰€æœ‰ä¿¡å·éƒ½åˆå¹¶åœ¨äº†ä¸€èµ·ã€‚ flattenï¼šè¿™ä¸ªå¸¦å‚æ•°çš„æ–¹æ³• çš„å‚æ•°ç±»å‹æ˜¯NSUIntegerã€‚æ‹¿ä¸Šå›¾ä¸¾ä¾‹å­å°±æ˜¯è¯´ï¼Œå½“å‰è¿™ä¸ªå‚æ•°ä¸º2ï¼Œé‚£è¿™ä¸ªå€¼å°±ä»£è¡¨çš„æ˜¯å½“å‰æœ€å¤šå±•å¼€çš„ä¿¡å·ï¼ŒsignalAä¸­æœ‰4ä¸ªä¿¡å·ï¼Œæœ€å¤šåŒæ—¶å±•å¼€ä¸¤ä¸ªä¿¡å·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé¦–å…ˆèƒ½å¤Ÿä¸€æ¬¡è®¢é˜…å‰ä¸¤ä¸ªä¿¡å·ï¼Œå¦‚æœè¿™é‡Œä¸¤ä¸ªä¿¡å·éƒ½æ²¡æ‰§è¡Œå®Œï¼Œ å°±ä¸èƒ½è®¢é˜…ç¬¬ä¸‰ä¸ªï¼Œå½“ å‰ä¸¤ä¸ªä¿¡å·å…¶ä¸­æœ‰ä¸€ä¸ªä¿¡å·ç»“æŸä¹‹åï¼Œæ‰ä¼šå»è®¢é˜…ç¬¬ä¸‰ä¸ªä¿¡å·ï¼Œè¿™æ ·ä¾æ¬¡ç±»æ¨ã€‚ Concat å¯¹äºä¸€ä¸ªè¿”å›aä¿¡å·ã€bä¿¡å·çš„é«˜é˜¶ä¿¡å·è°ƒç”¨flatten:1ï¼Œç­‰ä»·äº[aä¿¡å· concat:bä¿¡å·]ã€‚ å¯¹äºé«˜çº§ä¿¡å·ï¼Œä¹Ÿæœ‰ä¸€ä¸ª- (RACSIgnal *)concat;æ–¹æ³•ï¼Œå°±æ˜¯ç›¸å½“äºè°ƒç”¨flatten:1 FlattenMapflattenMapå°±æ˜¯ å…ˆmapä¸ºé«˜é˜¶ä¿¡å·åœ¨è°ƒç”¨flattené™é˜¶ çœ‹ä¸€ä¸‹ RACStream.mæ–‡ä»¶ä¸­ flattenMap: ã€flattenã€mapï¼šçš„å®ç° 123456789101112131415161718192021222324252627- (__kindof RACStream *)flattenMap:(__kindof RACStream * (^)(id value))block { Class class = self.class; return [[self bind:^{ return ^(id value, BOOL *stop) { id stream = block(value) ?: [class empty]; NSCAssert([stream isKindOfClass:RACStream.class], @\"Value returned from -flattenMap: is not a stream: %@\", stream); return stream; }; }] setNameWithFormat:@\"[%@] -flattenMap:\", self.name];}- (__kindof RACStream *)flatten { return [[self flattenMap:^(id value) { return value; }] setNameWithFormat:@\"[%@] -flatten\", self.name];}- (__kindof RACStream *)map:(id (^)(id value))block { NSCParameterAssert(block != nil); Class class = self.class; return [[self flattenMap:^(id value) { return [class return:block(value)]; }] setNameWithFormat:@\"[%@] -map:\", self.name];} é€šè¿‡çœ‹æ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥çœ‹å‡ºï¼Œflattenå’Œmapæ–¹æ³•éƒ½æ˜¯åŸºäºflattenMap:çš„ï¼Œè¿˜æœ‰filterï¼š 12345678910111213- (__kindof RACStream *)filter:(BOOL (^)(id value))block { NSCParameterAssert(block != nil); Class class = self.class; return [[self flattenMap:^ id (id value) { if (block(value)) { return [class return:value]; } else { return class.empty; } }] setNameWithFormat:@\"[%@] -filter:\", self.name];} æŸ¥çœ‹flattenMapæ–¹æ³•å®ç°ã€‚å‘ç°å®ƒæ˜¯åŸºäºbind:æ–¹æ³•çš„ã€‚RACä¸­çš„æ–¹æ³•å‡ ä¹æ‰€æœ‰éƒ½æ˜¯åŸºäºbindæ–¹æ³•å®ç°çš„ï¼Œå®ƒæ˜¯RACçš„æ ¸å¿ƒæ–¹æ³•ã€‚è¿™ä¸ªbindæ–¹æ³•æ„Ÿè§‰æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘æš‚æ—¶ä¹Ÿä¸å¤ªç†è§£ï¼Œä»¥åå†ç ”ç©¶ã€‚","link":"/2017/03/10/RAC-å››-ä¿¡å·é«˜é˜¶æ“ä½œ/"},{"title":"iOSå†…å­˜ç®¡ç†è¯¦è§£","text":"å†…å­˜ç®¡ç†/å¼•ç”¨è®¡æ•°Objective-Cçš„å†…å­˜ç®¡ç†æ–¹å¼ï¼šå¼•ç”¨è®¡æ•° å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼ å¯¹è±¡æ“ä½œ Objective-Cæ–¹æ³• ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡ alloc/new/copy/mutableCopyç­‰æ–¹æ³• æŒæœ‰å¯¹è±¡ retainæ–¹æ³• é‡Šæ”¾å¯¹è±¡ releaseæ–¹æ³• åºŸå¼ƒå¯¹è±¡ deallocæ–¹æ³• â€‹ â€‹ è¿™äº›æœ‰å…³Objective-Cå†…å­˜ç®¡ç†çš„æ–¹æ³•ï¼Œå®é™…ä¸Šä¸åŒ…æ‹¬åœ¨è¯¥è¯­è¨€ä¸­ï¼Œè€Œæ˜¯åŒ…å«åœ¨Cocoaæ¡†æ¶ä¸­ç”¨äºOS Xã€iOSåº”ç”¨å¼€å‘ã€‚Cocoaæ¡†æ¶ä¸­Foundationæ¡†æ¶ç±»åº“çš„NSObjectç±»æ‹…è´Ÿå†…å­˜ç®¡ç†çš„èŒè´£ã€‚ è‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±æŒæœ‰ 12// è‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡id obj = [[NSObject alloc] init]; ä½¿ç”¨alloc/new/copy/mutableCopyçš„æ–¹æ³•ï¼Œå–å¾—çš„å¯¹è±¡éƒ½æ˜¯è‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰çš„ã€‚ ç”¨è¿™äº›ä»¥å¤–çš„æ–¹æ³•å–å¾—çš„å¯¹è±¡ï¼Œå› ä¸ºéè‡ªå·±ç”Ÿæˆï¼Œæ‰€ä»¥è‡ªå·±ä¸æ˜¯å¯¹è±¡çš„æŒæœ‰è€…ã€‚ copyæ–¹æ³•åˆ©ç”¨åŸºäºNSCopyingæ–¹æ³•çº¦å®šï¼Œç”±å„ç±»å®ç°çš„copyWithZone:æ–¹æ³•ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡çš„å‰¯æœ¬ï¼Œmutableä¸copyç±»ä¼¼ ã€‚ç”¨copy/mutableCopyæ–¹æ³•ç”Ÿæˆçš„å¯¹è±¡ï¼Œè™½ç„¶æ˜¯å¯¹è±¡çš„å‰¯æœ¬ï¼Œä½†åŒallcoã€newæ–¹æ³•ä¸€æ ·ï¼Œåœ¨â€œè‡ªå·±ç”Ÿæˆå¹¶æŒæœ‰å¯¹è±¡â€è¿™ç‚¹ä¸Šæ²¡æœ‰æ”¹å˜ã€‚ éè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œè‡ªå·±ä¹Ÿèƒ½æŒæœ‰ 12345678 /*å–å¾—éè‡ªå·±ç”Ÿæˆå¯¹è±¡ï¼Œä¸æŒæœ‰*/id obj = [NSMutableArray array];/*è‡ªå·±æŒæœ‰*/[obj reatin]; é€šè¿‡retainæ–¹æ³•ï¼Œéè‡ªå·±ç”Ÿæˆçš„åƒ å¯ä»¥è¢«è‡ªå·±æ‰€æŒæœ‰ã€‚ ä¸å†éœ€è¦è‡ªå·±æŒæœ‰çš„å¯¹è±¡æ—¶é‡Šæ”¾ ç”¨alloc/new/copy/mutableCopyæ–¹æ³•ç”Ÿæˆå¹¶æŒæœ‰çš„å¯¹è±¡ï¼Œæˆ–è€…ç”¨retainæ–¹æ³•æŒæœ‰çš„å¯¹è±¡ï¼Œä¸€æ—¦ä¸å†éœ€è¦ï¼ŒåŠ¡å¿…è¦ç”¨releaseæ–¹æ³•è¿›è¡Œé‡Šæ”¾ã€‚ æ— æ³•é‡Šæ”¾éè‡ªå·±æŒæœ‰çš„å¯¹è±¡ å†…å­˜ç®¡ç†é»„é‡‘æ³•åˆ™ï¼š The basic rule to apple is everything thatincreases the reference counter with alloc,[mutable]copy[WithZone:] or retainis in charge of the corresponding [auto]release. å¦‚æœä¸€ä¸ªå¯¹è±¡ä½¿ç”¨äº†allocï¼Œ[mutable] copyï¼Œretainï¼Œé‚£ä¹ˆä½ å¿…é¡»ä½¿ç”¨ç›¸åº”çš„[auto]release è‹¹æœå¯¹äºå¼•ç”¨è®¡æ•°çš„å®ç°åœ¨NSObjectç±»çš„allocç±»æ–¹æ³•ä¸Šè®¾ç½®æ–­ç‚¹ï¼Œè¿½è¸ªç¨‹åºçš„æ‰§è¡Œã€‚ä»¥ä¸‹åˆ—å‡ºäº†æ‰§è¡Œæ‰€è°ƒç”¨çš„æ–¹æ³•å’Œå‡½æ•°ï¼š 1234+alloc+allocWithZone:class_createInstancecalloc allocç±»æ–¹æ³•é¦–å…ˆè°ƒç”¨allocWithZone:ç±»æ–¹æ³•ï¼Œç„¶åè°ƒç”¨class_createInstanceå‡½æ•°ï¼Œæœ€åé€šè¿‡è°ƒç”¨callocæ¥åˆ†é…å†…å­˜å—ã€‚ retainCount/retain/releaseå®ä¾‹æ–¹æ³•åˆæ˜¯æ€ä¹ˆå®ç°å‘¢ï¼ŸåŒåˆšæ‰çš„æ–¹æ³•ä¸€æ ·ï¼Œä¸‹é¢åˆ—å‡ºå„ä¸ªæ–¹æ³•åˆ†åˆ«è°ƒç”¨çš„æ–¹æ³•å’Œå‡½æ•°ï¼š 123-retainCount__CFDoExternRefOperationCFBasicHashGetCountOfKey 123-retain__CFDoExternRefOperationCFBasicHashAddValue 1234-release__CFDoExternRefOperationCFBasicHashRemoveValue(CFBasicHashRemoveValueè¿”å›0æ—¶ï¼Œ-releaseè°ƒç”¨dealloc) å„ä¸ªæ–¹æ³•éƒ½é€šè¿‡åŒä¸€ä¸ª__CFDoExternRefOperationå‡½æ•°ï¼Œè°ƒç”¨äº†ä¸€ç³»åˆ—åç§°ç›¸ä¼¼çš„å‡½æ•°ã€‚å¦‚è¿™äº›å‡½æ•°åçš„å‰ç¼€â€CFâ€æ‰€ç¤ºï¼Œå¥¹ä»¬åŒ…å«äºCoreFoundationæ¡†æ¶æºä»£ç ä¸­ï¼Œå³æ˜¯CFRuntime.cçš„CFDoExternRefOperationå‡½æ•°ã€‚ä¸ºäº†ç†è§£å…¶å®ç°ï¼Œä¸‹é¢ç®€åŒ–è¯¥å‡½æ•°çš„æºä»£ç ï¼š 1234567891011121314151617181920int __CFDoExternRefOperation(uintptr_t op, id obj) { CFBasicHashRef table = å–å¾—å¯¹è±¡çš„æ•£åˆ—è¡¨(obj); int count; switch (op) { case OPERATION_retainCount: count = CFBasicHashGetCountOfKey(table, obj); return count; break; case OPERATION_retain: count = CFBasicHashAddValue(table, obj); return obj; case OPERATION_release: count = CFBasicHashRemoveValue(table, obj); return 0 == count; }} __CFDoExternRefOperationé€šè¿‡switchè¯­å¥ é’ˆå¯¹ä¸åŒçš„æ“ä½œæ¥è¿›è¡Œå…·ä½“çš„æ–¹æ³•è°ƒç”¨ï¼ŒretainCount/retain/releaseå®ä¾‹æ–¹æ³•ä¹Ÿè®¸å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼š 1234567891011121314- (NSUInteger)retainCount{ return (NSUInteger)____CFDoExternRefOperation(OPERATION_retainCount,self);}- (id)retain{ return (id)____CFDoExternRefOperation(OPERATION_retain,self);}- (void)release{ return ____CFDoExternRefOperation(OPERATION_release,self);} é€šè¿‡ä»¥ä¸Šï¼Œå¯ä»¥çœ‹å‡ºè‹¹æœçš„å¤§æ¦‚å®ç°å°±æ˜¯å°†å¼•ç”¨è®¡æ•°ä¿å­˜åœ¨å¼•ç”¨è®¡æ•°è¡¨çš„è®°å½•ä¸­ï¼Œè€Œä¸æ˜¯ä¿å­˜åœ¨å¯¹è±¡å ç”¨å†…å­˜å—å¤´éƒ¨ä¸­ã€‚é‡‡ç”¨æ•£åˆ—è¡¨(å¼•ç”¨è®¡æ•°è¡¨)æ¥ç®¡ç†å¼•ç”¨è®¡æ•°ã€‚ è¿™æ ·çš„å¥½å¤„æ˜¯ï¼š ä¸ç”¨åœ¨æ¯ä¸ªå¯¹è±¡å†…å­˜å—ä¸­è€ƒè™‘å¼•ç”¨è®¡æ•°æ‰€å çš„å†…å­˜ å¼•ç”¨æŠ€æœ¯è¡¨å„è®°å½•ä¸­å­˜æœ‰å†…å­˜åœ°å€ï¼Œå¯ä»å„ä¸ªè®°å½•è¿½æº¯åˆ°å„å¯¹è±¡çš„å†…å­˜å—ï¼ˆå³ä½¿å‡ºç°æ•…éšœå¯¼è‡´å¯¹è±¡å ç”¨çš„å†…å­˜å—æŸåï¼Œä½†åªè¦å¼•ç”¨è®¡æ•°è¡¨æ²¡æœ‰è¢«ç ´åï¼Œå°±èƒ½å¤Ÿç¡®è®¤å„ä¸ªå†…å­˜å—çš„ä½ç½®ï¼‰ å¦å¤–ï¼Œåœ¨åˆ©ç”¨å·¥å…·æ£€æµ‹å†…å­˜æ³„æ¼æ—¶ï¼Œå¼•ç”¨è®¡æ•°è¡¨çš„å„è®°å½•ä¹Ÿæœ‰åŠ©äºæ£€æµ‹å„å¯¹è±¡çš„æŒæœ‰è€…æ˜¯å¦å­˜åœ¨ã€‚ Autoreleaseä½¿ç”¨autoreleaseï¼Œå¯ä½¿å–å¾—çš„å¯¹è±¡å­˜åœ¨ä½†è‡ªå·±ä¸æŒæœ‰å¯¹è±¡ã€‚autoreleaseæä¾› è¿™æ ·çš„åŠŸèƒ½ï¼Œä½¿å¯¹è±¡åœ¨è¶…å‡ºæŒ‡å®šçš„ç”Ÿå­˜èŒƒå›´æ—¶èƒ½å¤Ÿè‡ªåŠ¨å¹¶æ­£ç¡®åœ°é‡Šæ”¾(è‡ªåŠ¨è°ƒç”¨releaseæ–¹æ³•)ã€‚ autoreleaseçš„å…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ ç”Ÿæˆå¹¶æŒæœ‰NSAutoreleasePoolå¯¹è±¡ è°ƒç”¨å·²åˆ†é…å¯¹è±¡çš„autoreleaseå®ä¾‹æ–¹æ³• åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡ NSAutoreleasePoolå¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸç›¸å½“äºCè¯­è¨€å˜é‡çš„ä½œç”¨åŸŸã€‚å¯¹äºæ‰€æœ‰è°ƒç”¨è¿‡autoreleaseå®ä¾‹æ–¹æ³•çš„å¯¹è±¡ï¼Œåœ¨åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡æ—¶ï¼Œéƒ½å°†è°ƒç”¨releaseå®ä¾‹æ–¹æ³•ã€‚ ç”¨æºä»£ç è¡¨ç¤ºå¦‚ä¸‹ï¼š 1234NSAutoReleasePool *pool = [[NSAutoReleasePool alloc] init];id obj = [[NSObject alloc] init];[obj autorelease];[pool drain]; NSAutoreleasePoolå¯¹è±¡çš„é”€æ¯æ˜¯è°ƒç”¨ drain() æ–¹æ³• ARCä¸­ä½¿ç”¨NSAutoReleasePoolï¼š 1234@autoreleasepool{ }//åœ¨{}ä¸­å­˜æ”¾çš„å¯¹è±¡ä¼šåœ¨}åé‡Šæ”¾æ‰ ä½¿ç”¨NSAutoreleasePoolå‡å°‘å†…å­˜å³°å€¼åœ¨å¤§é‡äº§ç”Ÿautoreleaseçš„å¯¹è±¡æ—¶ï¼Œåªè¦ä¸åºŸå¼ƒNSAutoReleasePoolå¯¹è±¡ï¼Œé‚£ä¹ˆç”Ÿæˆçš„å¯¹è±¡å°±ä¸èƒ½è¢«é‡Šæ”¾ï¼Œå› æ­¤æœ‰æ—¶ä¼šäº§ç”Ÿå†…å­˜ä¸è¶³çš„ç°è±¡ã€‚å…¸å‹çš„ä¾‹å­æ˜¯è¯»å…¥å¤§é‡å›¾è±¡çš„åŒæ—¶æ”¹å˜å…¶å°ºå¯¸ã€‚å›¾è±¡æ–‡ä»¶è¯»å…¥åˆ°NSDataå¯¹è±¡ï¼Œå¹¶ç”ŸæˆUIImageå¯¹è±¡ï¼Œæ”¹å˜è¯¥å¯¹è±¡çš„å°ºå¯¸åç”Ÿæˆæ–°çš„UIImageå¯¹è±¡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå°±ä¼šå¤§é‡ç”Ÿæˆautoreleaseå¯¹è±¡ã€‚ 12345678for (int i = 0, i &lt; å›¾åƒæ•°, ++i) { /* *è¯»å…¥å›¾åƒ *å¤§é‡äº§ç”Ÿautoreleaseå¯¹è±¡ *ç”±äºæ²¡æœ‰åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡ *æœ€ç»ˆå¯¼è‡´å†…å­˜ä¸è¶³ */} åœ¨æ­¤æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦åœ¨é€‚å½“åœ°æ–¹ç”Ÿæˆã€æŒæœ‰æˆ–åºŸå¼ƒNSAutoreleasePoolå¯¹è±¡ã€‚ 1234567891011for (int i = 0; i &lt; å›¾åƒæ•°; ++i) { NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init]; /* *è¯»å…¥å›¾åƒ */ [pool drain]; /* *é€šè¿‡[pool drain], *autoreleaseçš„å¯¹è±¡è¢«ä¸€èµ·åºŸå¼ƒ */} autoreleaseå¯¹è±¡ä»€ä¹ˆæ—¶å€™é‡Šæ”¾å¾ˆå¤šäººçš„ç­”æ¡ˆæ˜¯â€œå½“å‰ä½œç”¨åŸŸå¤§æ‹¬å·ç»“æŸæ—¶é‡Šæ”¾â€ï¼Œæ˜¾ç„¶æ²¡æœ‰æ­£ç¡®ç†è§£autoreleaseçš„æœºåˆ¶ã€‚åœ¨æ²¡æœ‰æ‰‹åŠ¨æ·»åŠ autoreleasepoolçš„æƒ…å†µä¸‹ï¼Œautoreleaseå¯¹è±¡æ˜¯åœ¨å½“å‰runloopè¿­ä»£ç»“æŸæ—¶é‡Šæ”¾çš„ã€‚è€Œå®ƒèƒ½å¤Ÿé‡Šæ”¾çš„åŸå› æ˜¯ç³»ç»Ÿåœ¨æ¯ä¸ªrunloopè¿­ä»£ä¸­éƒ½åŠ å…¥äº†è‡ªåŠ¨é‡Šæ”¾æ± Pushå’ŒPopã€‚ çœ‹ä¸‹é¢ä»£ç ï¼š 123456789101112131415161718__weak id reference = nil;- (void)viewDidLoad { [super viewDidLoad]; __autoreleasing Person *p = [[Person alloc] init]; reference = p; NSLog(@\"%@\",reference);//Console: &lt;Person: 0x60000000f170&gt;}- (void)viewWillAppear:(BOOL)animated { [super viewWillAppear:animated]; NSLog(@\"%@\",reference);//Console: &lt;Person: 0x60000000f170&gt;}- (void)viewDidAppear:(BOOL)animated { [super viewDidAppear:animated]; NSLog(@\"%@\",reference);//Console: (null)} ç”±äºè¿™ä¸ªvcåœ¨loadViewä¹‹åä¾¿addåˆ°äº†windowå±‚çº§ä¸Šï¼Œæ‰€ä»¥viewDidLoadå’ŒviewWillAppearæ˜¯åœ¨åŒä¸€ä¸ªrunloopè°ƒç”¨çš„ï¼Œå› æ­¤åœ¨viewWillAppearä¸­ï¼Œè¿™ä¸ªautoreleaseçš„å˜é‡ä¾ç„¶æœ‰å€¼ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¹²é¢„autoreleaseå¯¹è±¡çš„é‡Šæ”¾æ—¶æœºï¼š 12345678910111213141516171819__weak id reference = nil;- (void)viewDidLoad { [super viewDidLoad]; @autoreleasepool { __autoreleasing Person *p = [[Person alloc] init]; reference = p; } NSLog(@\"%@\",reference);//Console: (null)}- (void)viewWillAppear:(BOOL)animated { [super viewWillAppear:animated]; NSLog(@\"%@\",reference);//Console: (null)}- (void)viewDidAppear:(BOOL)animated { [super viewDidAppear:animated]; NSLog(@\"%@\",reference);//Console: (null)} è‹¹æœå¯¹äºautoreleaseçš„å®ç°autoreleaseå®ä¾‹æ–¹æ³•çš„æœ¬è´¨å°±æ˜¯è°ƒç”¨NSAutoreleasePoolå¯¹è±¡çš„addObjectæ–¹æ³•ã€‚ ç³»ç»Ÿåœ¨æ¯ä¸ªrunloopè¿­ä»£ä¸­éƒ½åŠ å…¥äº†è‡ªåŠ¨é‡Šæ”¾æ± çš„Pushå’ŒPopæ–¹æ³•ã€‚å…·ä½“ä¸ºrunloopå¼€å§‹çš„æ—¶å€™è°ƒç”¨AutoreleasePoolPageçš„Pushæ–¹æ³•ï¼Œç»“æŸçš„æ—¶å€™è°ƒç”¨Popæ–¹æ³•ã€‚ 1234567void *objc_autoreleasePoolPush(void) { return AutoreleasePoolPage::push();}void objc_autoreleasePoolPop(void *ctxt) { AutoreleasePoolPage::pop(ctxt);} é‚£ä¹ˆAutoreleasePoolPageæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ AutoReleasePoolPageæ˜¯ä¸€ä¸ªC++çš„ç±»ï¼Œåœ¨NSObject.mmä¸­å®šä¹‰æ˜¯ï¼š 123456789class AutoreleasePoolPage { magic_t const magic; id *next; pthread_t const thread; AutoreleasePoolPage * const parent; AutoreleasePoolPage *child; uint32_t const depth; uint32_t hiwat;}; magic ç”¨äºå¯¹å½“å‰ AutoreleasePoolPage`å®Œæ•´æ€§çš„æ ¡éªŒ thread ä¿å­˜äº†å½“å‰æ‰€åœ¨çš„çº¿ç¨‹ æ¯ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± éƒ½æ˜¯ç”±ä¸€ç³»åˆ—çš„AutoreleasePoolPageç»„æˆçš„ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªAutoreleasePoolPageçš„å¤§å°éƒ½æ˜¯4096å­—èŠ‚(0x1000) è‡ªåŠ¨é‡Šæ”¾æ± ä¸­çš„AutoreleasePoolPageæ˜¯ä»¥åŒå‘é“¾è¡¨çš„å½¢å¼é“¾æ¥èµ·æ¥çš„ï¼š parent å’Œ child å°±æ˜¯ç”¨æ¥æ„é€ åŒå‘é“¾è¡¨çš„æŒ‡é’ˆã€‚ autoreleaseå’Œrunloopçš„å…³ç³»runloopå¼€å§‹å¯åŠ¨çš„æ—¶å€™ä¼šåˆ›å»ºautoreleasePoolï¼Œç»“æŸçš„æ—¶å€™ä¼šé”€æ¯autoreleasePool ARCå¼•ç”¨è®¡æ•°å†…å­˜ç®¡ç†çš„æœ¬è´¨éƒ¨åˆ†åœ¨ARCä¸­å¹¶æ²¡æœ‰æ”¹å˜ã€‚ARCåªæ˜¯è‡ªåŠ¨å¸®æˆ‘ä»¬å¤„ç†â€œå¼•ç”¨è®¡æ•°â€çš„ç›¸å…³éƒ¨åˆ†ã€‚ æ‰€æœ‰æƒä¿®é¥°ç¬¦ARCæœ‰æ•ˆæ—¶ï¼Œidç±»å‹å’Œå¯¹è±¡ç±»å‹åŒCè¯­è¨€å…¶ä»–ç±»å‹ä¸åŒï¼Œå…¶ç±»å‹ä¸Šå¿…é¡»é™„åŠ æ‰€æœ‰æƒä¿®é¥°ç¬¦ã€‚æ‰€æœ‰æƒä¿®é¥°ç¬¦ä¸€å…±æœ‰4ä¸­ã€‚ __strong __strongä¿®é¥°ç¬¦æ˜¯idç±»å‹å’Œå¯¹è±¡ç±»å‹é»˜è®¤çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦ã€‚__strongä¿®é¥°ç¬¦è¡¨ç¤ºå¯¹å¯¹è±¡çš„â€œå¼ºå¼•ç”¨â€ï¼ŒæŒæœ‰å¼ºå¼•ç”¨çš„å˜é‡åœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶è¢«åºŸå¼ƒï¼Œéšç€å¼ºå¼•ç”¨çš„å¤±æ•ˆï¼Œå¼•ç”¨çš„å¯¹è±¡ä¼šéšä¹‹é‡Šæ”¾ã€‚ __strongä¿®é¥°ç¬¦ä¿®é¥°çš„å˜é‡ï¼Œä¸ä»…ä»…åªåœ¨å˜é‡ä½œç”¨åŸŸä¸­ï¼Œåœ¨èµ‹å€¼ä¸Šä¹Ÿèƒ½å¤Ÿæ­£ç¡®åœ°ç®¡ç†å…¶å¯¹è±¡çš„æ‰€æœ‰è€…ã€‚ é€šè¿‡__strongä¿®é¥°ç¬¦ï¼Œä¸å¿…å†é”®å…¥retainæˆ–è€…releaseï¼Œå®Œç¾åœ°æ»¡è¶³äº†â€œå¼•ç”¨æŠ€æœ¯å†…å­˜ç®¡ç†çš„æ€è€ƒæ–¹å¼â€ __weak å¤šç”¨æ¥è§£å†³â€œå¾ªç¯å¼•ç”¨â€çš„é—®é¢˜ã€‚ __weakä¿®é¥°ç¬¦è¿˜æœ‰å¦å¤–ä¸€ä¸ªä¼˜ç‚¹ï¼Œåœ¨æŒæœ‰æŸå¯¹è±¡çš„å¼±å¼•ç”¨æ—¶ï¼Œè‹¥è¯¥å¯¹è±¡è¢«åºŸå¼ƒï¼Œåˆ™æ­¤å¼±å¼•ç”¨å°†è‡ªåŠ¨å¤±æ•ˆä¸”å¤„äºnilè¢«èµ‹å€¼çš„çŠ¶æ€ï¼ˆç©ºå¼±å¼•ç”¨ï¼‰ã€‚ __unsafe_unretained __unsafe_unretainedä¿®é¥°ç¬¦æ­£å¦‚å…¶åunsafeæ‰€ç¤ºï¼Œæ˜¯ä¸å®‰å…¨çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦ã€‚å°½ç®¡ARCå¼çš„å†…å­˜ç®¡ç†æ˜¯ç¼–è¯‘å™¨çš„å·¥ä½œï¼Œä½†é™„æœ‰ __unsafe_unretainedä¿®é¥°ç¬¦çš„å˜é‡ä¸å±äºç¼–è¯‘å™¨çš„å†…å­˜ç®¡ç†å¯¹è±¡ã€‚ å’Œ__weakä¸€æ ·éƒ½æ˜¯å¼±å¼•ç”¨ã€‚ä½†æ˜¯å½“å¼•ç”¨çš„å¯¹è±¡è¢«åºŸå¼ƒåï¼ŒæŒ‡é’ˆä¸ä¼šç½®ä¸ºnilï¼Œä¼šé€ æˆé‡æŒ‡é’ˆ __autoreleasing 12345678910/* ARCæ— æ•ˆ */NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];id obj = [[NSObject alloc] init];[obj autorelease];[pool drain];/* ARCæœ‰æ•ˆ ä¸ä¸Šé¢ä»£ç ç­‰ä»· */@autoreleasepool { id __autoreleaseing obj = [[NSObject alloc] init];} ARCæœ‰æ•ˆæ—¶ï¼ŒautoreleaseåŠŸèƒ½æ˜¯èµ·ä½œç”¨çš„ã€‚ç”¨@autorelasepoolå—æ›¿ä»£NSAutoreleasePoolç±»ï¼Œç”¨é™„æœ‰__autoreleasingä¿®é¥°ç¬¦çš„å˜é‡æ›¿ä»£autoreleaseæ–¹æ³•ã€‚ å¯¹è±¡èµ‹å€¼ç»™é™„æœ‰__autoreleaseä¿®é¥°ç¬¦çš„å˜é‡ç­‰ä»·äºåœ¨ARCæ— æ•ˆæ—¶è°ƒç”¨å¯¹è±¡çš„autoreleaseæ–¹æ³•ï¼Œå³å¯¹è±¡è¢«æ³¨å†Œåˆ°autoreleasepoolã€‚ æ˜¾ç¤ºåœ°é™„åŠ _autoreleaseingä¿®é¥°ç¬¦åŒæ˜¾ç¤ºåœ°é™„åŠ \\_strongä¿®é¥°ç¬¦ä¸€æ ·ç½•è§ï¼Œæ‰€ä»¥åœ¨ARCä¸­ç»å¸¸éæ˜¾ç¤ºåœ°ä½¿ç”¨___autoreleasingä¿®é¥°ç¬¦ã€‚ éæ˜¾ç¤ºåœ°ä½¿ç”¨__autoreleaseingä¿®é¥°ç¬¦çš„åˆ—å­ï¼š 1) 12id __weak obj1 = obj0; NSLog(@&quot;class=%@&quot;,[obj1 class]); ä¸‹é¢çš„ä»£ç ä¸ä¸Šé¢çš„ç›¸åŒï¼š 123id __weak obj1 = obj0;id __autoreleasing tmp = obj1;NSLog(@&quot;class=%@&quot;,[tmp class]); åœ¨è®¿é—®åˆ°weakä¿®é¥°ç¬¦çš„å˜é‡æ—¶å¿…é¡»è®¿é—®æ³¨å†Œåˆ°autoreleasepoolçš„å¯¹è±¡ã€‚è¿™æ˜¯å› ä¸ºweakä¿®é¥°ç¬¦åªæŒæœ‰å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œè€Œåœ¨è®¿é—®å¼•ç”¨å¯¹è±¡çš„è¿‡ç¨‹ä¸­ï¼Œè¯¥å¯¹è±¡æœ‰å¯èƒ½è¢«åºŸå¼ƒã€‚å¦‚æœæŠŠè¦è®¿é—®çš„å¯¹è±¡æ³¨å†Œåˆ°autoreleasepoolä¸­ï¼Œé‚£ä¹ˆåœ¨@autoreleasepoolå—ç»“æŸä¹‹å‰éƒ½èƒ½ç¡®ä¿è¯¥å¯¹è±¡å­˜åœ¨ã€‚å› æ­¤ï¼Œä½¿ç”¨å¯Œæœ‰weakä¿®é¥°ç¬¦çš„å˜é‡æ—¶å°±å¿…å®šè¦ä½¿ç”¨æ³¨å†Œåˆ°autoreleasepoolä¸­çš„å¯¹è±¡ã€‚ 2ï¼‰ 123+ (id)array { return [NSMutableArray new];} ä¸Šè¿°æºä»£ç ç­‰åŒäºï¼š 1234+ (id)array { id obj = [NSMutableArray new]; return obj;} ç”±äºreturnä½¿å¾—å¯¹è±¡å˜é‡è¶…å‡ºå…¶ä½œç”¨åŸŸï¼Œæ‰€ä»¥è¯¥å¼ºå¼•ç”¨å¯¹åº”çš„è‡ªå·±æŒæœ‰çš„å¯¹è±¡ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œä½†è¯¥å¯¹è±¡ä½œä¸ºè¿”å›å€¼ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°†å…¶æ³¨å†Œåˆ°autoreleasePoolã€‚ 3) idçš„æŒ‡é’ˆæˆ–å¯¹è±¡çš„æŒ‡é’ˆåœ¨æ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šæ—¶ä¼šè¢«é™„åŠ ä¸Š__autoreleasingä¿®é¥°ç¬¦ 12NSError *error = nil;Bool result = [obj performOperationWithError:&amp;error]; è¯¥æ–¹æ³•çš„å£°æ˜ä¸ºï¼š 1- (BOOL)performOperationWithError:(NSError **)error; ç­‰åŒäºä¸€ä¸‹æºä»£ç ï¼š 1- (BOOL)performOperationWithError:(NSError * __autoreleasing*)error; è§„åˆ™ ä¸èƒ½ä½¿ç”¨retain/release/retainCount/autorelease ä¸èƒ½ä½¿ç”¨NSAllocateObject/NSDeallocateObject é¡»éµå®ˆå†…å­˜ç®¡ç†çš„æ–¹æ³•å‘½åè§„åˆ™ ä¸è¦æ˜¾ç¤ºè°ƒç”¨dealloc ä½¿ç”¨@autoreleasepoolå—ä»£æ›¿NSAutoreleasePool ä¸èƒ½ä½¿ç”¨åŒºåŸŸ(NSZone) ä¸ç®¡ARCæ˜¯å¦æœ‰æ•ˆï¼ŒåŒºåŸŸåœ¨ç°åœ¨çš„è¿è¡Œæ—¶ç³»ç»Ÿä¸­å·²å•çº¯åœ°è¢«å¿½ç•¥ å¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“çš„æˆå‘˜ Cè¯­è¨€çš„è§„çº¦ä¸Šæ²¡æœ‰æ–¹æ³•æ¥ç®¡ç†ç»“æ„ä½“æˆå‘˜çš„ç”Ÿå‘½å‘¨æœŸã€‚å› ä¸ºARCæŠŠå†…å­˜ç®¡ç†çš„å·¥ä½œåˆ†é…ç»™ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¿…é¡»èƒ½å¤ŸçŸ¥é“å¹¶ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¾‹å¦‚Cè¯­è¨€çš„è‡ªåŠ¨å˜é‡(å±€éƒ¨å˜é‡)å¯ä½¿ç”¨è¯¥å˜é‡çš„ä½œç”¨äºæ¥ç®¡ç†å¯¹è±¡ã€‚ä½†æ˜¯å¯¹äºCè¯­è¨€çš„ç»“æ„ä½“æˆå‘˜æ¥è¯´ï¼Œè¿™åœ¨æ ‡å‡†ä¸Šå°±æ˜¯ä¸å¯å®ç°çš„ã€‚ å¦‚æœéè¦æŠŠå¯¹è±¡å‹å˜é‡åŠ å…¥åˆ°ç»“æ„ä½“é‡æ—¶ï¼Œå¯å¼ºåˆ¶è½¬æ¢ä¸ºvoid *æˆ–æ˜¯é™„åŠ è§é¢æ‰€è¿°çš„__unsafe_unretainedä¿®é¥°ç¬¦ï¼ˆé™„æœ‰___unsafe_unretainedä¿®é¥°ç¬¦çš„å˜é‡ä¸å±äºç¼–è¯‘å™¨çš„å†…å­˜ç®¡ç†å¯¹è±¡ã€‚å¦‚æœç®¡ç†æ—¶ä¸æ³¨æ„èµ‹å€¼å¯¹è±¡çš„æ‰€æœ‰è€…ï¼Œä¾¿æœ‰å¯èƒ½é­é‡å†…å­˜æ³„æ¼æˆ–ç¨‹åºå´©æºƒï¼‰ æ˜¾ç¤ºè½¬æ¢idå’Œvoid * é€šè¿‡_bridgeï¼Œidå’Œvoidèƒ½å¤Ÿç›¸äº’è½¬æ¢ã€‚ä½†æ˜¯\\_bridgeè½¬æ¢ï¼Œå…¶å®‰å…¨æ€§ä¸èµ‹å€¼ç»™__unsafe_unretainedä¿®é¥°ç¬¦ç›¸è¿‘ï¼Œç”šè‡³ä¼šæ›´ä½ã€‚å¦‚æœç®¡ç†æ—¶ä¸æ³¨æ„èµ‹å€¼å¯¹è±¡çš„æ‰€æœ‰è€…ï¼Œå°±ä¼šå› æ‚¬å‚æŒ‡é’ˆè€Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚ __bridgeè½¬æ¢ä¸­è¿˜æœ‰å¦å¤–ä¸¤ç§è½¬æ¢ï¼Œåˆ†åˆ«æ˜¯__bridge_retainedè½¬æ¢å’Œ__bridge_transferè½¬æ¢ ##","link":"/2016/08/20/iOSå†…å­˜ç®¡ç†/"},{"title":"iOSç»˜åˆ¶æ‰‹åŠ¿è§£é”","text":"æ‰‹åŠ¿è§£é”è¿™ä¸ªåŠŸèƒ½å…¶å®å·²ç»ç”¨çš„è¶Šæ¥è¶Šå°‘äº†ã€‚ä½†æ˜¯éƒé—·ä¸çŸ¥é“æˆ‘å…¬å¸ä¸ºä»€ä¹ˆæ¯æ¬¡åšä¸€ä¸ªappéƒ½è¦æŠŠæ‰‹åŠ¿è§£é”åŠ ä¸Šã€‚ã€‚ã€‚ã€‚ã€‚äºæ˜¯å°±è‡ªå·±ç ”ç©¶äº†ä¸€ä¸‹æ‰‹åŠ¿è§£é”é¡µé¢çš„å®ç°ã€‚ã€‚ è¦æƒ³å®ç°è¿™ä¸ªé¡µé¢ï¼Œå…ˆè¯´è¯´éœ€è¦æŒæ¡å“ªäº›ï¼šUIPanGestureRecognizerçš„åŸºæœ¬ä½¿ç”¨CGRectContainsPoint(&lt;#CGRect rect#&gt;, &lt;#CGPoint point#&gt;)UIBezierPathè´å¡å°”æ›²çº¿çš„ç»˜åˆ¶drawRect å’Œ layoutIfNeeded çŸ¥é“ä½•æ—¶ï¼Œå¦‚ä½•ä½¿ç”¨ åªè¦æŒæ¡ä¸Šé¢è¯´çš„å››ç‚¹ï¼Œå®ç°æ‰‹åŠ¿è§£é”å°±å¾ˆç®€å•äº†ã€‚ä¸Šé¢è¯´çš„åˆå­¦è€…å¯ä»¥è‡ªå·±è°·æ­Œå­¦ä¹ ï¼Œå­¦å®Œåå†å»çœ‹æˆ‘çš„æ‰‹åŠ¿è§£é”ä»£ç ï¼Œåº”è¯¥å°±ä¼šå¾ˆæ˜ç™½äº†ã€‚ å¹¶ä¸”å·²ç»é€‚é…æ‰€æœ‰å°ºå¯¸çš„iPhoneï¼Œå¯ä»¥è‡ªå®šä¹‰UIæºç åœ°å€ï¼šhttps://github.com/wqhiOS/WUGesturesToUnlock","link":"/2016/04/02/iOSç»˜åˆ¶æ‰‹åŠ¿è§£é”/"},{"title":"RAC(äºŒ)åŸºç¡€çŸ¥è¯†","text":"æ ¸å¿ƒç»„ä»¶ RACStream RACSequence RACSignal RACSubscriber RACDisposable RACScheduler Cocoaæ¡†æ¶é€‚é…å·¥å…· RACStreamçš„ä¸¤ä¸ªå­ç±»ï¼šSequence &amp; Signal RACStreamè¡¨ç¤ºä¸€ä¸ªæ•°æ®æµçš„ç±»ã€‚è¿™ä¸ªæµä¸ä¸€å®šæ˜¯åŸºäºæ—¶é—´çš„ï¼Œæ‰€ä»¥å®ƒæœ‰ä¸¤ä¸ªå­ç±»RACSequenceå’ŒRACSignalã€‚ RACSequenceæ˜¯åŸºäºç©ºé—´çš„æ•°æ®æµ RACSignalæ˜¯åŸºäºæ—¶é—´çš„æ•°æ®æµ å¯¹æ¯”RACSequenceå’ŒRACSignalï¼ŒåŸºäºç©ºé—´çš„æ•°æ®æµå’ŒåŸºäºæ—¶é—´çš„æ•°æ®æµåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Sequenceæ˜¯Pull-Driven(æ‹‰é©±åŠ¨)ï¼ŒSignalæ˜¯Push-driven(æ¨é©±åŠ¨) pull-driverè¡¨ç¤ºæ•°æ®çš„å˜åŒ–æ˜¯ç”±æ‹‰å–è€…å†³å®šçš„ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œsequenceå°±å¥½æ¯”ä¸€æœ¬ä¹¦ï¼Œæˆ‘ä»¬çœ‹ä¹¦ï¼Œæƒ³çœ‹åˆ°å“ªé¡µå°±å¯ä»¥ç¿»åˆ°å“ªé¡µå»çœ‹ï¼Œçœ‹ä»€ä¹ˆå†…å®¹è¯»å–ä»€ä¹ˆæ•°æ®ï¼Œæ˜¯ç”±æˆ‘ä»¬å†³å®šï¼Œè€Œä¸æ˜¯ç”±ä¹¦ï¼ˆsequenceï¼‰å†³å®šã€‚ push-driverè¡¨ç¤ºæ•°æ®çš„å˜åŒ–æ˜¯ç”±æ¨é€è€…å†³å®šçš„ï¼Œä¸pull-driveråˆšå¥½ç›¸åã€‚å¯ä»¥æŠŠSignalæ¯”ä½œç”µè§†ä½“è‚²ç›´æ’­ã€‚çœ‹ä»€ä¹ˆå†…å®¹è¯»å–ä»€ä¹ˆæ•°æ®ï¼Œæ˜¯ç”±ç”µè§†(Signal)å†³å®šçš„ï¼Œå¦‚æœæˆ‘ä»¬å»ä¸Šä¸ªå«ç”Ÿé—´ä¹Ÿæ— æ³•æš‚åœä½“è‚²ç›´æ’­ï¼Œä¸­é—´çš„æ•°æ®å°±ä¼šé”™è¿‡ã€‚ Sequenceé‡Œé¢å¯ä»¥ä»…ä»…å­˜æ”¾ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚RACSignalé‡Œé¢ä¸ä»…åŒ…å«æ•°æ®ï¼Œä¹ŸåŒ…å«ä¿¡å·çš„çŠ¶æ€ï¼ˆåé¢ä¼šäº†è§£åˆ°ä¿¡å·çŠ¶æ€ï¼‰ã€‚ RACSequenceçš„ç®€å•ä½¿ç”¨RACSequenceä½¿ç”¨çš„æƒ…å†µå¾ˆå°‘ã€‚è¿™é‡Œå°±ç®€å•ä»‹ç»ä¸€ä¸‹å¸¸ç”¨æ–¹æ³• 123456789101112131415161718192021//åˆ›å»º RACSequence *sequence1 = [RACSequence return:@1]; RACSequence *sequence2 = [RACSequence sequenceWithHeadBlock:^id _Nullable{ return @2; } tailBlock:^RACSequence * _Nonnull{ return sequence1; }]; RACSequence *sequence3 = @[@1,@2,@3].rac_sequence; //å˜æ¢ RACSequence *mappedSequence = [sequence1 map:^id _Nullable(NSNumber* value) { return @(value.integerValue*3); }]; RACSequence *concatedSequence = [sequence2 concat:mappedSequence]; RACSequence *mergerdSequence = [RACSequence zip:@[concatedSequence,sequence3]]; //éå† NSLog(@\"%@\",mergerdSequence.head); for (id value in mergerdSequence) { NSLog(@\"%@\",value); } RACSignalçš„ç®€å•ä½¿ç”¨1234567891011121314151617181920212223//åˆ›å»º RACSignal *signal1 = [RACSignal return:@\"hello\"]; RACSignal *signal2 = [RACSignal createSignal:^RACDisposable * _Nullable(id&lt;RACSubscriber&gt; _Nonnull subscriber) { [subscriber sendNext:@1]; [subscriber sendNext:@2]; [subscriber sendCompleted]; return nil; }]; RACSignal *signal3 = RACObserve(self.view, backgroundColor); //å˜æ¢ RACSignal *mappedSignal = [signal1 map:^id _Nullable(NSString* value) { return [value stringByAppendingString:@\" word\"]; }]; RACSignal *concatedSignal = [mappedSignal concat:signal2]; RACSignal *mergeSignal = [mappedSignal merge:@[concatedSignal,signal3]]; //éå† [mergeSignal subscribeNext:^(id _Nullable x) { NSLog(@\"%@\",x); } completed:^{ NSLog(@\"completed\"); }]; è¿™é‡Œä»…ä»…æ˜¯å¯¹RACSignalåšåˆæ­¥äº†è§£ã€‚å…·ä½“æ–¹æ³•åˆ°åº•æ€ä¹ˆç”¨ã€‚åé¢çš„æ–‡ç« ä¼šè®²åˆ°ã€‚ RACSubscriber &amp; RACDisposableSubscription(è®¢é˜…è€…)è¡¨â½°ç­‰å¾…æˆ–è€…èƒ½å¤Ÿç­‰å¾…ä¿¡å·å‘é€äº‹ä»¶çš„ä»»æ„å¯¹è±¡ã€‚åœ¨æ¡†æ¶ä¸­ä½¿ç”¨RACSubscriberåè®®è¡¨ç¤º,ä¹Ÿå³ä»»æ„å®ç°äº†RACSubscriberåè®®çš„å¯¹è±¡éƒ½å¯ä»¥æ˜¯è®¢é˜…è€…ã€‚å¯ä»¥é€šè¿‡è°ƒâ½¤ -subscribeNext:error:completed:â½…æ³•æ¥åˆ›å»ºè®¢é˜…ã€‚RACStreamå’ŒRACSignalç±»çš„å¤§å¤šæ“ä½œä¹Ÿä¼šâ¾ƒå·±åˆ›å»ºè®¢é˜…ã€‚è®¢é˜…ä¼šå¯¹Signalså¯¹è±¡å¼•â½¤è®¡æ•°åŠ 1,å½“ä¿¡å·å‘é€é”™è¯¯æˆ–è€…å®Œæˆäº‹ä»¶å,ä¼šâ¾ƒåŠ¨è¢«å¤„ç†,ä¸éœ€è¦â½¤æˆ·å…³â¼¼å†…å­˜ç®¡ç†ã€‚å½“ç„¶,â½¤æˆ·ä¹Ÿå¯ä»¥â¼¿åŠ¨å¤„ç†ã€‚ RACDisposableç±»â½¤äºå–æ¶ˆè®¢é˜…æˆ–è€…æ¸…ç†èµ„æºã€‚ ä¸‹å›¾å±•ç¤ºäº†Subscriberã€Disposableã€Signalä¸‰è€…çš„å…³ç³» Scheduler ç”¨æ¥åšè°ƒåº¦ ä»£æ›¿GCD å¼‚æ­¥ä¸å¹¶å‘ schedulerç”±RACSchedulerç±»è¡¨ç¤º,å®ƒæ˜¯ä¿¡å·æ‰§è¡Œä»»åŠ¡æ—¶æ‰€åœ¨çš„é˜Ÿåˆ—(queue)æˆ–è€…ä¿¡å·æ‰§â¾å®Œåå°†ç»“æœæ”¾åˆ°é˜Ÿåˆ—â¾¥æ‰§è¡Œ,å¯ä»¥è®¤ä¸ºå°±æ˜¯gcdâ¾¥çš„queuesã€‚schedulerâ½€æŒå–æ¶ˆæ“ä½œ,â½½ä¸”å®ƒæ€»æ˜¯ä¸²è¡Œåœ°æ‰§â¾ä»»åŠ¡ã€‚è¿™æœ‰åˆ©äºé¿å…æ­»é”ã€‚RACScheduleræœ‰æ—¶å€™ä¹Ÿç±»ä¼¼NSOperationQueue,ä½†å®ƒä¸å…è®¸ä»»åŠ¡é—´ç›¸äº’ä¾èµ–ã€‚","link":"/2017/01/01/RAC-äºŒ-åŸºç¡€çŸ¥è¯†/"},{"title":"ä¼˜é›…çš„ä½¿ç”¨NSNotification.Name","text":"Swift 3ä¹‹å‰ä½¿ç”¨é€šçŸ¥ï¼š 1NSNotificationCenter.defaultCenter().post(\"kReceiveMessageNoti\") Swift 3ä¹‹å 1NotificationCenter.default.post(Notification.Name(rawValue: \"kReceiveMessageNoti\")) æ˜¾ç„¶ è¿™ç§ä½¿ç”¨å…¨å±€å­—ç¬¦ä¸²å¸¸äº®çš„æ–¹æ³•ä¸æ˜¯å¾ˆå¥½ã€‚ æˆ‘åœ¨é˜…è¯»Almofireçš„æ—¶å€™å‘ç°ï¼Œä½œè€…æ˜¯è¿™æ ·ä½¿ç”¨é€šçŸ¥çš„ï¼š 12345extension Notification.Name { public struct Task { public static let DidResume = Notification.Name(rawValue: \"org.alamofire.notification.name.task.didResume\") }} ä½¿ç”¨çš„æ—¶å€™ï¼š 12345NotificationCenter.default.post( name: Notification.Name.Task.DidResume, object: self, userInfo: [Notification.Key.Task: task] ) åˆ©ç”¨extensionä¸ºNotification.Nameæ·»åŠ ä¸€ä¸ªç»“æ„ä½“ï¼Œåœ¨ç»“æ„ä½“ä¸Šæ·»åŠ  é™æ€å¸¸é‡åŠæ³•ã€‚ç›´æ¥ä½¿ç”¨é™æ€å¸¸é‡å°±å¯ä»¥ï¼Œä½†æ˜¯ä½œè€…åˆä½¿ç”¨äº† ç»“æ„ä½“ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¸ºäº†ç»™é€šçŸ¥åç§°åˆ†ç±»ã€‚ æ˜¾ç„¶è¿™ç§æ–¹æ³•æ¯”æˆ‘ä»¬ç›´æ¥ä½¿ç”¨å¸¸é‡å­—ç¬¦ä¸²è¦å¥½å¾ˆå¤šã€‚ä¸‹é¢ã€‚å†ç»™å‡ºæˆ‘ä½¿ç”¨enumçš„æ–¹æ³• 1234567891011121314enum DDNotificationName: String { /// æ³¨é”€æˆåŠŸ case logoutSuccess /// ç™»å½•æˆåŠŸ case loginSuccess //æ”¶åˆ°æ¶ˆæ¯ case receiveMessage var name: NSNotification.Name { return NSNotification.Name(\"k\" + rawValue) }} 1NotificationCenter.default.post(name: DDNotificationName.loginSuccess.name, object: nil)","link":"/2018/05/18/ä¼˜é›…çš„ä½¿ç”¨NSNotification-name/"},{"title":"å…¥é—¨æ±‡ç¼–è¯­è¨€","text":"äº†è§£æ±‡ç¼–è¯­è¨€ç¼–ç¨‹è¯­è¨€çš„å‘å±• æœºå™¨è¯­è¨€ ç”±0å’Œ1ç»„æˆ æ±‡ç¼–è¯­è¨€ ï¼ˆAssembly Languageï¼‰ ç”¨ç¬¦å·ä»£æ›¿äº†0å’Œ1ï¼Œæ¯”æœºå™¨è¯­è¨€ä¾¿äºé˜…è¯»å’Œæœºç¿¼ é«˜çº§è¯­è¨€ C\\C++\\Java\\Swiftç­‰ï¼Œæ›´æ¥è¿‘äººç±»è‡ªç„¶è¯­è¨€ åˆ†åˆ«ç”¨ä¸Šé¢ä¸‰ç§è¯­è¨€å®ç°ï¼š å°†å¯„å­˜å™¨BXçš„å†…å®¹é€äººå¯„å­˜å™¨AX æœºå™¨è¯­è¨€ï¼š 10010100010101 æ±‡ç¼–è¯­è¨€ï¼šmov ax,bx é«˜çº§è¯­è¨€ï¼šax = bx ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œè¶Šä½çº§çš„è¯­è¨€ï¼Œè¶Šæ˜¯éš¾ä»¥ç†è§£ã€‚ã€‚ã€‚ æ±‡ç¼–è¯­è¨€ ä¸ æœºå™¨è¯­è¨€ ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸€æ¡æœºå™¨æŒ‡ä»¤éƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ æ±‡ç¼–è¯­è¨€ å¯ä»¥é€šè¿‡ç¼–è¯‘å¾—åˆ°æœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€å¯ä»¥é€šè¿‡åæ±‡ç¼–å¾—åˆ°æ±‡ç¼–è¯­è¨€ é«˜çº§è¯­è¨€å¯ä»¥é€šè¿‡ç¼–è¯‘å¾—åˆ°æ±‡ç¼–è¯­è¨€ \\ æœºå™¨è¯­è¨€ï¼Œä½†æ±‡ç¼–è¯­è¨€ \\ æœºå™¨è¯­è¨€å‡ ä¹ä¸å¯èƒ½è¿˜åŸæˆé«˜çº§è¯­è¨€ æ±‡ç¼–è¯­è¨€çš„ç‰¹ç‚¹ å¯ä»¥ç›´æ¥è®¿é—®ã€æ§åˆ¶å„ç§ç¡¬ä»¶è®¾å¤‡ï¼Œæ¯”å¦‚å­˜å‚¨å™¨ã€CPUç­‰ï¼Œèƒ½æœ€å¤§é™åº¦çš„å‘æŒ¥ç¡¬ä»¶çš„åŠŸèƒ½ æ±‡ç¼–æŒ‡ä»¤æ˜¯æœºå™¨æŒ‡ä»¤çš„åŠ©è®°ç¬¦ï¼ŒåŒæœºå™¨æŒ‡ä»¤ä¸€ä¸€å¯¹åº”ã€‚æ¯ä¸€ç§CPUéƒ½æœ‰è‡ªå·±çš„æœºå™¨æŒ‡ä»¤é›†\\æ±‡ç¼–æŒ‡ä»¤é›†ï¼Œæ‰€ä»¥æ±‡ç¼–è¯­è¨€ä¸å…·å¤‡å¯ç§»æ¤æ€§ çŸ¥è¯†ç‚¹è¿‡å¤šï¼Œå¼€å‘è€…éœ€è¦å¯¹CPUç­‰ç¡¬ä»¶ç»“æ„æœ‰æ‰€äº†è§£ï¼Œä¸æ˜“äºç¼–å†™ã€è°ƒè¯•ã€ç»´æŠ¤ ä¸åŒºåˆ†å¤§å°å†™ã€æ¯”å¦‚ mov å’ŒMOVæ˜¯ä¸€æ ·çš„ æ±‡ç¼–è¯­è¨€ç§ç±»å¾ˆå¤š 8086æ±‡ç¼– Win32æ±‡ç¼– Win64æ±‡ç¼– AT&amp;Tæ±‡ç¼–ï¼ˆMacã€iOSæ¨¡æ‹Ÿå™¨ï¼‰ ARMæ±‡ç¼–ï¼ˆåµŒå…¥å¼è®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯æ‰‹æœºç”µè§†è½¦è½½ç³»ç»Ÿä¹‹ç±»ï¼‰ æ±‡ç¼–è¯­è¨€VSé«˜çº§è¯­è¨€é‡‡ç”¨é«˜çº§è¯­è¨€C++å’Œæ±‡ç¼–è¯­è¨€ç¼–å†™åŒä¸€ä¸ªåŠŸèƒ½ ï¼š å°†a+bçš„ç»“æœèµ‹å€¼ç»™cï¼Œç„¶ååœ¨å±å¹•ä¸Šæ‰“å°cçš„ç»“æœ è¯­è¨€ æºæ–‡ä»¶å¤§å° ç›®æ ‡æ–‡ä»¶å¤§å° å¯æ‰§è¡Œæ–‡ä»¶å¤§å° æ±‡ç¼–è¯­è¨€ è¿‘400å­—èŠ‚ è¿‘200å­—èŠ‚ è¿‘600å­—èŠ‚ C++ è¿‘150å­—èŠ‚ è¿‘550å­—èŠ‚ è¿‘9000å­—èŠ‚ CPUæ€»çº¿æ¯ä¸€ä¸ªCPUèŠ¯ç‰‡éƒ½æœ‰è®¸å¤šç®¡è„šï¼ˆä¸Šå›¾å³è¾¹é“¶è‰²çš„è§¦è§’ï¼‰ï¼Œè¿™äº›ç®¡è„šå’Œæ€»çº¿ç›¸è¿ï¼ŒCPUé€šè¿‡æ€»çº¿è·Ÿå¤–éƒ¨è¿›è¡Œäº¤äº’ï¼› æ€»çº¿ï¼šä¸€æ ¹æ ¹å¯¼çº¿çš„é›†åˆ æ€»çº¿çš„åˆ†ç±»ï¼š åœ°å€æ€»çº¿ æ•°æ®æ€»çº¿ æ§åˆ¶æ€»çº¿ åœ°å€æ€»çº¿å®ƒçš„å®½åº¦å†³å®šäº†CPUçš„ å¯»å€èƒ½åŠ› ï¼ˆä»€ä¹ˆæ˜¯å¯»å€èƒ½åŠ›ï¼ŒæŒ‡å®ƒèƒ½æ‰¾åˆ°å¤šå¤§çš„åœ°å€ï¼‰ 8086çš„æ•°æ®æ€»çº¿å®½åº¦æ˜¯16ï¼Œæ‰€ä»¥å¯»å€èƒ½åŠ›å³ä¸º220B = 210B 2 10=1KB 210 = 1KB * 1024 = 1M ä»€ä¹ˆæ˜¯å¯»å€èƒ½åŠ›ï¼Ÿå¯»å€èƒ½åŠ›ä¸ºä»€ä¹ˆå¦‚ä¸Šé¢è¿™æ ·è®¡ç®—ï¼Ÿ ç”±äºè§£é‡Šèµ·æ¥ç¯‡å¹…ä¸çŸ­ï¼Œæ‰€ä»¥æ–°å¼€ä¸€ç¯‡æ–‡ç« ä¸“é—¨ç ”ç©¶ ã€ŠCPUå¯»å€èƒ½åŠ›åˆ°åº•æ€ä¹ˆç†è§£ï¼Ÿã€‹ æ•°æ®æ€»çº¿å®ƒçš„å®½åº¦å†³å®šäº†CPUçš„å•æ¬¡æ•°æ®ä¼ é€é‡ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¼ é€é€Ÿåº¦ 8086çš„æ•°æ®æ€»çº¿å®½åº¦æ˜¯16ï¼Œæ‰€ä»¥å•æ¬¡æœ€å¤§ä¼ é€’2ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚å› ä¸º16æ ¹çº¿ï¼Œä»£è¡¨16ä½ï¼Œ8ä½ç­‰äº1å­—èŠ‚ï¼Œæ‰€ä»¥æ˜¯2å­—èŠ‚ã€‚ æ³¨æ„ï¼ï¼è¿™é‡Œçš„æ•°æ®æ€»çº¿åƒä¸‡ä¸è¦å’Œä»€ä¹ˆçš„åœ°å€æ€»çº¿ææ··ï¼Œå®Œå…¨æ˜¯ä¸¤ç äº‹å„¿ æ§åˆ¶æ€»çº¿å®ƒçš„å®½åº¦å†³å®šäº†CPUå¯¹å…¶ä»–å™¨ä»¶çš„æ§åˆ¶èƒ½åŠ›ã€èƒ½æœ‰å¤šå°‘ç§æ§åˆ¶ æ§åˆ¶æ€»çº¿ çŸ¥é“å¤§æ¦‚å°±è¡Œï¼Œä¸éœ€è¦æ·±ç©¶ 8086çš„å¯»å€æ–¹å¼æ±‡ç¼–è¯­è¨€å­¦ä¹ èµ„æ–™æ•´ç†ã€Šæ±‡ç¼–è¯­è¨€(ç¬¬ä¸‰ç‰ˆ)ã€‹-ç‹çˆ½ è±†ç“£9.2åˆ† å¿…çœ‹ï¼ï¼è¿™æœ¬ä¹¦ä¹°äº†ï¼Œæ­£åœ¨å­¦ä¹ ã€‚å¾ˆå¥½ï¼ï¼ ã€Šæ±‡ç¼–è¯­è¨€è®ºå›ã€‹ å·²ç»å¾ˆå°‘æœ‰äººè®¨è®ºäº†ã€‚ä½†æ˜¯é‡Œé¢æœ‰å¾ˆå¤šä»¥å‰è®¨è®ºçš„é—®é¢˜å’Œè§£ç­”ï¼Œå¾ˆæœ‰å‚è€ƒä»·å€¼ ã€Šé›¶åŸºç¡€å…¥é—¨å­¦ä¹ æ±‡ç¼–è¯­è¨€ã€‹- å°ç”²é±¼ è¿™æ˜¯ä¸€å¥—è§†é¢‘ï¼Œæ²¡æœ‰çœ‹è¿‡ï¼Œä½†æ˜¯åœ¨ç½‘ä¸ŠæŸ¥æ‰¾æ±‡ç¼–ç›¸å…³çš„èµ„æ–™çš„æ—¶å€™ï¼Œå‘ç°å¾ˆå¤šç½‘å‹éƒ½æ˜¯çœ‹è¿‡è¿™å¥—è§†é¢‘ï¼Œå¯¹äºå…¥é—¨åº”è¯¥ä¸é”™ã€‚ ä¸Šå¤§å­¦çš„æ—¶å€™è®°å¾—æœ‰çœ‹è¿‡ä»–çš„å…¥é—¨Cè¯­è¨€è§†é¢‘","link":"/2018/05/15/å…¥é—¨æ±‡ç¼–è¯­è¨€/"},{"title":"åœ¨CentOS7ä¸Šæ­å»ºShadowsocks","text":"å‰æï¼šè´­ä¹°ä¸€å°å›½å¤–ä¸»æœºï¼Œæˆ‘æ˜¯åœ¨æ¬ç“¦å·¥ä¸Šä¹°çš„ é¦–å…ˆä½¿ç”¨SSHç™»å½•åœ¨CENTOS7ä¸Šæ­å»ºShadowsocksåœ¨CENTOS7ä¸Šæ­å»ºShadowsocks 1ssh -p ç«¯å£å· username@ip ä¾‹å¦‚ æˆ‘çš„ç«¯å£å·æ˜¯23456ï¼Œ usernameæ˜¯root ï¼Œipåœ°å€æ˜¯123.232.123.123 â€œssh -p 23456 root@123.232.123.123â€ ç™»å½•æˆåŠŸå¦‚ä¸‹ï¼š å®‰è£…pipç™»å½•ä¹‹å è¾“å…¥ https://bootstrap.pypa.io/get-pip.py -o get-pip.py åŠ å›è½¦ è¾“å…¥python get-pip.pyåŠ å›è½¦ æ•ˆæœå¦‚ä¸‹ å®‰è£…Shadowsocksè¾“å…¥pip install shadowsocksåå›è½¦ï¼Œå¦‚ä¸‹ï¼š é…ç½®Shadowsocksè¾“å…¥ç¼–è¾‘æ–‡ä»¶å‘½ä»¤vi /etc/shadowsocks.jsonå¹¶å›è½¦ è¾“å…¥ä¸‹é¢å†…å®¹ 12345678{ &quot;server&quot;:&quot;0.0.0.0&quot;, &quot;server_port&quot;:9057, &quot;local_port&quot;:10080, &quot;password&quot;:&quot;1234567890&quot;, &quot;timeout&quot;:600, &quot;method&quot;:&quot;aes-256-cfb&quot;} 9057 æ˜¯ç«¯å£ 1234567890 æ˜¯å¯†ç  å°†ShadowsocksåŠ å…¥ç³»ç»ŸæœåŠ¡è¾“å…¥ç¼–è¾‘æ–‡ä»¶å‘½ä»¤vi /etc/systemd/system/shadowsocks.serviceå¹¶å›è½¦ ç²˜è´´ä¸‹é¢å†…å®¹ï¼š 1234567[Unit]Description=Shadowsocks[Service]TimeoutStartSec=0ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json[Install]WantedBy=multi-user.target å¯åŠ¨ShadowsocksæœåŠ¡ï¼Œå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨12345678# è®¾ç½®å¼€æœºè‡ªå¯å‘½ä»¤systemctl enable shadowsocks# å¯åŠ¨å‘½ä»¤systemctl start shadowsocks#æŸ¥çœ‹çŠ¶æ€å‘½ä»¤systemctl status shadowsocks ä¾æ¬¡æ‰§è¡Œä¸Šé¢ä¸‰æ¡å‘½ä»¤å¦‚ä¸‹ï¼š active æ˜¾ç¤ºrunning å°±æˆåŠŸäº† Mac shadowsocks è½¯ä»¶ä¸‹è½½åœ°å€ï¼š https://github.com/shadowsocks/ShadowsocksX-NG iOS shadowsocks è¦å»å›½å¤–appStore ä¸‹è½½","link":"/2019/08/14/åœ¨CentOS7ä¸Šæ­å»ºShadowsocks/"},{"title":"@propertyä¸@dynamic","text":"æˆ‘ä»¬ç»å¸¸ä½¿ç”¨@property å£°æ˜ä¸€ä¸ªå±æ€§ï¼Œä½†æ˜¯äº†è§£@propertyåˆ°åº•åšäº†å“ªäº›äº‹æƒ…å‘¢ï¼Ÿ å…¶å®propertyä»…ä»…æ˜¯å£°æ˜äº† setter å’Œ getter æ–¹æ³•ï¼ˆæ²¡æœ‰å®ç°ï¼‰ã€‚ @property å¯¹åº”çš„æ˜¯ @synthesize å’Œ @dynamic åœ¨Xcode4.5åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥çœç•¥@synthesizeï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤å¸®ä½ åŠ ä¸Š@synthesize ivar = _ivar; @synthesize ivar = _ivarçš„ä½œç”¨æ˜¯ï¼š åœ¨.mæ–‡ä»¶ä¸­ç”Ÿæˆä¸€ä¸ªç§æœ‰_ivarå˜é‡ä»¥åŠç”Ÿæˆå¯¹åº”ivarçš„getterå’Œsetteræ–¹æ³•çš„å®ç°ã€‚ @dynamic ivarçš„ä½œç”¨æ˜¯ï¼š ä¸ä¼šç”Ÿæˆ_ivarå˜é‡ï¼Œä¹Ÿä¸ä¼šç”Ÿæˆå¯¹åº”ivarçš„getterå’Œsetterçš„æ–¹æ³•å®ç°ã€‚åªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨,å±æ€§çš„setterä¸getteræ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆã€‚ é€šè¿‡ä¸€ä¸‹ä»£ç å¯ä»¥éªŒè¯ï¼Œä½¿ç”¨@dynamic ivar;çš„æ—¶å€™ï¼Œä¸ä»…æ²¡æœ‰getterå’Œsetteræ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿå¹¶æ²¡æœ‰ç”Ÿæˆæˆå‘˜å˜é‡ã€‚ 1234567891011121314151617181920@interface Person : NSObject@property (nonatomic, copy) NSString *name;@end@implementation Person@dynamic name;@end{unsigned int ivar_count = 0;unsigned int property_count = 0;//è·å–æ‰€æœ‰æˆå‘˜å˜é‡class_copyIvarList([Person class], &amp;ivar_count);//è·å–æ‰€æœ‰å±æ€§class_copyPropertyList([Person class], &amp;property_count);NSLog(@\"%d\",ivar_count);NSLog(@\"%d\",property_count);//å½“ä½¿ç”¨@dynamic name: ivar_count = 0;property_count = 1;//å½“ä½¿ç”¨@synthesize : ivar_count = 1;property_count = 1;}","link":"/2016/05/11/propertyä¸-dynamic/"},{"title":"å¤šçº¿ç¨‹åŸºç¡€ç¯‡","text":"åŸºæœ¬æ¦‚å¿µå­¦ä¹ å¤šçº¿ç¨‹ä¹‹å‰ï¼Œé¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œä»¥åŠè¿›ç¨‹ä¸çº¿ç¨‹çš„å…³ç³»ï¼š è¿›ç¨‹ï¼š è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ï¼ˆæ¯”å¦‚æ‰“å¡QQ,å°±æ˜¯æ‰“å¼€äº†ä¸€ä¸ªè¿›ç¨‹ï¼‰ æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†… çº¿ç¨‹ï¼š ä¸€ä¸ªè¿›ç¨‹æƒ³è¦æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹ï¼ˆæ¯ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€æ¡çº¿ç¨‹ï¼‰ è¿›ç¨‹ä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„ æ€»ç»“ï¼š è¿›ç¨‹æœ‰ç‹¬ç«‹çš„ç©ºé—´åœ°å€ï¼Œè€Œçº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„ã€‚ è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½(è¿›ç¨‹æ˜¯ä¸€å—åŒ…å«äº†æŸäº›èµ„æºçš„å†…å­˜åŒºåŸŸ)ã€‚ çº¿ç¨‹æ˜¯CPUç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½(å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œçš„ä»£ç ç‰‡æ®µ)ã€‚ å…³äºå¤šçº¿ç¨‹äº†è§£äº†è¿›ç¨‹å’Œçº¿ç¨‹ä¹‹åï¼Œé‚£ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹å‘¢ï¼Ÿ 1ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹ä¸­å¯ä»¥å¹¶è¡Œï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚ å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„åŸç†ï¼Ÿ åœ¨åŒä¸€æ—¶é—´å†…ã€‚CPUåªèƒ½å¤„ç†1æ¡çº¿ç¨‹ï¼Œåªæœ‰1æ¡çº¿ç¨‹åœ¨å·¥ä½œï¼ˆæ‰§è¡Œï¼‰ã€‚å¤šçº¿ç¨‹å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼Œå…¶å®æ˜¯CPUå¿«é€Ÿåœ°åœ¨å¤šçº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰ï¼Œå¦‚æœCPUè°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«ã€‚é‚£å°±é€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡ã€‚ å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜åˆ©ç”¨ç‡ï¼‰ ç¼ºç‚¹ å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å ç”¨1Mï¼Œå­çº¿ç¨‹å ç”¨512KBï¼‰ï¼Œå¦‚æœå¼€å¯å¤§é‡çš„çº¿ç¨‹ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ï¼Œé™ä½ç¨‹åºæ€§èƒ½ çº¿ç¨‹è¶Šå¤šï¼ŒCPUåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§ ç¨‹åºè®¾è®¡æ›´åŠ å¤æ‚ï¼šæ¯”å¦‚çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€å¤šçº¿ç¨‹çš„æ•°æ®å…±äº« çº¿ç¨‹çš„çŠ¶æ€ ä¸‹é¢åˆ†åˆ«é˜è¿°çº¿ç¨‹å‘¨æœŸä¸­çš„æ¯ä¸€æ­¥ï¼š æ–°å»ºï¼šå®ä¾‹åŒ–çº¿ç¨‹å¯¹è±¡ å°±ç»ªï¼šå‘çº¿ç¨‹å¯¹è±¡å‘é€startæ¶ˆæ¯ï¼Œçº¿ç¨‹å¯¹è±¡è¢«åŠ å…¥å¯è°ƒåº¦çº¿ç¨‹æ± ç­‰å¾…CPUè°ƒåº¦ã€‚ è¿è¡Œï¼šCPUè´Ÿè´£è°ƒåº¦å¯è°ƒåº¦çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ‰§è¡Œã€‚çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹å‰ï¼ŒçŠ¶æ€å¯èƒ½ä¼šåœ¨å°±ç»ªå’Œè¿è¡Œä¹‹é—´æ¥å›åˆ‡æ¢ã€‚å°±ç»ªå’Œè¿è¡Œä¹‹é—´çš„çŠ¶æ€å˜åŒ–æœ‰CPUè´Ÿè´£ï¼Œç¨‹åºå‘˜ä¸èƒ½å¹²é¢„ã€‚ é˜»å¡ï¼šå½“æ»¡è¶³æŸä¸ªé¢„å®šæ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¼‘çœ æˆ–é”ï¼Œé˜»å¡çº¿ç¨‹æ‰§è¡Œã€‚sleepForTimeIntervalï¼ˆä¼‘çœ æŒ‡å®šæ—¶é•¿ï¼‰ï¼ŒsleepUntilDate(ä¼‘çœ åˆ°æŒ‡å®šæ—¥æœŸ),@synchronized(self)ï¼š(äº’æ–¥é”)ã€‚ æ­»äº¡ï¼šæ­£å¸¸æ­»äº¡ï¼Œçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ã€‚éæ­£å¸¸æ­»äº¡ï¼Œå½“æ»¡è¶³æŸä¸ªæ¡ä»¶åï¼Œåœ¨çº¿ç¨‹å†…éƒ¨ä¸­æ‰§è¡Œ/åœ¨ä¸»çº¿ç¨‹ä¸­æ­¢çº¿ç¨‹å¯¹è±¡ è¿˜æœ‰çº¿ç¨‹çš„exitå’Œcancel ã€NSThread exitã€‘:ä¸€æ—¦å¼ºè¡Œç»ˆæ­¢çº¿ç¨‹ï¼Œåç»­çš„æ‰€æœ‰ä»£ç éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚ ã€thread cancelã€‘å–æ¶ˆï¼Œå¹¶ä¸ä¼šç›´æ¥å–æ¶ˆçº¿ç¨‹ï¼Œåªæ˜¯ç»™çº¿ç¨‹å¯¹è±¡æ·»åŠ isCancelledæ ‡è®°ã€‚ iOSä¸­å¤šçº¿ç¨‹çš„å®ç°æ–¹æ¡ˆ ç‰¹ç‚¹ ä½¿ç”¨è¯­è¨€ ä½¿ç”¨é¢‘ç‡ çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸ pthread 1ï¼‰è·¨å¹³å°ï¼Œå¯ç§»æ¤ï¼› 2ï¼‰ä½¿ç”¨èµ·æ¥æŒºéš¾å§ C å‡ ä¹ä¸ç”¨ ç”±ç¨‹åºå‘˜è¿›è¡Œç®¡ç† NSThread 1ï¼‰é¢å‘å¯¹è±¡ï¼›2ï¼‰ç®€å•ï¼Œå¯ä»¥ç›´æ¥æ“ä½œçº¿ç¨‹å¯¹è±¡ OC å¶å°” ç”±ç¨‹åºå‘˜è¿›è¡Œç®¡ç† GCD 1ï¼‰æ—¨åœ¨æ›¿ä»£NSThreadç­‰çº¿ç¨‹æŠ€æœ¯ 2ï¼‰å……åˆ†åˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸ C ç»å¸¸ è‡ªåŠ¨ç®¡ç† NSOperation 1ï¼‰åº•å±‚æ˜¯GCDï¼›2ï¼‰æ¯”GCDå¤šäº†ä¸€äº›æ›´ç®€å•å®ç”¨çš„åŠŸèƒ½ï¼›3ï¼‰å®ç”¨æ›´åŠ é¢å‘å¯¹è±¡ OC ç»å¸¸ è‡ªåŠ¨ç®¡ç† pthread123456789101112// import &lt;phtread.h&gt;//1.åˆ›å»ºçº¿ç¨‹å¯¹è±¡ pthread_t thread; //2.åˆ›å»ºçº¿ç¨‹ /* ç¬¬ä¸€ä¸ªå‚æ•°:çº¿ç¨‹å¯¹è±¡ ä¼ é€’åœ°å€ ç¬¬äºŒä¸ªå‚æ•°:çº¿ç¨‹çš„å±æ€§ NULL ç¬¬ä¸‰ä¸ªå‚æ•°:æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ ç¬¬å››ä¸ªå‚æ•°:å‡½æ•°éœ€è¦æ¥å—çš„å‚æ•° */ pthread_create(&amp;thread, NULL, task, NULL); NSThread(1) åŸºæœ¬ä½¿ç”¨ 1234567891011121314151617181920212223//ç¬¬ä¸€ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šalloc init.//ç‰¹ç‚¹ï¼šéœ€è¦æ‰‹åŠ¨å¼€å¯çº¿ç¨‹ï¼Œå¯ä»¥æ‹¿åˆ°çº¿ç¨‹å¯¹è±¡è¿›è¡Œè¯¦ç»†è®¾ç½®//åˆ›å»ºçº¿ç¨‹/*ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡ç¬¬äºŒä¸ªå‚æ•°ï¼šé€‰æ‹©å™¨ï¼Œçº¿ç¨‹å¯åŠ¨è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå‰é¢æ–¹æ³•è¦æ¥æ”¶çš„å‚æ•°ï¼ˆæœ€å¤šåªèƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œæ²¡æœ‰åˆ™ä¼ nilï¼‰*/NSThread *thread = [[NSThread alloc]initWithTarget:self selector:@selector(run:) object:@\"wendingding\"];//å¯åŠ¨çº¿ç¨‹[thread start]; //ç¬¬äºŒç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šåˆ†ç¦»å‡ºä¸€æ¡å­çº¿ç¨‹//ç‰¹ç‚¹ï¼šè‡ªåŠ¨å¯åŠ¨çº¿ç¨‹ï¼Œæ— æ³•å¯¹çº¿ç¨‹è¿›è¡Œæ›´è¯¦ç»†çš„è®¾ç½®/*ç¬¬ä¸€ä¸ªå‚æ•°ï¼šçº¿ç¨‹å¯åŠ¨è°ƒç”¨çš„æ–¹æ³•ç¬¬äºŒä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¼ é€’ç»™è°ƒç”¨æ–¹æ³•çš„å‚æ•°*/[NSThread detachNewThreadSelector:@selector(run:) toTarget:self withObject:@\"æˆ‘æ˜¯åˆ†ç¦»å‡ºæ¥çš„å­çº¿ç¨‹\"];//ç¬¬ä¸‰ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šåå°çº¿ç¨‹//ç‰¹ç‚¹ï¼šè‡ªåŠ¨å¯åŠ¨å¿åŸï¼Œæ— æ³•è¿›è¡Œæ›´è¯¦ç»†è®¾ç½®[self performSelectorInBackground:@selector(run:) withObject:@\"æˆ‘æ˜¯åå°çº¿ç¨‹\"]; ï¼ˆ2ï¼‰è®¾ç½®çº¿ç¨‹çš„å±æ€§ 123456//è®¾ç½®çº¿ç¨‹çš„å±æ€§//è®¾ç½®çº¿ç¨‹çš„åç§°thread.name = @\"çº¿ç¨‹A\";//è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§,æ³¨æ„çº¿ç¨‹ä¼˜å…ˆçº§çš„å–å€¼èŒƒå›´ä¸º0.0~1.0ä¹‹é—´ï¼Œ1.0è¡¨ç¤ºçº¿ç¨‹çš„ä¼˜å…ˆçº§æœ€é«˜,å¦‚æœä¸è®¾ç½®è¯¥å€¼ï¼Œé‚£ä¹ˆç†æƒ³çŠ¶æ€ä¸‹é»˜è®¤ä¸º0.5thread.threadPriority = 1.0; ï¼ˆ3ï¼‰çº¿ç¨‹çš„çŠ¶æ€ 123456//çº¿ç¨‹çš„å„ç§çŠ¶æ€ï¼šæ–°å»º-å°±ç»ª-è¿è¡Œ-é˜»å¡-æ­»äº¡//å¸¸ç”¨çš„æ§åˆ¶çº¿ç¨‹çŠ¶æ€çš„æ–¹æ³•[NSThread exit];//é€€å‡ºå½“å‰çº¿ç¨‹[NSThread sleepForTimeInterval:2.0];//é˜»å¡çº¿ç¨‹[NSThread sleepUntilDate:[NSDate dateWithTimeIntervalSinceNow:2.0]];//é˜»å¡çº¿ç¨‹//æ³¨æ„ï¼šçº¿ç¨‹æ­»äº†ä¸èƒ½å¤ç”Ÿ ï¼ˆ4ï¼‰çº¿ç¨‹å®‰å…¨ 123456//çº¿ç¨‹çš„å„ç§çŠ¶æ€ï¼šæ–°å»º-å°±ç»ª-è¿è¡Œ-é˜»å¡-æ­»äº¡//å¸¸ç”¨çš„æ§åˆ¶çº¿ç¨‹çŠ¶æ€çš„æ–¹æ³•[NSThread exit];//é€€å‡ºå½“å‰çº¿ç¨‹[NSThread sleepForTimeInterval:2.0];//é˜»å¡çº¿ç¨‹[NSThread sleepUntilDate:[NSDate dateWithTimeIntervalSinceNow:2.0]];//é˜»å¡çº¿ç¨‹//æ³¨æ„ï¼šçº¿ç¨‹æ­»äº†ä¸èƒ½å¤ç”Ÿ ï¼ˆ5ï¼‰çº¿ç¨‹é—´é€šä¿¡ 1234567891011121314151617181920212223242526272829-(void)touchesBegan:(nonnull NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event{// [self download2]; //å¼€å¯ä¸€æ¡å­çº¿ç¨‹æ¥ä¸‹è½½å›¾ç‰‡ [NSThread detachNewThreadSelector:@selector(downloadImage) toTarget:self withObject:nil];}-(void)downloadImage{ //1.ç¡®å®šè¦ä¸‹è½½ç½‘ç»œå›¾ç‰‡çš„urlåœ°å€ï¼Œä¸€ä¸ªurlå”¯ä¸€å¯¹åº”ç€ç½‘ç»œä¸Šçš„ä¸€ä¸ªèµ„æº NSURL *url = [NSURL URLWithString:@\"http://p6.qhimg.com/t01d2954e2799c461ab.jpg\"]; //2.æ ¹æ®urlåœ°å€ä¸‹è½½å›¾ç‰‡æ•°æ®åˆ°æœ¬åœ°ï¼ˆäºŒè¿›åˆ¶æ•°æ® NSData *data = [NSData dataWithContentsOfURL:url]; //3.æŠŠä¸‹è½½åˆ°æœ¬åœ°çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆå›¾ç‰‡ UIImage *image = [UIImage imageWithData:data]; //4.å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UI //4.1 ç¬¬ä¸€ç§æ–¹å¼// [self performSelectorOnMainThread:@selector(showImage:) withObject:image waitUntilDone:YES]; //4.2 ç¬¬äºŒç§æ–¹å¼// [self.imageView performSelectorOnMainThread:@selector(setImage:) withObject:image waitUntilDone:YES]; //4.3 ç¬¬ä¸‰ç§æ–¹å¼ [self.imageView performSelector:@selector(setImage:) onThread:[NSThread mainThread] withObject:image waitUntilDone:YES];} ï¼ˆ6ï¼‰å¦‚ä½•è®¡ç®—ä»£ç æ®µçš„æ‰§è¡Œæ—¶é—´ 1234567891011121314//ç¬¬ä¸€ç§æ–¹æ³• NSDate *start = [NSDate date]; //2.æ ¹æ®urlåœ°å€ä¸‹è½½å›¾ç‰‡æ•°æ®åˆ°æœ¬åœ°ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ NSData *data = [NSData dataWithContentsOfURL:url]; NSDate *end = [NSDate date]; NSLog(@\"ç¬¬äºŒæ­¥æ“ä½œèŠ±è´¹çš„æ—¶é—´ä¸º%f\",[end timeIntervalSinceDate:start]);//ç¬¬äºŒç§æ–¹æ³• CFTimeInterval start = CFAbsoluteTimeGetCurrent(); NSData *data = [NSData dataWithContentsOfURL:url]; CFTimeInterval end = CFAbsoluteTimeGetCurrent(); NSLog(@\"ç¬¬äºŒæ­¥æ“ä½œèŠ±è´¹çš„æ—¶é—´ä¸º%f\",end - start); GCDï¼ˆ1ï¼‰åŸºæœ¬æ¦‚å¿µ 1201 ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µ-é˜Ÿåˆ—å’Œä»»åŠ¡02 åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥å‡½æ•° ï¼ˆ2ï¼‰GCDåŸºæœ¬ä½¿ç”¨ 123456701 å¼‚æ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šå¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œä»»åŠ¡02 å¼‚æ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šå¼€å¯ä¸€æ¡çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡03 åŒæ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡04 åŒæ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡05 å¼‚æ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ä¸²è¡Œæ‰§è¡Œä»»åŠ¡06 åŒæ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼ˆæ³¨æ„æ­»é”å‘ç”Ÿï¼‰07 æ³¨æ„åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥å‡½æ•°åœ¨æ‰§è¡Œé¡ºåºä¸Šé¢çš„å·®å¼‚ ï¼ˆ3ï¼‰GCDé—´çº¿ç¨‹é€šä¿¡ 123456789101112131415161718192021//0.è·å–ä¸€ä¸ªå…¨å±€çš„é˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_global_queue(0, 0); //1.å…ˆå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼ŒæŠŠä¸‹è½½å›¾ç‰‡çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­å¤„ç† dispatch_async(queue, ^{ //2.ä¸‹è½½å›¾ç‰‡ NSURL *url = [NSURL URLWithString:@\"http://h.hiphotos.baidu.com/zhidao/pic/item/6a63f6246b600c3320b14bb3184c510fd8f9a185.jpg\"]; NSData *data = [NSData dataWithContentsOfURL:url]; UIImage *image = [UIImage imageWithData:data]; NSLog(@\"ä¸‹è½½æ“ä½œæ‰€åœ¨çš„çº¿ç¨‹--%@\",[NSThread currentThread]); //3.å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UI dispatch_async(dispatch_get_main_queue(), ^{ self.imageView.image = image; //æ‰“å°æŸ¥çœ‹å½“å‰çº¿ç¨‹ NSLog(@\"åˆ·æ–°UI---%@\",[NSThread currentThread]); }); }); ï¼ˆ4ï¼‰GCDå…¶ä»–å¸¸ç”¨å‡½æ•° 12345678910111213141516171819202122232425262728293031323334353637 01 æ …æ å‡½æ•°ï¼ˆæ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼‰dispatch_barrier_async(queue, ^{ NSLog(@\"--dispatch_barrier_async-\");});02 å»¶è¿Ÿæ‰§è¡Œï¼ˆå»¶è¿ŸÂ·æ§åˆ¶åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰ dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{ NSLog(@\"---%@\",[NSThread currentThread]);});03 ä¸€æ¬¡æ€§ä»£ç ï¼ˆæ³¨æ„ä¸èƒ½æ”¾åˆ°æ‡’åŠ è½½ï¼‰-(void)once{ //æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªä¼šæ‰§è¡Œä¸€æ¬¡ //onceTokenç”¨æ¥è®°å½•è¯¥éƒ¨åˆ†çš„ä»£ç æ˜¯å¦è¢«æ‰§è¡Œè¿‡ static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ NSLog(@\"-----\"); });}04 å¿«é€Ÿè¿­ä»£ï¼ˆå¼€å¤šä¸ªçº¿ç¨‹å¹¶å‘å®Œæˆè¿­ä»£æ“ä½œï¼‰ dispatch_apply(subpaths.count, queue, ^(size_t index) {});05 é˜Ÿåˆ—ç»„ï¼ˆåŒæ …æ å‡½æ•°ï¼‰//åˆ›å»ºé˜Ÿåˆ—ç»„dispatch_group_t group = dispatch_group_create();//é˜Ÿåˆ—ç»„ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œè¯¥å‡½æ•°dispatch_group_notify(dispatch_group_t group,dispatch_queue_t queue,dispatch_block_t block);06è¿›å…¥ç¾¤ç»„å’Œç¦»å¼€ç¾¤ç»„dispatch_group_enter(group);//æ‰§è¡Œè¯¥å‡½æ•°åï¼Œåé¢å¼‚æ­¥æ‰§è¡Œçš„blockä¼šè¢«gruopç›‘å¬dispatch_group_leave(group);//å¼‚æ­¥blockä¸­ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œæœ€åç¦»å¼€ç¾¤ç»„//æ³¨æ„ï¼šdispatch_group_enter|dispatch_group_leaveå¿…é¡»æˆå¯¹ä½¿ç”¨ NSOperationï¼ˆ1ï¼‰åŸºæœ¬æ¦‚å¿µ 1201 NSOperationæ˜¯å¯¹GCDçš„åŒ…è£…02 ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µã€é˜Ÿåˆ—+æ“ä½œã€‘ ï¼ˆ2ï¼‰åŸºæœ¬ä½¿ç”¨ 12301 NSOperationæœ¬èº«æ˜¯æŠ½è±¡ç±»ï¼Œåªèƒ½ä½¿ç”¨å®ƒçš„å­ç±»02 ä¸‰ä¸ªå­ç±»åˆ†åˆ«æ˜¯ï¼šNSBlockOperationã€NSInvocationOperationä»¥åŠè‡ªå®šä¹‰ç»§æ‰¿è‡ªNSOperationçš„ç±»03 NSOperationå’ŒNSOperationQueueç»“åˆä½¿ç”¨å®ç°å¤šçº¿ç¨‹å¹¶å‘ ï¼ˆ3ï¼‰ç›¸å…³ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243// 01 NSInvocationOperation //1.å°è£…æ“ä½œ /* ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡ ç¬¬äºŒä¸ªå‚æ•°ï¼šè¯¥æ“ä½œè¦è°ƒç”¨çš„æ–¹æ³•ï¼Œæœ€å¤šæ¥å—ä¸€ä¸ªå‚æ•° ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šè°ƒç”¨æ–¹æ³•ä¼ é€’çš„å‚æ•°ï¼Œå¦‚æœæ–¹æ³•ä¸æ¥å—å‚æ•°ï¼Œé‚£ä¹ˆè¯¥å€¼ä¼ nil */ NSInvocationOperation *operation = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(run) object:nil]; //2.å¯åŠ¨æ“ä½œ [operation start];------------------------------------------------- // 02 NSBlockOperation //1.å°è£…æ“ä½œ /* NSBlockOperationæä¾›äº†ä¸€ä¸ªç±»æ–¹æ³•ï¼Œåœ¨è¯¥ç±»æ–¹æ³•ä¸­å°è£…æ“ä½œ */ NSBlockOperation *operation = [NSBlockOperation blockOperationWithBlock:^{ //åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ NSLog(@\"---download1--%@\",[NSThread currentThread]); }]; //2.è¿½åŠ æ“ä½œï¼Œè¿½åŠ çš„æ“ä½œåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œ [operation addExecutionBlock:^{ NSLog(@\"---download2--%@\",[NSThread currentThread]); }]; [operation addExecutionBlock:^{ NSLog(@\"---download3--%@\",[NSThread currentThread]); }]; //3.å¯åŠ¨æ‰§è¡Œæ“ä½œ [operation start];----------------------------------------------// 03 è‡ªå®šä¹‰NSOperation //å¦‚ä½•å°è£…æ“ä½œï¼Ÿ //è‡ªå®šä¹‰çš„NSOperation,é€šè¿‡é‡å†™å†…éƒ¨çš„mainæ–¹æ³•å®ç°å°è£…æ“ä½œ -(void)main { NSLog(@\"--main--%@\",[NSThread currentThread]); }","link":"/2016/07/08/å¤šçº¿ç¨‹åŸºç¡€/"},{"title":"å¦‚ä½•ç»§æ‰¿ç±»ç°‡ï¼ˆä¾‹å¦‚NSStringï¼‰","text":"åœ¨ä»Šå¤©ä¹‹å‰ å¦‚æœæœ‰äººé—®æˆ‘ å¦‚æœç»™NSStringæ·»åŠ ä¸€ä¸ªæ–¹æ³• ï¼Œæˆ‘æœ€å…ˆæƒ³åˆ°çš„æ–¹æ³•è‚¯å®šå°±æ˜¯ä½¿ç”¨Categoryã€‚ä¸€ç›´è§‰å¾—NSStringæ˜¯ä¸èƒ½è¢«ç»§æ‰¿çš„ï¼Œå› ä¸ºå®ƒæ˜¯ç±»ç°‡ï¼Œå…¶å®å¦‚æœçœŸçš„æƒ³ç»§æ‰¿ï¼Œä¹Ÿæ˜¯æœ‰åŠæ³•çš„ã€‚ åœ¨Cocoaæ¡†æ¶é‡Œæœ‰è®¸å¤šç±»ç°‡ï¼Œæ¯”å¦‚NSArrayï¼ŒNSStringï¼ŒNSNumberï¼ˆå…·ä½“ä»€ä¹ˆæ˜¯ç±»ç°‡å°±ä¸è§£é‡Šäº†ã€‚ç½‘ä¸Šå…³äºç±»ç°‡çš„ä»‹ç»å¾ˆå¤šï¼‰ã€‚ å…·ä½“å…³äºå¦‚ä½•ä¸ºç±»ç°‡æ·»åŠ å­ç±»ï¼Œéœ€è¦éµå®ˆå‡ æ¡è§„åˆ™ï¼š å­ç±»åº”è¯¥ç»§æ‰¿è‡ªç±»ç°‡ä¸­çš„æŠ½è±¡åŸºç±»ã€‚ å­ç±»åº”è¯¥è‡ªå®šä¹‰è‡ªå·±çš„æ•°æ®å­˜å‚¨æ–¹å¼ã€‚ï¼ˆå¼€å‘è€…ç¼–å†™NSArrayå­ç±»æ—¶ï¼Œå¿…é¡»ç”¨ä¸€ä¸ªå®ä¾‹å˜é‡æ¥å­˜æ”¾æ•°ç»„ä¸­çš„å¯¹è±¡ã€‚è¿™ä¼¼ä¹ä¸å¤§å®¶é¢„æƒ³çš„ä¸åŒï¼Œæˆ‘ä»¬ä»¥ä¸ºNSArrayè‡ªå·±è‚¯å®šä¼šä¿å­˜é‚£äº›å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨å­ç±»ä¸­å°±æ— é¡»å†ä¿å­˜ä¸€ä»½äº†ã€‚ä½†æ˜¯å¤§å®¶è¦è®°ä½ï¼ŒNSArrayæœ¬èº«åªä¸è¿‡æ˜¯åŒ…åœ¨å…¶ä»–éšè—å¯¹è±¡å¤–é¢çš„å£³ï¼Œå®ƒä»…ä»…å®šä¹‰äº†æ‰€æœ‰æ•°ç»„éƒ½éœ€å…·å¤‡çš„ä¸€äº›æ¥å£ã€‚å¯¹äºè¿™ä¸ªè‡ªå®šä¹‰çš„æ•°ç»„ç±»æ¥è¯´ï¼Œå¯ä»¥ç”¨NSArrayæ¥ä¿å­˜å…¶å®ä¾‹ï¼‰ã€‚ å­ç±»åº”å½“è¦†å†™è¶…ç±»æ–‡æ¡£ä¸­æŒ‡æ˜éœ€è¦è¦†å†™çš„æ–¹æ³•ã€‚ æ¥ä¸‹æ¥å°±åŠ¨æ‰‹å®ç°å¦‚ä½•ç»§æ‰¿NSArray å’Œ NSStringã€‚ 12345678910111213141516171819202122232425262728293031#import \"WUArray.h\"@interface WUArray(){ NSArray *_storeArray;}@end@implementation WUArray- (instancetype)initWithArray:(NSArray *)array { if (self = [super init]) { _storeArray = [NSArray arrayWithArray:array]; } return self;}#pragma mark - override- (NSUInteger)count { return _storeArray.count;}- (id)objectAtIndex:(NSUInteger)index { return [_storeArray objectAtIndex:index];}@end ######ä»¥ä¸Šä¸ºWUArray.mæ–‡ä»¶ 123456789101112131415161718192021222324252627#import \"WUString.h\"@interface WUString(){ NSString *_storeString;}@end@implementation WUString- (instancetype)initWithString:(NSString *)aString { if (self = [self init]) { _storeString = [[NSString stringWithString:aString] copy]; } return self;}- (NSUInteger)length { return [_storeString length];}- (unichar)characterAtIndex:(NSUInteger)index { return [_storeString characterAtIndex:index];}@end ######ä»¥ä¸Šä¸ºWUString.m æ–‡ä»¶ å®ç°å®Œä¹‹å æ¥éªŒè¯ä¸€ä¸‹ï¼š12345WUString *str = [[WUString alloc] initWithString:@\"123456789\"]; NSLog(@\"%@\",[str substringFromIndex:5]); //æ§åˆ¶å°æ‰“å°è¾“å‡ºä¸º 6789 WUArray *array = [[WUArray alloc] initWithArray:@[@\"h\",@\"e\",@\"l\",@\"l\",@\"0\"]]; NSLog(@\"%@\",[array componentsJoinedByString:@\".\"]); //æ§åˆ¶å°æ‰“å°è¾“å‡ºä¸º h.e.l.l.o åœ¨ç»§æ‰¿çš„æ—¶å€™ å…³äºè¦å…·ä½“è¦†å†™è¶…ç±»çš„å“ªå‡ ä¸ªæ–¹æ³•ï¼ŒNSStringçš„å¤´æ–‡ä»¶é‡Œé¢å†™çš„æœ‰ï¼š1234/* NSString primitives. A minimal subclass of NSString just needs to implement these two, along with an init method appropriate for that subclass. We also recommend overriding getCharacters:range: for performance. */@property (readonly) NSUInteger length;- (unichar)characterAtIndex:(NSUInteger)index;","link":"/2017/05/15/å¦‚ä½•ç»§æ‰¿ç±»ç°‡/"},{"title":"æ·±å…¥ç†è§£Block","text":"Blockçš„å®è´¨Blockæ˜¯â€œå¸¦æœ‰è‡ªåŠ¨å˜é‡å€¼çš„åŒ¿åå‡½æ•°â€ï¼ŒBlockå®é™…ä¸Šæ˜¯ä½œä¸ºææ™®é€šçš„Cè¯­è¨€æºä»£ç æ¥å¤„ç†çš„ã€‚é€šè¿‡æ”¯æŒBlockçš„ç¼–è¯‘å™¨ï¼Œå«æœ‰Blockè¯­æ³•çš„æºä»£ç è½¬æ¢ä¸ºä¸€èˆ¬Cè¯­è¨€ç¼–è¯‘å™¨èƒ½å¤Ÿå¤„ç†çš„æºä»£ç ï¼Œå¹¶ä½œä¸ºææ™®é€šçš„Cè¯­è¨€æºä»£ç è¢«ç¼–è¯‘ã€‚ åœ¨å®é™…ç¼–è¯‘æ—¶æ— æ³•è½¬æ¢ä¸ºæˆ‘ä»¬èƒ½å¤Ÿç†è§£çš„æºä»£ç ï¼Œä½†clang(LLVMç¼–è¯‘å™¨)å…·æœ‰è½¬æ¢ä¸ºæˆ‘ä»¬å¯è¯»æºä»£ç çš„åŠŸèƒ½ã€‚é€šè¿‡â€œ-rewrite-objcâ€é€‰é¡¹å°±èƒ½å°†å«æœ‰Blockè¯­æ³•çš„æºä»£ç è½¬æ¢ä¸ºC++æºä»£ç ã€‚è¯´æ˜¯C++ï¼Œå…¶å®ä¹Ÿä»…ä»…æ˜¯ä½¿ç”¨äº†structç»“æ„ä½“ï¼Œæœ¬è´¨æ˜¯Cè¯­è¨€æºä»£ç ã€‚ 12345678int main(int argc, const char * argv[]) { void (^blk)(void) = ^{printf(\"Block\\n\");}; blk(); return 0;} æ­¤æºä»£ç çš„Blockè¯­æ³•æœ€ä¸ºç®€å•ï¼Œå®ƒçœç•¥äº†è¿”å›å€¼ç±»å‹ä»¥åŠå‚æ•°åˆ—è¡¨ã€‚é€šè¿‡clangå¯å˜æ¢ä¸ºä¸€ä¸‹å½¢å¼ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243struct __block_impl { void *isa; int Flags; int Reserved; void *FuncPtr;//å‡½æ•°æŒ‡é’ˆ};//__main_block_impl_0ç»“æ„ä½“ç›¸å½“äºåŸºäºobjc_objectç»“æ„ä½“çš„Objective-Cå¯¹è±¡çš„ç»“æ„ä½“ã€‚struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; //ç»“æ„ä½“çš„æ„é€ å‡½æ•° __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) { //é€šè¿‡isaæŒ‡é’ˆï¼Œå¯ä»¥æƒ³åˆ°blockå®è´¨æ˜¯OCçš„å¯¹è±¡ // isaæŒ‡å‘blockçš„ç±»å¯¹è±¡objc_classç»“æ„ä½“ã€‚blockçš„ç±»å¯¹è±¡é€šè¿‡&amp;_NSConcreteStackBlockåˆå§‹åŒ–ã€‚ impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; //impl.FuncPträ¿å­˜blockæ‰§è¡Œçš„å†…å®¹ã€‚åœ¨è¿™é‡Œå°±æ˜¯__main_block_func_0è¿™ä¸ªcè¯­è¨€å‡½æ•° impl.FuncPtr = fp; Desc = desc; }};//- é€šè¿‡blockä½¿ç”¨çš„åŒ¿åå‡½æ•°å®é™…ä¸Šæ˜¯è¢«ä½œä¸ºç®€å•çš„cè¯­è¨€å‡½æ•°æ¥å¤„ç†ã€‚å¦å¤–æ ¹æ®blockè¯­æ³•æ‰€å±çš„å‡½æ•°å(æ­¤å¤„ä¸ºmain)å’Œè¯¥blockè¯­æ³•æ‰€åœ¨è¯¥å‡½æ•°å‡ºç°çš„é¡ºåºå€¼(æ­¤å¤„ä¸º0)æ¥ç»™ç»clangå˜æ¢çš„å‡½æ•°å‘½åã€‚//- è¯¥å‡½æ•°çš„å‚æ•°__cselfç›¸å½“äºc++å®ä¾‹æ–¹æ³•ä¸­æŒ‡å‘å®ä¾‹è‡ªèº«çš„å˜é‡thisï¼Œæˆ–æ˜¯OCä¸­çš„selfï¼Œå³__cselfä¸ºæŒ‡å‘Blockå€¼å¾—å˜é‡ã€‚static void __main_block_func_0(struct __main_block_impl_0 *__cself) { printf(\"Block\\n\");}static struct __main_block_desc_0 { size_t reserved; size_t Block_size;} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0)};int main(int argc, const char * argv[]) { void (*blk)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA)); ((void (*)(Â·__block_impl *))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk); return 0;} åœ¨mainæ–¹æ³•ä¸­ï¼Œåˆå§‹åŒ–äº†blockï¼Œå¹¶è°ƒç”¨äº†æ‰§è¡Œäº†blockï¼Œé€šè¿‡clangè½¬æ¢çš„æºä»£ç ç”±äºè½¬æ¢è¾ƒå¤šï¼Œçœ‹èµ·æ¥ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œä¼˜åŒ–å»æ‰è½¬æ¢éƒ¨åˆ†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š 1234567891011121314151617//è¯¥æºä»£ç å°†__main_block_impl_0ç»“æ„ä½“ç±»å‹çš„è‡ªåŠ¨å˜é‡ï¼Œå³æ ˆä¸Šç”Ÿæˆçš„__main_block_impl_0ç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆï¼Œèµ‹å€¼ç»™__main_block_impl_0ç»“æ„ä½“æŒ‡é’ˆç±»å‹çš„å˜é‡ã€‚//ä¸‹é¢ä¸¤è¡Œå¯¹åº”çš„ä»£ç æ˜¯ï¼švoid (^blk)(void) = ^{printf(\"Block\\n\");};//__main_block_impl_0çš„æ„é€ å‡½æ•°éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸Šé¢æºä»£ç ä¸­æ„é€ å‡½æ•°å‚æ•°æœ‰3ä¸ªï¼Œæœ€åä¸€ä¸ªæœ‰é»˜è®¤å€¼ï¼Œå¯ä»¥ä¸ä¼ ï¼Œæ‰€ä»¥è¿™é‡Œä¼ çš„æ˜¯ä¸¤ä¸ªå‚æ•°ï¼š//- ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯blockä¸­æ‰€æ‰§è¡Œçš„å…·ä½“å†…å®¹ï¼Œç”±blockè¯­æ³•è½¬æ¢çš„Cè¯­è¨€å‡½æ•°ã€‚//- ç¬¬äºŒä¸ªå‚æ•°æ˜¯é™æ€å…¨å±€å˜é‡åˆå§‹åŒ–çš„__main_block_desc_0ç»“æ„ä½“å®ä¾‹æŒ‡é’ˆã€‚// å¯¹åº”è¿™ä¸€éƒ¨åˆ†æºä»£ç ï¼š// static struct __main_block_desc_0 {// size_t reserved;// size_t Block_size;// } __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0)};// ç”±æ­¤å¯çŸ¥ï¼Œè¯¥æºä»£ç ä½¿ç”¨blockï¼Œå³__main_block_impl_0ç»“æ„ä½“å®ä¾‹çš„å¤§å°è¿›è¡Œåˆå§‹åŒ–ã€‚struct __main_block_impl_0 tmp = __main_block_impl_0(__main_block_func_0,&amp;__main_block_desc_0_DATA);//è¿™é‡Œè°ƒç”¨çš„æ˜¯__main_block_impl_0çš„æ„é€ å‡½æ•°struct __main_block_impl_0 *blk = &amp;tmp;//è¿™å°±æ˜¯ç®€å•åœ°ä½¿ç”¨å‡½æ•°æŒ‡é’ˆè°ƒç”¨å‡½æ•°ï¼Œé€šè¿‡clangç¼–è¯‘åçš„æºä»£ç å¯çŸ¥ï¼Œä¼ å…¥çš„å‚æ•°__cself,è¿™é‡Œä¸ºblkï¼Œæ‰€ä»¥ä¹Ÿè¯æ˜äº†__cselfæŒ‡å‘blockè‡ªèº«ã€‚ (*blk-&gt;impl.FuncPtr)(blk); æˆªè·è‡ªåŠ¨å˜é‡å€¼123456789101112int main() { int dmy = 256; int val = 10; const char *fmt = \"val = %d\\n\"; void (^blk)(void) = ^{printf(fmt,val);}; blk(); return 0; } å°†ä¸Šé¢æˆªè·è‡ªåŠ¨å˜é‡å€¼å¾—æºä»£ç é€šè¿‡clangè¿›è¡Œè½¬æ¢ï¼š 123456789101112131415161718192021222324252627282930313233343536373839struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; /*blockè¯­æ³•è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„è‡ªåŠ¨å˜é‡è¢«ä½œä¸ºæˆå‘˜å˜é‡è¿½åŠ åˆ°äº†__main_block_impl_0ç»“æ„ä½“ä¸­ï¼šfmtã€valæ²¡æœ‰ä½¿ç”¨çš„å±€éƒ¨å˜é‡ä¸ä¼šè¢«è¿½åŠ */ const char *fmt; int val; /*åœ¨åˆå§‹åŒ–ç»“æ„ä½“å®ä¾‹æ—¶ï¼Œæ ¹æ®ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‚æ•°å¯¹ç”±è‡ªåŠ¨å˜é‡è¿½åŠ çš„æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚ç”±æ­¤å¯çŸ¥ï¼Œåœ¨__main_block_impl_0ç»“æ„ä½“å®ä¾‹ä¸­ï¼Œè‡ªåŠ¨å˜é‡å€¼è¢«æˆªè·*/ __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, const char *_fmt, int _val, int flags=0) : fmt(_fmt), val(_val) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself) { //bound by copyè¿™é‡Œçš„æ³¨é‡Šè¡¨ç¤ºï¼Œblockå¯¹å®ƒå¼•ç”¨çš„å±€éƒ¨å˜é‡åšäº†åªè¯»æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´blockå¼•ç”¨çš„æ˜¯å±€éƒ¨å˜é‡çš„å‰¯æœ¬ã€‚æ‰€ä»¥åœ¨æ‰§è¡Œblockè¯­æ³•åï¼Œå³ä½¿æ”¹å†™blockä¸­ä½¿ç”¨çš„å±€éƒ¨å˜é‡çš„å€¼ä¹Ÿä¸ä¼šå½±å“blockæ‰§è¡Œæ—¶å±€éƒ¨å˜é‡çš„å€¼ã€‚ const char *fmt = __cself-&gt;fmt; // bound by copy int val = __cself-&gt;val; // bound by copy printf(fmt,val);}static struct __main_block_desc_0 { size_t reserved; size_t Block_size;} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0)};int main() { int dmy = 256; int val = 10; const char *fmt = \"val = %d\\n\"; void (*blk)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, fmt, val)); ((void (*)(__block_impl *))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk); return 0;} æ€»çš„æ¥è¯´ï¼Œæ‰€è°“â€œæˆªè·è‡ªåŠ¨å˜é‡å€¼â€æ„å‘³ç€åœ¨æ‰§è¡Œblockè¯­æ³•æ—¶ï¼Œblockè¯­æ³•è¡¨è¾¾å¼æ‰€ä½¿ç”¨çš„è‡ªåŠ¨å˜é‡å€¼æ¥ä¿å­˜åˆ°blockçš„ç»“æ„ä½“å®ä¾‹ä¸­ã€‚ å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œblockä¸èƒ½ç›´æ¥ä½¿ç”¨Cè¯­è¨€æ•°ç»„ç±»å‹çš„è‡ªåŠ¨å˜é‡ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºblockæˆªè·è‡ªåŠ¨å˜é‡æ—¶ï¼Œæ˜¯é€šè¿‡å°†å€¼ä¼ é€’ç»™ç»“æ„ä½“çš„æ„é€ å‡½æ•°è¿›è¡Œä¿å­˜ã€‚å› ä¸ºcè¯­è¨€ä¸å…è®¸è¿™ç§èµ‹å€¼ 1234void func(char a[10]) { char b[10] = a;//æ­¤å¤„æŠ¥é”™ï¼šArray initializer must be an initializer or string literal printf(\"%d\\n\",b[0]);} __blockè¯´æ˜ç¬¦å†æ¥å›é¡¾å‰é¢æˆªè·è‡ªåŠ¨å˜é‡å€¼å¾—ä¾‹å­ 1^{printf(fmt,val);} è¯¥æºä»£ç è½¬æ¢å¦‚ä¸‹ 12345static void __main_block_func_0(struct __main_block_impl_0 *__cself) { const char *fmt = __cself-&gt;fmt; // bound by copy int val = __cself-&gt;val; // bound by copy printf(fmt,val);} blockä¸­æ‰€ä½¿ç”¨çš„è¢«æˆªè·è‡ªåŠ¨å˜é‡å°±å¦‚â€œå¸¦æœ‰è‡ªåŠ¨å˜é‡å€¼çš„åŒ¿åå‡½æ•°â€æ‰€è¯´ï¼Œä»…æˆªè·è‡ªåŠ¨å˜é‡ã€‚blockä¸­ä½¿ç”¨è‡ªåŠ¨å˜é‡åï¼Œåœ¨blockçš„ç»“æ„ä½“å®ä¾‹ä¸­é‡å†™è¯¥è‡ªåŠ¨å˜é‡ä¹Ÿä¸ä¼šæ”¹å˜åŸå…ˆæˆªè·çš„è‡ªåŠ¨å˜é‡ã€‚ å¦‚æœåœ¨blockä¸­ä¿®æ”¹æˆªè·è‡ªåŠ¨å˜é‡çš„å€¼ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºåœ¨å®ç°ä¸Šä¸èƒ½æ”¹å†™æˆªè·è‡ªåŠ¨å˜é‡çš„å€¼ã€‚ è§£å†³è¿™ç§é—®é¢˜æœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚ ç¬¬ä¸€ç§ï¼šCè¯­è¨€ä¸­æœ‰å‡ ç§å˜é‡å…è®¸blockæ”¹å†™å€¼ï¼š é™æ€å±€éƒ¨å˜é‡ é™æ€å…¨å±€å˜é‡ å…¨å±€å˜é‡ è™½ç„¶blockè¯­æ³•çš„åŒ¿åå‡½æ•°éƒ¨åˆ†ç®€å•åœ°å˜æ¢ä¸ºäº†cè¯­è¨€å‡½æ•°ï¼Œä½†ä»è¿™ä¸ªå˜æ¢çš„å‡½æ•°ä¸­è®¿é—®é™æ€å…¨å±€å˜é‡/å…¨å±€å˜é‡å¹¶æ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚ä½†æ˜¯é™æ€å±€éƒ¨å˜é‡çš„æƒ…å†µä¸‹ï¼Œè½¬æ¢åçš„å‡½æ•°åŸæœ¬å°±è®¾ç½®åœ¨å«æœ‰blockè¯­æ³•çš„å‡½æ•°å¤–é¢ï¼Œæ‰€ä»¥æ— æ³•åœ¨å˜é‡ä½œç”¨åŸŸè®¿é—®ã€‚ çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š 1234567891011121314151617int global_val = 1;static int static_global_val = 2;int main() { static int static_val = 3; void (^blk)(void) = ^{ global_val *= 1; static_global_val *= 2; static_val *= 3; }; blk(); return 0; } æºä»£ç è½¬æ¢åå¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637int global_val = 1;static int static_global_val = 2;struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; //å°†é™æ€å±€éƒ¨å˜é‡çš„åœ°å€ä½œä¸ºæˆå‘˜å˜é‡ä¿å­˜ int *static_val; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int *_static_val, int flags=0) : static_val(_static_val) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself) { int *static_val = __cself-&gt;static_val; // bound by copy global_val *= 1; static_global_val *= 2; (*static_val) *= 3;}static struct __main_block_desc_0 { size_t reserved; size_t Block_size;} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0)};int main() { static int static_val = 3; void (*blk)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, &amp;static_val)); ((void (*)(__block_impl *))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk); return 0;} é€šè¿‡è½¬æ¢åçš„ä»£ç å¯ä»¥å¾—çŸ¥ï¼Œå¯¹é™æ€å…¨å±€å˜é‡å’Œå…¨å±€å˜é‡çš„è®¿é—®ä¸è½¬æ¢å‰å®Œå…¨ç›¸åŒï¼Œå› ä¸ºä»–ä»¬æ˜¯å…¨å±€å˜é‡ï¼Œä¸ç®¡åœ¨å“ªé‡Œéƒ½å¯ä»¥è®¿é—®åˆ°ï¼Œæ²¡æœ‰ä½œç”¨åŸŸçš„é™åˆ¶ã€‚ä½†æ˜¯å¯¹äºé™æ€å±€éƒ¨å˜é‡ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨æŒ‡é’ˆæ¥è®¿é—®å‘¢ï¼Ÿ å› ä¸ºé™æ€å±€éƒ¨å˜é‡åœ¨å…¶æ‰€åœ¨å‡½æ•°ç»“æŸåï¼Œæ˜¯ä»ç„¶å­˜åœ¨çš„ï¼ˆè‡ªåŠ¨å˜é‡åœ¨å‡½æ•°ç»“æŸåå°±ä¸å­˜åœ¨ï¼‰ï¼Œä½†åˆå› ä¸ºåœ¨å…¶ä»–å‡½æ•°ä¸­æ— æ³•å¼•ç”¨åˆ°è¯¥é™æ€å±€éƒ¨å˜é‡ï¼Œæ‰€ä»¥é€šè¿‡å°†é™æ€å±€éƒ¨å˜é‡çš„æŒ‡é’ˆä¼ é€’ç»™blockç»“æ„ä½“çš„æ„é€ å‡½æ•°å¹¶ä½œä¸ºæˆå‘˜å˜é‡ä¿å­˜ï¼Œæ˜¯è¶…å‡ºä½œç”¨åŸŸä½¿ç”¨é™æ€å±€éƒ¨å˜é‡çš„æœ€ç®€å•æ–¹æ³•ã€‚ é™æ€å±€éƒ¨å˜é‡çš„è¿™ç§æ–¹æ³•ä¹Ÿé€‚ç”¨äºè‡ªåŠ¨å˜é‡çš„è®¿é—®ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆæ²¡æœ‰è¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºå‰é¢å·²ç»æåˆ°äº†ï¼Œåœ¨å˜é‡ä½œç”¨åŸŸç»“æŸçš„åŒæ—¶ï¼Œé™æ€å±€éƒ¨å˜é‡æ²¡æœ‰è¢«åºŸå¼ƒï¼Œè€Œè‡ªåŠ¨å˜é‡è¢«åºŸå¼ƒæ‰äº†ï¼Œæ‰€ä»¥å°†ä¸èƒ½é€šè¿‡æŒ‡é’ˆè®¿é—®åŸæ¥çš„è‡ªåŠ¨å˜é‡ã€‚ ç¬¬äºŒç§æ–¹æ³•æ˜¯ä½¿ç”¨â€__blockè¯´æ˜ç¬¦â€â€__blockè¯´æ˜ç¬¦â€œ,æ›´å‡†ç¡®çš„è¡¨è¿°æ–¹å¼ä¸ºâ€__blockå­˜å‚¨åŸŸç±»è¯´æ˜ç¬¦â€ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨__blockä¿®é¥°è‡ªåŠ¨å˜é‡çš„ä»£ç ï¼š 1234567891011int main() { __block int val = 10; void (^blk)(void) = ^ { val = 1; }; blk(); return 0;} ä¸Šè¿°ä»£ç å˜æ¢åå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647struct __Block_byref_val_0 { void *__isa; __Block_byref_val_0 *__forwarding; int __flags; int __size; int val;};struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; __Block_byref_val_0 *val; // by ref __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_val_0 *_val, int flags=0) : val(_val-&gt;__forwarding) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself) { __Block_byref_val_0 *val = __cself-&gt;val; // bound by ref (val-&gt;__forwarding-&gt;val) = 1; }static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) { _Block_object_assign((void*)&amp;dst-&gt;val, (void*)src-&gt;val, 8/*BLOCK_FIELD_IS_BYREF*/);}static void __main_block_dispose_0(struct __main_block_impl_0*src) {_Block_object_dispose((void*)src-&gt;val, 8/*BLOCK_FIELD_IS_BYREF*/);}static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*);} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0};int main() { __attribute__((__blocks__(byref))) __Block_byref_val_0 val = {(void*)0,(__Block_byref_val_0 *)&amp;val, 0, sizeof(__Block_byref_val_0), 10}; void (*blk)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_val_0 *)&amp;val, 570425344)); ((void (*)(__block_impl *))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk); return 0;} åªæ˜¯åœ¨è‡ªåŠ¨å˜é‡ä¸Šé™„åŠ äº†__blockè¯´æ˜ç¬¦ï¼Œæºä»£ç é‡å°±æ€¥å‰§å¢åŠ ã€‚ __blockä¿®é¥°çš„valå˜é‡ 1__block int val = 10; ï¼Œè½¬æ¢æˆäº†ï¼š 1234567struct __Block_byref_val_0 { void *__isa; __Block_byref_val_0 *__forwarding; int __flags; int __size; int val;}; è¿™é‡Œèƒ½å¤Ÿå‘ç°ï¼Œ__blockä¿®é¥°çš„è‡ªåŠ¨å˜é‡ä¹ŸåŒblockä¸€æ ·å˜æˆäº†__Block_byref_val0ç»“æ„ä½“ç±»å‹çš„è‡ªåŠ¨å˜é‡ï¼Œå³æ ˆä¸Šç”Ÿæˆçš„\\_Block_byref_val_0ç»“æ„ä½“å®ä¾‹ã€‚ å†æ¥çœ‹ä¸€ä¸‹__blockå˜é‡èµ‹å€¼çš„ä»£ç ï¼š 123^ { val = 1; }; è¯¥æºä»£ç è½¬æ¢å¦‚ä¸‹ï¼š 123456static void __main_block_func_0(struct __main_block_impl_0 *__cself) { __Block_byref_val_0 *val = __cself-&gt;val; // bound by ref (val-&gt;__forwarding-&gt;val) = 1; } blockçš„__main_block_impl0ç»“æ„ä½“å®ä¾‹æŒæœ‰æŒ‡å‘å˜é‡çš„\\_Block_byref_bal_0ç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆã€‚__Block_byref_bal_0ç»“æ„ä½“å®ä¾‹çš„æˆå‘˜å˜é‡__forwardingæŒæœ‰æŒ‡å‘è¯¥å®ä¾‹è‡ªèº«çš„æŒ‡é’ˆã€‚é€šè¿‡æˆå‘˜å˜é‡__forwardingè®¿é—®æˆå‘˜å˜é‡valã€‚ è¿™é‡Œä¼šé‡åˆ°3ä¸ªé—®é¢˜ 1.ä¸ºä»€ä¹ˆ_blockå˜é‡çš„\\_Block_byref_val_0ç»“æ„ä½“ä¸æ”¾åœ¨__main_block_impl_0ç»“æ„ä½“ä¸­ï¼Ÿ è¿™æ ·åšæ˜¯ä¸ºäº†åœ¨å¤šä¸ªBlockä¸­ä½¿ç”¨__blockå˜é‡ã€‚è¾¾åˆ°å¤ç”¨æ•ˆæœï¼Œä»è€ŒèŠ‚çœä¸å¿…è¦çš„ç©ºé—´å¼€é”€ã€‚ 2.blockè¶…å‡ºå˜é‡ä½œç”¨åŸŸå¯å­˜åœ¨çš„ç†ç”± 3.__blockå˜é‡çš„ç»“æ„ä½“æˆå‘˜å˜é‡__forwardingå­˜åœ¨çš„ç†ç”±ã€‚ é—®é¢˜2å’Œ3ï¼Œç•™åˆ°ä¸‹é¢è®²è§£ Blockå­˜å‚¨åŸŸé€šè¿‡å‰é¢çš„è¯´æ˜å¯çŸ¥ï¼Œblockè½¬æ¢ä¸ºblockçš„ç»“æ„ä½“ç±»å‹çš„è‡ªåŠ¨å˜é‡ï¼Œ_blockå˜é‡è½¬æ¢ä¸º\\_blockå˜é‡çš„ç»“æ„ä½“ç±»å‹çš„è‡ªåŠ¨å˜é‡ã€‚ blockä¹Ÿæ˜¯Objective-Cå¯¹è±¡ï¼Œblockçš„ç±»æœ‰ï¼š _NSConcreteStackBlock _NSConcreteGlobalBlock _NSConcreteMallocBlock å…¨å±€blockç‰¹ç‚¹ï¼šåº”ç”¨ç¨‹åºåœ¨å®ƒå°±åœ¨ã€‚ åœ¨è®°å½•å…¨å±€å˜é‡çš„åœ°æ–¹å†™blockçš„æ—¶å€™ï¼Œblockä¸ºå…¨å±€block ä¸åœ¨ä¹¦å†™å…¨å±€å˜é‡çš„åœ°æ–¹ï¼Œåªè¦ä¸æˆªè·è‡ªåŠ¨å˜é‡ï¼Œä¸ç®¡ç”¨ä»€ä¹ˆä¿®é¥°ç¬¦ä¿®é¥°ï¼Œéƒ½æ˜¯å…¨å±€blockã€‚ å…¨å±€å˜é‡å…¨éƒ¨ç²—æ”¾åœ¨é™æ€å­˜å‚¨åŒºï¼Œåœ¨ç¨‹åºå¼€å§‹æ‰§è¡Œæ—¶ç»™å…¨å±€å˜é‡åˆ†é…å­˜å‚¨åŒºï¼Œç¨‹åºæ‰§è¡Œå®Œæ¯•å°±é‡Šæ”¾ã€‚å®ƒä»¬å æ®å›ºå®šçš„å­˜å‚¨å•å…ƒã€‚ æ ˆblockç‰¹ç‚¹ï¼šå£°æ˜å‘¨æœŸç”±ç³»ç»Ÿæ§åˆ¶ï¼Œè¶…å‡ºå…¶æ‰€åœ¨ä½œç”¨åŸŸå³é”€æ¯ã€‚ æˆªè·è‡ªåŠ¨å˜é‡ä¸”æ²¡æœ‰å¼ºæŒ‡é’ˆå¼•ç”¨çš„æ—¶å€™ï¼Œä¸ºæ ˆblockã€‚æ ˆblockå› ä¸ºå­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥åœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶è¢«é”€æ¯ï¼Œä¸ä¼šå­˜åœ¨äº†ã€‚ åœ¨ARCä¸‹ã€‚ä¼šé»˜è®¤æ·»åŠ __strongä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥å¾ˆå°‘ä¼šå‡ºç°æ ˆblockã€‚ å¤§å¤šæ•°æƒ…å†µç¼–è¯‘å™¨ä¼šä¼šåœ¨é€‚å½“çš„åœ°æ–¹æ·»åŠ ä¿®é¥°ï¼ŒæŠŠblockä»æ ˆå¤åˆ¶åˆ°å †ï¼Œæ¯”å¦‚å°†blockä½œä¸ºå‡½æ•°è¿”å›å€¼æ—¶ã€‚ä¸è¿‡åœ¨æ­¤ä¹‹å¤–çš„æƒ…å†µä¸‹éœ€è¦æ‰‹åŠ¨ç”Ÿæˆä»£ç ï¼Œå°†blockä»æ ˆå¤åˆ¶åˆ°å †ä¸Šã€‚ ç¼–è¯‘å™¨ä¸èƒ½è¿›è¡Œåˆ¤æ–­æ˜¯ä»€ä¹ˆæ ·çš„çŠ¶å†µå‘¢ï¼Ÿå¦‚ä¸‹æ‰€ç¤ºï¼š å‘æ–¹æ³•æˆ–å‡½æ•°çš„å‚æ•°ä¸­ä¼ é€’blockæ—¶ ä½†æ˜¯å¦‚æœåœ¨æ–¹æ³•æˆ–å‡½æ•°å†…éƒ¨é€‚å½“åœ°å¤åˆ¶äº†ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼Œé‚£ä¹ˆå°±ä¸å¿…åœ¨è°ƒç”¨è¯¥æ–¹æ³•æˆ–å‡½æ•°å‰æ‰‹åŠ¨å¤åˆ¶äº†ã€‚ä»¥ä¸‹æ–¹æ³•æˆ–å‡½æ•°ä¸ç”¨æ‰‹åŠ¨å¤åˆ¶ï¼š Cocoaæ¡†æ¶çš„æ–¹æ³•ä¸”æ–¹æ³•åä¸­å«æœ‰usingBlockç­‰æ—¶ GCDçš„api ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­åœ¨ARCä¸‹éƒ½ä¸ºæ ˆblockï¼š 12345678- (id)getBlockArray { int val = 10; return [[NSArrary alloc] initWithObjects: ^{NSLog(@&quot;blk0:%d&quot;,val);}, ^{NSLog(@&quot;blk0:%d&quot;,val);}, nil ];} 123//æ ˆblockint i = 0;NSLog(@&quot;%@&quot;,^{NSLog(@&quot;%d&quot;,i);});//è¾“å‡ºç»“æœ __NSStackBlock__: 0x7fff57aada78&gt; å †blockç‰¹ç‚¹ï¼šæ²¡æœ‰å¼ºæŒ‡é’ˆå¼•ç”¨å³é”€æ¯ï¼Œç”Ÿå‘½å‘¨æœŸç”±ç¨‹åºå‘˜æ‰‹åŠ¨ç®¡ç† æ ˆblockæœ‰å¼ºæŒ‡é’ˆstrong/copyå¼•ç”¨å°±ä¼šè¢«copyåˆ°å †ä¸­ï¼Œå˜æˆå †block é€šè¿‡å¯¹ç€3ç±»blockçš„è§£é‡Šï¼Œä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆblockåœ¨è¶…å‡ºå…¶ä½œç”¨åŸŸä»ç„¶å¯ä»¥å­˜åœ¨ã€‚ __blockå˜é‡å­˜å‚¨åŸŸblockä»æ ˆå¤åˆ¶åˆ°å †æ—¶å¯¹__blockå˜é‡äº§ç”Ÿçš„å½±å“ï¼š __blockå˜é‡çš„é…ç½®å­˜å‚¨åŸŸ blockä»æ ˆå¤åˆ¶åˆ°å †æ—¶çš„å½±å“ æ ˆ ä»æ ˆå¤åˆ¶åˆ°å †å¹¶è¢«blockæŒæœ‰ å † è¢«blockæŒæœ‰ åœ¨ä¸€ä¸ªblockä¸­ä½¿ç”¨_blockå˜é‡ï¼Œåˆ™å½“è¯¥blockä»æ ˆå¤åˆ¶åˆ°å †æ—¶ï¼Œä½¿ç”¨çš„æ‰€æœ‰\\_blockå˜é‡ä¹Ÿå¿…å®šé…ç½®åœ¨æ ˆä¸Šã€‚è¿™äº›__blockå˜é‡ä¹Ÿå…¨éƒ¨ä»æ ˆå¤åˆ¶åˆ°å¯¹ä¸Šã€‚æ­¤æ—¶blockæŒæœ‰__blockå˜é‡ã€‚å³ä½¿åœ¨è¯¥blockå·²å¤åˆ¶åˆ°å †çš„æƒ…å†µä¸‹ï¼Œå¤åˆ¶Blockä¹Ÿå¯¹æ‰€ä½¿ç”¨çš„__blockå˜é‡æ²¡æœ‰ä»»ä½•å½±å“ã€‚ åœ¨å¤šä¸ªblockä¸­ä½¿ç”¨__blockå˜é‡ï¼Œå› ä¸ºæœ€å…ˆä¼šå°†æ‰€æœ‰çš„blocké…ç½®åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥__blockå˜é‡ä¹Ÿä¼šé…ç½®åœ¨æ ˆä¸Šã€‚åœ¨ä»»ä½•ä¸€ä¸ªblockä»æ ˆå¤åˆ¶åˆ°å †æ—¶ï¼Œ__blockå˜é‡ä¹Ÿä¼šä¸€å¹¶ä»æ ˆå¤åˆ¶åˆ°å †å¹¶è¢«è¯¥blockæ‰€æŒæœ‰ã€‚å½“å‰©ä¸‹çš„blockä»æ ˆå¤åˆ¶åˆ°å †æ—¶ï¼Œè¢«å¤åˆ¶çš„blockæŒæœ‰__blockå˜é‡ï¼Œå¹¶å¢åŠ __blockå˜é‡çš„å¼•ç”¨è®¡æ•°ã€‚ å¦‚æœé…ç½®åœ¨å †ä¸Šçš„blockè¢«åºŸå¼ƒï¼Œé‚£ä¹ˆå®ƒä¼šé‡Šæ”¾æ‰€æŒæœ‰çš„_blockå˜é‡ï¼Œå½“è¯¥\\_blockå˜é‡æ²¡æœ‰æŒæœ‰è€…æ—¶ï¼Œå°±ä¼šé‡Šæ”¾ã€‚ åˆ°è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ­¤æ€è€ƒæ–¹å¼ä¸OCçš„å¼•ç”¨è®¡æ•°å†…å­˜ç®¡ç†å®Œå…¨ç›¸åŒã€‚ çœ‹å¦‚ä¸‹æºä»£ç ï¼š 12345678910111213int main() { __block int val = 0; //åœ¨arcä¸‹ï¼Œä¸ç”¨copyå°±å¯ä»¥äº†ã€‚å› ä¸ºé»˜è®¤ä¼šæœ‰__strongä¿®é¥°ç¬¦ void (^blk)(void) = [^{++val;} copy]; ++val; blk(); //æ‰“å°ç»“æœä¸º2ã€‚è¯´æ˜æ ˆä¸Šçš„valç»“æ„ä½“ï¼Œå’Œå †ä¸Šçš„valç»“æ„ä½“ï¼ŒæŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸‹é¢ä¼šç»™å‡ºç­”æ¡ˆã€‚ printf(\"%d\",val);} è½¬æ¢åå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; __Block_byref_val_0 *val; // by ref __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_val_0 *_val, int flags=0) : val(_val-&gt;__forwarding) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself) { __Block_byref_val_0 *val = __cself-&gt;val; // bound by ref ++(val-&gt;__forwarding-&gt;val);}static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) {_Block_object_assign((void*)&amp;dst-&gt;val, (void*)src-&gt;val, 8/*BLOCK_FIELD_IS_BYREF*/);}static void __main_block_dispose_0(struct __main_block_impl_0*src) {_Block_object_dispose((void*)src-&gt;val, 8/*BLOCK_FIELD_IS_BYREF*/);}static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*);} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0};//åªç•™ä¸‹mainå‡½æ•°ï¼Œå…¶ä»–éƒ¨åˆ†è¿™é‡Œçœç•¥int main() { __attribute__((__blocks__(byref))) __Block_byref_val_0 val = {(void*)0,(__Block_byref_val_0 *)&amp;val, 0, sizeof(__Block_byref_val_0), 0}; void (*blk)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_val_0 *)&amp;val, 570425344)); //æ³¨æ„è¿™é‡Œï¼ ++(val.__forwarding-&gt;val); ((void (*)(__block_impl *))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk); printf(\"%d\",(val.__forwarding-&gt;val));} åœ¨ä¸Šè¿°æºä»£ç ä¸­ï¼Œåˆ©ç”¨copyæ–¹æ³•å¤åˆ¶ä½¿ç”¨äº†_blockå˜é‡çš„blockï¼Œblockå’Œ\\_blockå˜é‡ä¸¤è€…å‡ä»æ ˆå¤åˆ¶åˆ°äº†å †ä¸Šã€‚ä»£ç ä¸­æœ‰ä¸¤å¤„ä½¿ç”¨åˆ°äº†valï¼Œä¸€å¤„æ˜¯åœ¨blockçš„åŒ¿åå‡½æ•°é‡Œï¼Œä½¿ç”¨çš„æ˜¯å †ä¸Šçš„valï¼Œå¦ä¸€å¤„æ˜¯å¤åˆ¶å‰æ ˆä¸Šçš„__blockå˜é‡çš„ç»“æ„ä½“å®ä¾‹çš„åœ°å€ã€‚ é‚£æ˜¯å¦‚ä½•ä¿è¯ï¼Œä¸ç®¡__blockå˜é‡æ˜¯é…ç½®åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Šï¼Œéƒ½èƒ½å¤Ÿæ­£ç¡®çš„è®¿é—®è¯¥å˜é‡å‘¢ï¼Ÿ å› ä¸ºæ ˆä¸Šçš„_blockå˜é‡ç”¨ç»“æ„ä½“å®ä¾‹åœ¨\\_blockå˜é‡ä»æ ˆå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œä¼šå°†æˆå‘˜å˜é‡__forwardingçš„å€¼æ›¿æ¢ä¸ºå¤åˆ¶ç›®æ ‡ä¸Šçš„__blockå˜é‡ç»“æ„ä½“å®ä¾‹çš„åœ°å€ã€‚æ‰€ä»¥å°±ç®—ä½¿ç”¨æ ˆä¸Šçš„__blockå˜é‡ã€‚è®¿é—®çš„å…¶å®è¿˜æ˜¯å †ä¸Šçš„é‚£ä¸ªã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š é€šè¿‡è¯¥åŠŸèƒ½ï¼Œæ— è®ºæ˜¯åœ¨blockè¯­æ³•ä¸­ã€blockè¯­æ³•å¤–ä½¿ç”¨_blockå˜é‡ï¼Œè¿˜æ˜¯\\_blockå˜é‡é…ç½®åœ¨æ ˆä¸Šæˆ–å †ä¸Šï¼Œéƒ½å¯ä»¥é¡ºåˆ©åœ°è®¿é—®åŒä¸€ä¸ª__blockå˜é‡ã€‚ æˆªè·å¯¹è±¡æ¥çœ‹ä¸€ä¸‹åœ¨blockè¯­æ³•ä¸­ä½¿ç”¨å¯¹è±¡çš„è¯­æ³•ï¼š 12345678910blk_t blk;{ NSMutableArray *array = [[NSMutableArray alloc] init]; blk = ^(id obj) { [array addObject:obj]; };}blk([NSObject new]);blk([NSObject new]);blk([NSObject new]); å˜é‡ä½œç”¨åŸŸç»“æŸçš„åŒæ—¶ï¼Œå˜é‡arrayè¢«åºŸå¼ƒï¼Œå…¶å¼ºå¼•ç”¨å¤±æ•ˆï¼Œå› æ­¤èµ‹å€¼ç»™å˜é‡çš„arrayçš„NSMutableArrayç±»çš„å¯¹è±¡å¿…å®šè¢«é‡Šæ”¾å¹¶åºŸå¼ƒã€‚ä½†æ˜¯ä¸Šè¿°ä»£ç èƒ½å¤Ÿè¿è¡Œæ­£å¸¸ã€‚è¿™ä¸€ç»“æœæ„å‘³ç€èµ‹å€¼ç»™å˜é‡arrayçš„NSMutableArrayç±»çš„å¯¹è±¡åœ¨è¯¥æºä»£ç æœ€åblockçš„æ‰§è¡Œéƒ¨åˆ†è¶…å‡ºå…¶ä½œç”¨åŸŸè€Œå­˜åœ¨ã€‚é€šè¿‡ç¼–è¯‘è½¬æ¢åçš„ä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849typedef void (*blk_t)(id);struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; id array;//è¿™é‡Œæ˜¯åœ¨arcç¯å¢ƒä¸‹ï¼Œé»˜è®¤æœ‰__strongä¿®é¥°ç¬¦ã€‚å¼ºå¼•ç”¨ __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, id _array, int flags=0) : array(_array) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }};static void __main_block_func_0(struct __main_block_impl_0 *__cself, id obj) { id array = __cself-&gt;array; // bound by copy ((void (*)(id, SEL, ObjectType))(void *)objc_msgSend)((id)array, sel_registerName(\"addObject:\"), (id)obj);}static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) {_Block_object_assign((void*)&amp;dst-&gt;array, (void*)src-&gt;array, 3/*BLOCK_FIELD_IS_OBJECT*/);}static void __main_block_dispose_0(struct __main_block_impl_0*src) {_Block_object_dispose((void*)src-&gt;array, 3/*BLOCK_FIELD_IS_OBJECT*/);}static struct __main_block_desc_0 { size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*);} __main_block_desc_0_DATA = { 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0};int main(int argc, const char * argv[]) { /* @autoreleasepool */ { __AtAutoreleasePool __autoreleasepool; blk_t blk; { id array = ((NSMutableArray *(*)(id, SEL))(void *)objc_msgSend)((id)((NSMutableArray *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(\"NSMutableArray\"), sel_registerName(\"alloc\")), sel_registerName(\"init\")); blk = ((void (*)(id))&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, array, 570425344)); } //(*blk-&gt;impl.FuncPtr)(blk, [NSObject new]); ((void (*)(__block_impl *, id))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk, ((NSObject *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(\"NSObject\"), sel_registerName(\"new\"))); ((void (*)(__block_impl *, id))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk, ((NSObject *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(\"NSObject\"), sel_registerName(\"new\"))); ((void (*)(__block_impl *, id))((__block_impl *)blk)-&gt;FuncPtr)((__block_impl *)blk, ((NSObject *(*)(id, SEL))(void *)objc_msgSend)((id)objc_getClass(\"NSObject\"), sel_registerName(\"new\"))); } return 0;} è¯·æ³¨æ„è¢«èµ‹å€¼NSMutableArrayå¯¹è±¡å¹¶è¢«æˆªè·çš„è‡ªåŠ¨å˜é‡arrayã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå®ƒæ˜¯blockç»“æ„ä½“ä¸­çš„æˆå‘˜å˜é‡ï¼š 12345678910111213struct __main_block_impl_0 { struct __block_impl impl; struct __main_block_desc_0* Desc; //æ³¨æ„è¿™é‡Œ id __strong array; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, id _array, int flags=0) : array(_array) { impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; }}; åœ¨Objective-Cä¸­ï¼ŒCè¯­è¨€ç»“æ„ä½“ä¸èƒ½å«æœ‰é™„æœ‰_strongä¿®é¥°ç¬¦çš„å˜é‡ï¼ˆæ¢å¥è¯è¯´ï¼šå¯¹è±¡å‹å˜é‡ä¸èƒ½ä½œä¸ºCè¯­è¨€ç»“æ„ä½“çš„æˆå‘˜ï¼‰ã€‚å› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“ä½•æ—¶è¿›è¡ŒCè¯­è¨€ç»“æ„ä½“çš„åˆå§‹åŒ–å’ŒåºŸå¼ƒæ“ä½œï¼Œä¸èƒ½å¾ˆå¥½åœ°ç®¡ç†å†…å­˜ã€‚ä½†æ˜¯Objective-Cè¿è¡Œæ—¶åº“èƒ½å¤Ÿå‡†ç¡®æŠŠæ¡blockä»æ ˆå¤åˆ¶åˆ°å †ä»¥åŠå †ä¸Šçš„blockè¢«åºŸå¼ƒçš„æ—¶æœºï¼Œå› æ­¤blockç»“æ„ä½“ä¸­å³ä½¿å«æœ‰å¯¹è±¡å‹å˜é‡ï¼Œä¹Ÿå¯ä»¥æ°å½“åœ°è¿›è¡Œåˆå§‹åŒ–å’ŒåºŸå¼ƒã€‚ä¸ºæ­¤éœ€è¦ä½¿ç”¨\\_main_block_desc_0ç»“æ„ä½“ä¸­å¢åŠ çš„æˆå‘˜å˜é‡copyå’Œdisposeï¼ˆè¿™ä¸¤ä¸ªå˜é‡éƒ½æ˜¯å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å‡½æ•°ï¼‰ï¼Œä»¥åŠä½œä¸ºæŒ‡é’ˆèµ‹å€¼ç»™è¯¥æˆå‘˜å˜é‡çš„__main_block_copy_0å‡½æ•°å’Œ__main_block_dispose_0å‡½æ•°ï¼š 1234567static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) { _Block_object_assign((void*)&amp;dst-&gt;array, (void*)src-&gt;array, 3/*BLOCK_FIELD_IS_OBJECT*/);}static void __main_block_dispose_0(struct __main_block_impl_0*src){ _Block_object_dispose((void*)src-&gt;array, 3/*BLOCK_FIELD_IS_OBJECT*/);} è§‚å¯Ÿè½¬æ¢åçš„ä»£ç ï¼Œä¸Šé¢ä¸¤ä¸ªå‡½æ•°åŒ…æ‹¬ä½¿ç”¨æŒ‡é’ˆå…¨éƒ¨éƒ½æ²¡æœ‰è¢«è°ƒç”¨ã€‚é‚£ä¹ˆè¿™äº›å‡½æ•°æ˜¯ä»å“ªå„¿è°ƒç”¨å‘¢ï¼Ÿ å‡½æ•° è°ƒç”¨æ—¶æœº copyå‡½æ•° æ ˆä¸Šçš„blockå¤åˆ¶åˆ°å †æ—¶ disposeå‡½æ•° å †ä¸Šçš„blockè¢«åºŸå¼ƒæ—¶ é‚£ä¹ˆä»€ä¹ˆæ—¶å€™æ ˆä¸Šçš„blockä¼šå¤åˆ¶åˆ°å †å‘¢ï¼Ÿ è°ƒç”¨blockçš„copy/strongå®ä¾‹æ–¹æ³• blockä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å›æ—¶ å°†blockèµ‹å€¼ç»™é™„æœ‰__storngä¿®é¥°ç¬¦idç±»å‹çš„ç±»æˆ–blockç±»å‹æˆå‘˜å˜é‡æ—¶ åœ¨æ–¹æ³•ä¸­å«æœ‰usingBlockçš„Cocoaæ¡†æ¶æ–¹æ³•æˆ–GCDçš„apiä¸­ä¼ é€’blockæ—¶ ä¹Ÿå°±æ˜¯è¯´è™½ç„¶ä»æºä»£ç æ¥çœ‹ï¼Œåœ¨ä¸Šé¢è¿™äº›æƒ…å†µä¸‹æ ˆä¸Šçš„blockè¢«èµ‹å€¼åˆ°å †ä¸Šï¼Œä½†å…¶å®å¯å½’ç»“ä¸º_Blockcopyå‡½æ•°è¢«è°ƒç”¨æ—¶blockä»æ ˆå¤åˆ¶åˆ°å †ã€‚ç›¸å¯¹çš„ï¼Œåœ¨é‡Šæ”¾å¤åˆ¶åˆ°å †ä¸Šçš„blockåï¼Œè°éƒ½ä¸æŒæœ‰blockè€Œä½¿å…¶è¢«åºŸå¼ƒæ—¶è°ƒç”¨disoposeå‡½æ•°ã€‚è¿™ç›¸å½“äºå¯¹è±¡çš„deallocæ–¹æ³•ã€‚æœ‰äº†è¿™ç§æ„é€ ï¼Œé€šè¿‡ä½¿ç”¨é™„æœ‰__strongä¿®é¥°ç¬¦çš„è‡ªåŠ¨å˜é‡ï¼Œblockä¸­æˆªè·çš„å¯¹è±¡å°±èƒ½å¤Ÿè¶…å‡ºå…¶å˜é‡ä½œç”¨åŸŸè€Œå­˜åœ¨ã€‚è™½ç„¶è¿™ç§ä½¿ç”¨copyå‡½æ•°ï¼Œdisposeå‡½æ•°çš„æ–¹æ³•åœ¨ä¹‹å‰æ²¡æœ‰è®²è§£ï¼Œä½†å®é™…ä¸Šåœ¨\\_blockå˜é‡ä¸­å·²ç»ç”¨åˆ°äº†ã€‚ __blockä¿®é¥°å˜é‡å’Œå¯¹è±¡__blockè¯´æ˜ç¬¦å¯æŒ‡å®šä»»ä½•ç±»å‹çš„è‡ªåŠ¨å˜é‡ã€‚ä¸‹é¢æŒ‡å®šç”¨äºèµ‹å€¼Objective-Cå¯¹è±¡çš„idç±»å‹è‡ªåŠ¨å˜é‡ã€‚ 1__block id obj = [NSObject new]; å…¶ä»£ç ç­‰åŒäºï¼š 1__block id __strong obj = [NSObject new]; æ”¹ä»£ç å¯é€šè¿‡clangè½¬æ¢å¦‚ä¸‹ï¼š åœ¨_blockå˜é‡ä¸ºé™„æœ‰\\_strongä¿®é¥°ç¬¦çš„idç±»å‹æˆ–å¯¹è±¡ç±»å‹è‡ªåŠ¨å˜é‡çš„æƒ…å†µä¸‹ä¼šå‘ç”ŸåŒæ ·çš„è¿‡ç¨‹ã€‚å½“__blockå˜é‡ä»æ ˆå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œä½¿ç”¨_Block_object_assignå‡½æ•°ï¼ŒæŒæœ‰èµ‹å€¼ç»™__blockå˜é‡çš„å¯¹è±¡ã€‚å½“å †ä¸Šçš„__blockå˜é‡è¢«åºŸå¼ƒæ—¶ï¼Œåˆ™ä½¿ç”¨_Block_object_disposeå‡½æ•°é‡Šæ”¾èµ‹å€¼ç»™__blockå˜é‡çš„å¯¹è±¡ã€‚ å¦‚æœ__blockå’Œ__weakä¸€èµ·ä½¿ç”¨ï¼Œåˆ™blockä¸ä¼šè¢«æŒæœ‰ï¼Œæ‰€ä»¥ä¸èµ·ä½œç”¨ã€‚__blockä¸èƒ½å’Œ__autoreleasingä¸€èµ·ä½¿ç”¨ï¼Œä¼šç¼–è¯‘é”™è¯¯ã€‚ æ€»ç»“ blockæˆªè·è‡ªåŠ¨å˜é‡æ—¶ä¸ç®¡æˆªè·çš„è‡ªåŠ¨å˜é‡æ˜¯å¯¹è±¡ç±»å‹è¿˜æ˜¯åŸºæœ¬ç±»å‹ï¼Œéƒ½ä¼šåœ¨blockç»“æ„ä½“å†…éƒ¨å»ºç«‹ä¸€ä¸ªæˆå‘˜å˜é‡è¿›è¡Œå­˜å‚¨ï¼Œæ•°æ®ç±»å‹ä¸ä¸æˆªè·çš„è‡ªåŠ¨å˜é‡æ•°æ®ç±»å‹ç›¸åŒã€‚ ä¸ºä»€ä¹ˆä¸èƒ½ä¿®æ”¹æˆªè·çš„è‡ªåŠ¨å˜é‡ï¼Ÿ å¯¹äºå€¼ç±»å‹ï¼Œæ˜¯ç®€å•çš„å€¼ä¼ é€’ã€‚ï¼ˆä¸ºä»€ä¹ˆä¸ç›´æ¥ä¼ é€’æŒ‡é’ˆå‘¢ï¼Ÿå› ä¸ºå€¼ç±»å‹ä¿å­˜åœ¨æ ˆä¸Šï¼Œå°±ç®—ä¼ é€’äº†æŒ‡é’ˆï¼Œå€¼ç±»å‹åœ¨å‡½æ•°ç»“æŸåå°±é”€æ¯äº†ã€‚æ‰€ä»¥ä¼ é€’æŒ‡é’ˆä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚ï¼‰ å¯¹äºå¯¹è±¡ç±»å‹æ˜¯æŒ‡é’ˆæµ…å¤åˆ¶ï¼ˆæµ…æ‹·è´å°±æ˜¯æ‹·è´æŒ‡å‘åŸæ¥å¯¹è±¡çš„æŒ‡é’ˆï¼Œä½¿åŸå¯¹è±¡çš„å¼•ç”¨è®¡æ•°+1ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ›å»ºäº†ä¸€ä¸ªæŒ‡å‘åŸå¯¹è±¡çš„æ–°æŒ‡é’ˆè€Œå·²ï¼Œå¹¶æ²¡æœ‰åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤åˆ¶åçš„å˜é‡ä¿®æ”¹è¿™ä»½å†…å­˜ï¼Œä½†æ˜¯ä¸èƒ½ä¿®æ”¹å¤–éƒ¨è‡ªåŠ¨å˜é‡ä½¿å…¶æŒ‡å‘å¦ä¸€å—å†…å­˜åŒºåŸŸï¼‰ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨__blockåå°±å¯ä»¥ä¿®æ”¹æˆªè·çš„è‡ªåŠ¨å˜é‡ï¼Ÿ è¢«ä¿®é¥°äº†_blockçš„è‡ªåŠ¨å˜é‡ä¸ç®¡æ˜¯åŸºæœ¬ç±»å‹è¿˜æ˜¯å¯¹è±¡ç±»å‹éƒ½ä¼šè¢«å°è£…åˆ°ä¸€ä¸ªç»“æ„ä½“ç±»å‹å˜é‡ä¸­ï¼Œè¡¨é¢ä¸Šçœ‹åˆ°çš„æ˜¯blockæˆªè·çš„æ˜¯è‡ªåŠ¨å˜é‡ï¼Œå…¶å®æ˜¯è¿™ä¸ªç»“æ„ä½“ç±»å‹å˜é‡çš„æŒ‡é’ˆï¼Œå› æ­¤å¯ä»¥ä¿®æ”¹è‡ªåŠ¨å˜é‡ã€‚å¹¶ä¸”å½“blockä»æ ˆä¸Šå¤åˆ¶åˆ°å †ä¸Šæ—¶ï¼Œæ ˆä¸Šçš„\\_blockä¿®é¥°çš„è‡ªåŠ¨å˜é‡çš„ç»“æ„ä½“ç±»å‹å˜é‡çš„forwardingæŒ‡é’ˆä¼šæŒ‡å‘å †ä¸Šçš„__blockä¿®é¥°çš„è‡ªåŠ¨å˜é‡çš„ç»“æ„ä½“ç±»å‹å˜é‡ã€‚æ‰€ä»¥ä¸ç®¡æ˜¯åœ¨æ ˆä¸Šè¿˜æ˜¯å †ä¸Šï¼Œåœ¨blockå†…è¿˜æ˜¯åœ¨blockå¤–ä¿®æ”¹ä½¿ç”¨__blockä¿®é¥°çš„è‡ªåŠ¨å˜é‡ï¼Œä¿®æ”¹çš„éƒ½æ˜¯åŒä¸€å—å†…å­˜åŒºåŸŸã€‚ å‚è€ƒï¼š ã€ŠObjective-Cé«˜çº§ç¼–ç¨‹:iOSä¸OS Xå¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹ ã€Šè°ˆObjective-C blockçš„å®ç°-å”å·§ã€‹ ã€Šæµ…è°ˆ block - æˆªè·å˜é‡æ–¹å¼ã€‹ ã€ŠiOSä¸­çš„æ·±å¤åˆ¶ä¸æµ…å¤åˆ¶ã€‹","link":"/2018/01/11/æ·±å…¥ç†è§£Block/"}],"tags":[{"name":"å¤šçº¿ç¨‹","slug":"å¤šçº¿ç¨‹","link":"/tags/å¤šçº¿ç¨‹/"},{"name":"8086æ±‡ç¼–","slug":"8086æ±‡ç¼–","link":"/tags/8086æ±‡ç¼–/"},{"name":"å¯»å€èƒ½åŠ›","slug":"å¯»å€èƒ½åŠ›","link":"/tags/å¯»å€èƒ½åŠ›/"},{"name":"cpu","slug":"cpu","link":"/tags/cpu/"},{"name":"ReactiveCocoa","slug":"ReactiveCocoa","link":"/tags/ReactiveCocoa/"},{"name":"å†…å­˜ç®¡ç†","slug":"å†…å­˜ç®¡ç†","link":"/tags/å†…å­˜ç®¡ç†/"},{"name":"swift tips","slug":"swift-tips","link":"/tags/swift-tips/"},{"name":"Shadowsocks","slug":"Shadowsocks","link":"/tags/Shadowsocks/"},{"name":"Block","slug":"Block","link":"/tags/Block/"},{"name":"å†…å­˜","slug":"å†…å­˜","link":"/tags/å†…å­˜/"}],"categories":[{"name":"Objective-C","slug":"Objective-C","link":"/categories/Objective-C/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","link":"/categories/è®¡ç®—æœºåŸºç¡€/"},{"name":"Swift","slug":"Swift","link":"/categories/Swift/"},{"name":"å·¥å…·","slug":"å·¥å…·","link":"/categories/å·¥å…·/"},{"name":"iOS","slug":"iOS","link":"/categories/iOS/"},{"name":"æ±‡ç¼–","slug":"è®¡ç®—æœºåŸºç¡€/æ±‡ç¼–","link":"/categories/è®¡ç®—æœºåŸºç¡€/æ±‡ç¼–/"},{"name":"Objective-Cåº•å±‚åŸç†","slug":"iOS/Objective-Cåº•å±‚åŸç†","link":"/categories/iOS/Objective-Cåº•å±‚åŸç†/"},{"name":"æ±‡ç¼–è¯­è¨€","slug":"è®¡ç®—æœºåŸºç¡€/æ±‡ç¼–è¯­è¨€","link":"/categories/è®¡ç®—æœºåŸºç¡€/æ±‡ç¼–è¯­è¨€/"}]}