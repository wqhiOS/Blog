<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>详解Objective-C对象 - wuqihan&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="两年前写过一篇文章：Objective-C类对象。当初对OC的理解还仅仅是刚入门，也没有遇到问题看源码的习惯，所以两年后，重新对Objective-C对象做一个总结。">
<meta name="keywords" content="类对象,Objective-C">
<meta property="og:type" content="article">
<meta property="og:title" content="详解Objective-C对象">
<meta property="og:url" content="http://www.wuqihan.cn/2018/08/03/详解Objective-C对象/index.html">
<meta property="og:site_name" content="wuqihan&#39;s blog">
<meta property="og:description" content="两年前写过一篇文章：Objective-C类对象。当初对OC的理解还仅仅是刚入门，也没有遇到问题看源码的习惯，所以两年后，重新对Objective-C对象做一个总结。">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://i.loli.net/2019/12/03/6t9bnROrxPdUisz.jpg">
<meta property="og:updated_time" content="2020-01-28T10:18:06.114Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="详解Objective-C对象">
<meta name="twitter:description" content="两年前写过一篇文章：Objective-C类对象。当初对OC的理解还仅仅是刚入门，也没有遇到问题看源码的习惯，所以两年后，重新对Objective-C对象做一个总结。">
<meta name="twitter:image" content="https://i.loli.net/2019/12/03/6t9bnROrxPdUisz.jpg">







<link rel="icon" href="/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/xcode.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?f05e5a7c4a4cc725742f6b78a200b97d";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
</head>
<!-- <body class="is-2-column"> -->
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="详解Objective-C对象" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">Home</a>
                
                <a class="navbar-item" href="/archives">Archives</a>
                
                <a class="navbar-item" href="/categories">Categories</a>
                
                <a class="navbar-item" href="/tags">Tags</a>
                
                <a class="navbar-item" href="/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span class="image is-7by1">
            <img class="thumbnail" src="https://i.loli.net/2019/12/03/6t9bnROrxPdUisz.jpg" alt="详解Objective-C对象">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                

                <span class="level-item has-text-grey">
                <i class="far fa-calendar-alt"></i>&nbsp;
                <time class="level-item has-text-grey" datetime="2018-08-02T16:46:45.000Z">&nbsp;2018-08-03</time>
                </span>

                
                <div class="level-item">
                <i class="far fa-folder-open has-text-grey"></i>&nbsp;
                <a class="has-link-grey -link" href="/categories/iOS/">iOS</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    <i class="far fa-clock"></i>&nbsp;
                    
                    
                    22 minutes read (About 3361 words)
                </span>
                
                
                <span class="level-item has-text-grey" id="busuanzi_container_page_pv">
                    <i class="far fa-eye"></i>
                    <span id="busuanzi_value_page_pv">0</span> visits
                </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal" style="color:#ff9300">
            
                详解Objective-C对象
            
        </h1>
        <div class="content">
            <p>两年前写过一篇文章：<a href="http://www.wuqihan.cn/2016/05/08/Objective-C%E5%AF%B9%E8%B1%A1%E8%AF%A6%E8%A7%A3/">Objective-C类对象</a>。当初对OC的理解还仅仅是刚入门，也没有遇到问题看源码的习惯，所以两年后，重新对Objective-C对象做一个总结。</p>
<a id="more"></a>
<h2 id="objc-class与objc-object"><a href="#objc-class与objc-object" class="headerlink" title="objc_class与objc_object"></a>objc_class与objc_object</h2><figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">NSObject</span> &lt;<span class="hljs-title">NSObject</span>&gt; </span>&#123;</span><br><span class="line">    Class isa;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Class类：</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">objc_class</span> *<span class="hljs-title">Class</span>;</span></span><br></pre></td></tr></table></figure>
<p>id:</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">objc_object</span> *<span class="hljs-title">id</span>;</span></span><br></pre></td></tr></table></figure>
<p>objc_class:</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">objc_class</span> :</span> objc_object &#123;</span><br><span class="line">    <span class="hljs-comment">// Class ISA;</span></span><br><span class="line">    Class superclass;</span><br><span class="line">    <span class="hljs-keyword">cache_t</span> cache;             <span class="hljs-comment">// formerly cache pointer and vtable</span></span><br><span class="line">    <span class="hljs-keyword">class_data_bits_t</span> bits;    <span class="hljs-comment">// class_rw_t * plus custom rr/alloc flags</span></span><br><span class="line"></span><br><span class="line">		<span class="hljs-comment">//....... 省略</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>objc_object:</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">truct objc_object &#123;</span><br><span class="line"><span class="hljs-keyword">private</span>:</span><br><span class="line">    <span class="hljs-keyword">isa_t</span> isa;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// ISA() assumes this is NOT a tagged pointer object</span></span><br><span class="line">    <span class="hljs-function">Class <span class="hljs-title">ISA</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// getIsa() allows this to be a tagged pointer object</span></span><br><span class="line">    <span class="hljs-function">Class <span class="hljs-title">getIsa</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">		<span class="hljs-comment">//....... 省略</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>通过以上代码可以得出结论：</p>
<p>Objective-C的面向对象都是基于C\C++的数据结构实现的。</p>
<p>NSObject对象本质上是C结构体，其只有一个变量<code>isa</code>，<code>isa</code>类型是<code>Class</code>(这样说并不算严谨，其实现在isa是一个联合体类型，下文会讲到)，<code>Class</code>是指向结构体<code>objc_class</code>的指针。</p>
<p><code>objc_class</code>又继承自<code>objc_object</code>。所以类也是结构体对象，我们平时称之为类对象。</p>
<h2 id="自定义类"><a href="#自定义类" class="headerlink" title="自定义类"></a>自定义类</h2><p>自定义一个Person类：</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">Person</span> : <span class="hljs-title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-built_in">NSString</span> *_name;</span><br><span class="line">    <span class="hljs-built_in">NSInteger</span> _age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">@end</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc main.m -o person</span><br></pre></td></tr></table></figure>
<p>使用上面的命令将上述文件编译为c++，可以看到Person类的实质为：</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NSObject_IMPL</span> &#123;</span></span><br><span class="line">	Class isa;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Person_IMPL</span> &#123;</span></span><br><span class="line">	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">NSObject_IMPL</span> <span class="hljs-title">NSObject_IVARS</span>;</span></span><br><span class="line">	NSString *_name;</span><br><span class="line">	NSInteger _age;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可以整理为：</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">struct</span> Person_IMPL &#123;</span><br><span class="line">	Class isa;</span><br><span class="line">	<span class="hljs-built_in">NSString</span> *_name;</span><br><span class="line">	<span class="hljs-built_in">NSInteger</span> _age;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>注意：因为NSObject中，isa是第一个成员变量，所以isa的地址，也就是这个结构体在内存中的地址。</p>
<h2 id="一个NSObject占用多少内存"><a href="#一个NSObject占用多少内存" class="headerlink" title="一个NSObject占用多少内存"></a>一个NSObject占用多少内存</h2><figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">NSObject</span> *object = [[<span class="hljs-built_in">NSObject</span> alloc] init]</span><br></pre></td></tr></table></figure>
<p>一个object使用了8个字节的空间，因为里面有一个指针，一个指针是8个字节，所以使用了8个字节。通过<code>class_getInstanceSize</code> 获取是8。</p>
<p>（为什么指针是8个字节。CPU64位，地址总线就是64位，64位= 8b）</p>
<p>但是在64位系统下。一个object系统会分配16个字节，因为iOS堆空间内存分配都是16字节的倍数。可以通过 <code>malloc_size</code> 函数查询为16。</p>
<ul>
<li><code>class_getInstanceSize</code>对象至少需要占多少内存(涉及内存对齐，一般是结构体的大小必须是最大成员大小的倍数。内存对齐规则很多，暂时不需要特别详细的理解。知道有内存对齐就行了。)</li>
<li><code>malloc_size</code> 系统真实分配了多少内存，(iOS堆空间内存分配都是16字节的倍数)</li>
</ul>
<p>如下的Person类分别使用<code>class_getInstanceSize</code>和<code>malloc_size</code>计算出大小，分别是几呢？</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">Person</span>: <span class="hljs-title">NSObject</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-built_in">NSString</span> *_name;</span><br><span class="line">    <span class="hljs-built_in">NSInteger</span> _age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>答案是24和32。因为Person类，内部有_name属性和 _age两个属性，分别都是8个字节，再加上通过继承获得的isa指针，所以是24个字节。又因为系统分配都是16字节的倍数，所以系统真实会分配32字节。</p>
<h2 id="对象、类对象、元类对象"><a href="#对象、类对象、元类对象" class="headerlink" title="对象、类对象、元类对象"></a>对象、类对象、元类对象</h2><p><img src="https://i.loli.net/2019/12/02/35CyexBGoZTtjVw.png" alt="objc_class.png" style="zoom:50%;"></p>
<p>这个图很经典了。要强调的点是右上角的<code>Root Class(meta)</code>。它的isa指向自己，superclass指向<code>Root Class(class)</code>。这里的<code>Root Class</code>,其实就可以看做是<code>NSObject</code>，因为OC中<code>NSObject</code>就是<code>基类</code>。以及任何<code>meta-class</code>的<code>isa</code>指针都指向<code>Root Class(meta)</code>。</p>
<p>通过这幅图，可以清楚的了解到：<code>instance</code>、<code>class</code>、<code>meta-class</code>之间通过<code>isa</code>指针连接起来，父子类之间通过<code>superclass</code>指针连接起来。通过这样，不管是<code>instance</code>还是<code>class</code>，就都可以轻易的找到其所拥有的方法，属性等信息。</p>
<h3 id="instance"><a href="#instance" class="headerlink" title="instance"></a>instance</h3><p>通过alloc 创建的都是instance，alloc分配内存，init进行初始化。</p>
<h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><p>为什么要有class对象？因为苹果使用class对象来保存instance的属性信息，对象方法信息，类所遵守的协议信息，成员变量信息等等，而不是保存在instance里，这样可以在内存中仅保存一个class对象即可。</p>
<p>我们经常说instance实例对象是保存在堆里面的，那class和meta-class呢。答案肯定是相同的，因为class和meta-class的本质同样也是对象，所以肯定保存在堆区。我尝试去验证了一下，验证的方法谈不上巧妙，挺愚蠢的，但是能够验证结论就行。验证方法如下：</p>
<p>我们知道iOS程序在内存中的布局<code>从低到高</code>如下：</p>
<p><code>代码区</code> -&gt; <code>常量区</code> -&gt; <code>全局区(已初始化)</code> -&gt; <code>全局区(未初始化)</code> -&gt; <code>堆区</code> -&gt; <code>栈区</code></p>
<p>我尝试打印 常量区变量的地址，全局区变量的地址，堆区变量的地址、栈区变量的地址。最后再打印类对象的地址，看看类对象的地址和上面所说的我明确知道是哪个区的变量的地址接近，就证明类对象到底是在哪个区存放。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//num1是已初始化变量，存放在全局区的已初始化区</span></span><br><span class="line"><span class="hljs-keyword">int</span> num1 = <span class="hljs-number">200</span>;</span><br><span class="line"><span class="hljs-comment">//num2是未初始化变量，存放在全局区的未初始化区</span></span><br><span class="line"><span class="hljs-keyword">int</span> num2;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">int</span> main(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="hljs-keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="hljs-built_in">NSString</span> *str = <span class="hljs-string">@"a"</span>;</span><br><span class="line">        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"str指向常量区地址：%p"</span>,str);</span><br><span class="line">        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"num1指向全局区(已初始化)地址：%p"</span>,&amp;num1);</span><br><span class="line">        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"num2指向全局区(未初始化)地址：%p"</span>,&amp;num2);</span><br><span class="line">        <span class="hljs-comment">//object指针指向堆内存中的一块。 object指针本身又是保存在栈上</span></span><br><span class="line">        <span class="hljs-built_in">NSObject</span> *object = [[<span class="hljs-built_in">NSObject</span> alloc] init];</span><br><span class="line">        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"object指向的堆内存：%p"</span>,object);</span><br><span class="line">        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"object指针在栈上存放的地址：%p"</span>,&amp;object);</span><br><span class="line">        Class objectClass = object_getClass(object);</span><br><span class="line">        Class objectMetaClass = object_getClass(objectClass);</span><br><span class="line">        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"objectClass 指向的地址：%p"</span>,objectClass);</span><br><span class="line">        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"objectMetaClass 指向的地址：%p"</span>,objectMetaClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印如下</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">str指向常量区地址：0x100001050</span><br><span class="line">num1指向全局区(已初始化)地址：0x1000012d0</span><br><span class="line">num2指向全局区(未初始化)地址：0x1000012d4</span><br><span class="line">object指向的堆内存：0x101887690</span><br><span class="line">object指针在栈上存放的地址：0x7ffeefbff570</span><br><span class="line">objectClass 指向的地址：0x100b37140</span><br><span class="line">objectMetaClass 指向的地址：0x100b370f0</span><br></pre></td></tr></table></figure>
<p>显然class 和 meta-class地址是介于 num2(全局区(未初始化)) 和 object指向的堆内存之间。又因为class和meta-class 肯定不可能是在全局区(未初始化)，所以那肯定是在堆区啦。</p>
<p>知道了class类对象是用来保存对象的属性信息，变量信息，方法信息等，那他到底是怎么保存这些信息的呢？</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">objc_class</span> :</span> objc_object &#123;</span><br><span class="line">    <span class="hljs-comment">// Class ISA;</span></span><br><span class="line">    Class superclass;</span><br><span class="line">    <span class="hljs-keyword">cache_t</span> cache;             <span class="hljs-comment">// formerly cache pointer and vtable</span></span><br><span class="line">    <span class="hljs-keyword">class_data_bits_t</span> bits;    <span class="hljs-comment">// class_rw_t * plus custom rr/alloc flags</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">class_rw_t</span> *data() &#123; </span><br><span class="line">        <span class="hljs-keyword">return</span> bits.data();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment">  .... 省略</span></span><br><span class="line"><span class="hljs-comment">  */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">//bits.data()</span></span><br><span class="line"><span class="hljs-keyword">class_rw_t</span>* data() &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> (<span class="hljs-keyword">class_rw_t</span> *)(bits &amp; FAST_DATA_MASK);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>查看源码，objc_class仅仅也只是有4个变量：</p>
<ol>
<li>isa</li>
<li>superclass</li>
<li>cache</li>
<li>bits</li>
</ol>
<p>isa，superclass是什么上文已经讲过了，cache看名字就知道是和缓存相关，这里暂时不介绍。那就只剩下bits这一个变量了，所以肯定是和bits有关。</p>
<p>查看class_rw_t *data(){}方法，返回值是class_rw_t：</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">class_rw_t</span> &#123;</span></span><br><span class="line">    <span class="hljs-comment">// Be warned that Symbolication knows the layout of this structure.</span></span><br><span class="line">    <span class="hljs-keyword">uint32_t</span> flags;</span><br><span class="line">    <span class="hljs-keyword">uint32_t</span> version;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">class_ro_t</span> *ro;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">method_array_t</span> methods;</span><br><span class="line">    <span class="hljs-keyword">property_array_t</span> properties;</span><br><span class="line">    <span class="hljs-keyword">protocol_array_t</span> protocols;</span><br><span class="line"></span><br><span class="line">    Class firstSubclass;</span><br><span class="line">    Class nextSiblingClass;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">char</span> *demangledName;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> SUPPORT_INDEXED_ISA</span></span><br><span class="line">    <span class="hljs-keyword">uint32_t</span> index;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setFlags</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> <span class="hljs-built_in">set</span>)</span> </span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        OSAtomicOr32Barrier(<span class="hljs-built_in">set</span>, &amp;flags);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">clearFlags</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> clear)</span> </span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        OSAtomicXor32Barrier(clear, &amp;flags);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">// set and clear must not overlap</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">changeFlags</span><span class="hljs-params">(<span class="hljs-keyword">uint32_t</span> <span class="hljs-built_in">set</span>, <span class="hljs-keyword">uint32_t</span> clear)</span> </span></span><br><span class="line"><span class="hljs-function">    </span>&#123;</span><br><span class="line">        assert((<span class="hljs-built_in">set</span> &amp; clear) == <span class="hljs-number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">uint32_t</span> oldf, newf;</span><br><span class="line">        <span class="hljs-keyword">do</span> &#123;</span><br><span class="line">            oldf = flags;</span><br><span class="line">            newf = (oldf | <span class="hljs-built_in">set</span>) &amp; ~clear;</span><br><span class="line">        &#125; <span class="hljs-keyword">while</span> (!OSAtomicCompareAndSwap32Barrier(oldf, newf, (<span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int32_t</span> *)&amp;flags));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">class_ro_t</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">uint32_t</span> flags;</span><br><span class="line">    <span class="hljs-keyword">uint32_t</span> instanceStart;</span><br><span class="line">    <span class="hljs-keyword">uint32_t</span> instanceSize;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> __LP64__</span></span><br><span class="line">    <span class="hljs-keyword">uint32_t</span> reserved;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint8_t</span> * ivarLayout;</span><br><span class="line">    </span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> * name;</span><br><span class="line">    <span class="hljs-keyword">method_list_t</span> * baseMethodList;</span><br><span class="line">    <span class="hljs-keyword">protocol_list_t</span> * baseProtocols;</span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">ivar_list_t</span> * ivars;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">const</span> <span class="hljs-keyword">uint8_t</span> * weakIvarLayout;</span><br><span class="line">    <span class="hljs-keyword">property_list_t</span> *baseProperties;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">method_list_t</span> *baseMethods() <span class="hljs-keyword">const</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> baseMethodList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>查看class_rw_t结构体代码。其中有几个变量： methods，properties，protocols，class_ro_t *ro。</p>
<p>看到这里就能明白了，通过bits.data()=&gt; (class_rw_t *)(bits &amp; FAST_DATA_MASK) ,获取class_rw_t结构体，该结构体保存了相关类的方法信息，属性信息，协议信息，以及成员变量信息等。class_ro_t这里，我猜测ro是readonly的意思，保存的是只读，不可变的类信息，包括成员变量，类名等信息</p>
<h3 id="meta-class"><a href="#meta-class" class="headerlink" title="meta-class"></a>meta-class</h3><p>通过<code>objc_getClass(class)</code>方法来获取meta-class(元类对象)。</p>
<p>每个类在内存中有且只有一个·对象。meta-class与class都是Class类型。主要存储类方法信息等。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Class cls = [[Person <span class="hljs-keyword">class</span>] <span class="hljs-keyword">class</span>];</span><br></pre></td></tr></table></figure>
<p>上面的代码获取的cls是class对象(类对象)，并不是meta-class对象(元类对象)。</p>
<p>原因在于，第一个class 方法是类方法，第二个class方法仍是类方法（为什么第二个class仍然是类方法，因为第一个class调用后得到的是类对象，类对象调用的肯定又类方法啦）。</p>
<p>看一下<code>+(Class)class:</code>方法的实现就明白了。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+ (Class)<span class="hljs-keyword">class</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (Class)<span class="hljs-keyword">class</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> object_getClass(<span class="hljs-keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class object_getClass(<span class="hljs-keyword">id</span> obj)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (obj) <span class="hljs-keyword">return</span> obj-&gt;getIsa();</span><br><span class="line">    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> Nil;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="isa指针"><a href="#isa指针" class="headerlink" title="isa指针"></a>isa指针</h2><figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">union</span> <span class="hljs-keyword">isa_t</span> &#123;</span><br><span class="line">    <span class="hljs-keyword">isa_t</span>() &#123; &#125;</span><br><span class="line">    <span class="hljs-keyword">isa_t</span>(<span class="hljs-keyword">uintptr_t</span> value) : bits(value) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    Class cls;</span><br><span class="line">    <span class="hljs-keyword">uintptr_t</span> bits;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> defined(ISA_BITFIELD)</span></span><br><span class="line">    <span class="hljs-class"><span class="hljs-keyword">struct</span> &#123;</span></span><br><span class="line">        ISA_BITFIELD;  <span class="hljs-comment">// defined in isa.h</span></span><br><span class="line">        </span><br><span class="line"><span class="hljs-comment">//        uintptr_t nonpointer        : 1; /*0 表示普通的 isa 指针，1 表示使用优化，存储引用计数*/</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t has_assoc         : 1;</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t has_cxx_dtor      : 1;  /*表示该对象是否有 C++ 或 ARC 的析构函数，如果没有，则析构时更快*/</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t shiftcls          : 33; /*MACH_VM_MAX_ADDRESS 0x1000000000*/</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t magic             : 6;</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t weakly_referenced : 1;</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t deallocating      : 1;</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t has_sidetable_rc  : 1;  /*如果为1 表示该对象的引用计数值是否过大无法存储在 isa 指针*/</span></span><br><span class="line"><span class="hljs-comment">//        uintptr_t extra_rc          : 19;</span></span><br><span class="line">    &#125;;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>上文提到，instance的isa指针是指向class（类对象），呢也就是说isa指针的值就是class的地址。但是从上面的源码可以看出，isa是isa_t类型，isa_t是一个union。</p>
<p>查看如下源码，isa需要进行一次位运算，才能计算出真实地址：</p>
<figure class="highlight c++ hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">inline</span> Class </span><br><span class="line">objc_object::ISA() </span><br><span class="line">&#123;</span><br><span class="line">    assert(!isTaggedPointer()); </span><br><span class="line">  <span class="hljs-comment">// SUPPORT_INDEXD_ISA 始终未0</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> SUPPORT_INDEXED_ISA</span></span><br><span class="line">    <span class="hljs-keyword">if</span> (isa.nonpointer) &#123;</span><br><span class="line">        <span class="hljs-keyword">uintptr_t</span> slot = isa.indexcls;</span><br><span class="line">        <span class="hljs-keyword">return</span> classForIndex((<span class="hljs-keyword">unsigned</span>)slot);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> (Class)isa.bits;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span></span><br><span class="line">    <span class="hljs-keyword">return</span> (Class)(isa.bits &amp; ISA_MASK);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在源码中发现，SUPPORT_INDEXD_ISA 这个宏始终未0，，且isa是联合体union，isa.bits其实就是isa的值。</p>
<p>我在Mac电脑上，x86架构下测试，发现instance的isa地址和class的地址是一样的。并且isa &amp; ISA_MASK后，结果仍然是isa的值。</p>
<p>于是我使用真机测试，发现isa的值和class的地址确实不一样了，需要isa &amp; ISA_MASK，才能获取class的地址</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Person *person = [[Person alloc] init];</span><br><span class="line">Class personClass = object_getClass(person);</span><br></pre></td></tr></table></figure>
<h2 id="一道测试题"><a href="#一道测试题" class="headerlink" title="一道测试题"></a>一道测试题</h2><p>做一个小测试，检验上面的学习成果。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-built_in">BOOL</span> res1 = [[<span class="hljs-built_in">NSObject</span> <span class="hljs-keyword">class</span>] isKindOfClass:[<span class="hljs-built_in">NSObject</span> <span class="hljs-keyword">class</span>]];</span><br><span class="line"><span class="hljs-built_in">BOOL</span> res2 = [[Person <span class="hljs-keyword">class</span>] isKindOfClass:[Person <span class="hljs-keyword">class</span>]];</span><br><span class="line"><span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"%d %d"</span>,res1,res2);</span><br></pre></td></tr></table></figure>
<p>如下代码打印结果是什么？（<strong>这道题目本身就很扯，没有什么价值，会与不会无关紧要，仅仅就是加深对类对象、元类对象之间关系的理解。</strong>）</p>
<p>答案是 res1 = 1 ,res2 = 0。也就是第一个相等，第二个不相等。这个问题是在网上一篇文章看到的：<a href="https://www.jianshu.com/p/b26b6feb58f6" target="_blank" rel="noopener">https://www.jianshu.com/p/b26b6feb58f6</a> <strong>虽然作者给出的答案是正确的，但是解释却完全是错误的</strong>。(不知道为什么网上关于OC对象本质的文章真的是数不胜数，但是真心没有什么参考价值，要么是太浅显，要么就是各种错误)</p>
<p><code>NSObject</code> 有两个 <code>isKindOfClass</code>方法，一个是对象方法 一个是类方法：</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="hljs-built_in">BOOL</span>)isKindOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (Class tcls = [<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]; tcls; tcls = tcls-&gt;superclass) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (tcls == cls) <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="hljs-built_in">BOOL</span>)isSubclassOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (Class tcls = <span class="hljs-keyword">self</span>; tcls; tcls = tcls-&gt;superclass) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (tcls == cls) <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面题目中的代码调用的很显然是<strong>+类方法</strong>，但是我看的这篇文章的作者却是在拿<strong>-对象方法</strong>在解释，这不是在误导群众嘛==。</p>
<figure class="highlight objc hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="hljs-built_in">NSObject</span> <span class="hljs-keyword">class</span>] isKindOfClass:[<span class="hljs-built_in">NSObject</span> <span class="hljs-keyword">class</span>]];</span><br><span class="line"></span><br><span class="line">+ (<span class="hljs-built_in">BOOL</span>)isKindOfClass:(Class)cls &#123;</span><br><span class="line">    <span class="hljs-keyword">for</span> (Class tcls = object_getClass((<span class="hljs-keyword">id</span>)<span class="hljs-keyword">self</span>); tcls; tcls = tcls-&gt;superclass) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (tcls == cls) <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解释：</p>
<p>这里只解释第一个为什么为1，也就是true，明白第一个自然第二个也就明白了。</p>
<p>[NSObject class]调用 +isKindOfClass方法<br>+isKindOfClass 内部是一个for循环，每次调用结束会 tcls = tcls-&gt;superclass<br>第一次for循环：<br><code>tcls</code> = object_getClass(self), 因为self是类对象，所以结果是<code>meta-class</code>，即元类对象</p>
<p><code>tcls</code>是<code>NSObject meta-class</code><br><code>cls</code> 是 <code>NSObject class</code></p>
<p>所以显然不相等；<br>第一次for循环结束：调用 tcls = tcls-&gt;superclass</p>
<p>因为<code>NSObject</code>是<code>rootClass</code>，所以<code>NSObject meta-class</code>的<code>superclass</code>指向的是<code>NSObject class</code>，所以调用完毕后，<code>tcls</code>就从<code>meta-class</code>变成了 <code>NSObject class</code><br>第二次for循环时：</p>
<p><code>tcls</code>是<code>NSObject class</code> ，<code>cls</code>也是<code>NSObject cls</code>，所以相等，返回<strong>true</strong></p>

        </div>
        
            <ul class="post-copyright">
            <li><strong>本文标题：</strong><a href="http://www.wuqihan.cn/2018/08/03/详解Objective-C对象/">详解Objective-C对象</a></li>
            <li><strong>本文作者：</strong><a href="http://www.wuqihan.cn">吴启晗</a></li>
            <li><strong>本文链接：</strong><a href="http://www.wuqihan.cn/2018/08/03/详解Objective-C对象/">http://www.wuqihan.cn/2018/08/03/详解Objective-C对象/</a></li>
            <li><strong>发布时间：</strong>2018-08-03</li>
            <li><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
            </li>
            </ul>
        
        
        <hr style="height:1px;margin:1rem 0">
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/Objective-C/">Objective-C</a>,&nbsp;<a class="has-link-grey -link" href="/tags/类对象/">类对象</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">Like this article? Support the author with</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>Alipay</span>
    <div class="qrcode"><img src="https://i.loli.net/2019/11/06/ASwmOFftXiTqxEe.jpg" alt="Alipay"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>Wechat</span>
    <div class="qrcode"><img src="https://i.loli.net/2019/11/06/lLMy7kZArdoJCN5.jpg" alt="Wechat"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2018/11/06/Tagged-Pointer/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Tagged Pointer</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2018/05/28/汇编学习踩坑记录/">
                <span class="level-item">汇编学习踩坑记录</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Comments</h3>
        
<div id="lv-container" data-id="city" data-uid="MTAyMC8zNTA2Ni8xMTYwMQ==">
    <script type="text/javascript">
        (function(d, s) {
            var j, e = d.getElementsByTagName(s)[0];

            if (typeof LivereTower === 'function') { return; }

            j = d.createElement(s);
            j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
            j.async = true;

            e.parentNode.insertBefore(j, e);
        })(document, 'script');
    </script>
    <noscript> Please activate JavaScript for write a comment in LiveRe</noscript>
</div>

    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                        <img style="border-radius:8px" class="image is-128x128 has-mb-6" src="/images/avatar.jpg" alt="吴启晗">
                    
                    
                    <p class="is-size-4 is-block">
                        吴启晗
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        iOS Developer  
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>Shanghai, China</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level menu-list is-mobile" style="margin-bottom:1rem">
            <div class="level-item has-text-centered is-marginless">
                <a href="/archives/">
                    <p class="heading">
                        Posts
                    </p>
                    <p class="title has-text-weight-normal">
                        24
                    </p>
                </a>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <a href="/categories/">
                    <p class="heading">
                        Categories
                    </p>
                    <p class="title has-text-weight-normal">
                        9
                    </p>
                </a>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <a href="/tags/">
                    <p class="heading">
                        Tags
                    </p>
                    <p class="title has-text-weight-normal">
                        21
                    </p>
                </a>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="mailto:wuqh_ios@icloud.com" target="_blank">
                Contact</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/wqhiOS">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Weibo" href="http://weibo.com/2065544495">
                
                <i class="fab fa-weibo"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Wechat" href="https://raw.githubusercontent.com/wqhiOS/blogSources/master/qrCode/myWechat.jpeg">
                
                <i class="fab fa-weixin"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
        </div>
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="详解Objective-C对象" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2107-2020 吴启晗&nbsp;
                <!-- Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> -->
                
                
                <br>
                <span id="busuanzi_container_site_uv">
                Visited by <span id="busuanzi_value_site_uv">0</span> users
                </span>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>